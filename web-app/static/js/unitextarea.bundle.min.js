"use strict";(()=>{var C=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ft=C((eH,co)=>{"use strict";co.exports=(e,t,s)=>{let r=document.createElement(e);if(t)for(let[n,o]of Object.entries(t))r.style[n]=o;if(s)for(let[n,o]of Object.entries(s))r.setAttribute(n,o);return r}});var xn=C((tH,go)=>{"use strict";go.exports=(e,t)=>{t.parentNode.insertBefore(e,t)}});var Po=C((iH,po)=>{"use strict";var fo=Ft(),Dc=xn();po.exports=(e,t)=>{let s=fo("div",{},{class:"div-underneath-unitextarea","data-no-ehtml":"true"}),r=fo("div",{},{id:"div-underneath-unitextarea-text-container",class:"div-underneath-unitextarea-text-container","data-no-ehtml":"true"});return s.appendChild(r),s.textContainer=r,Dc(s,e),s}});var Co=C((nH,To)=>{"use strict";var Mc=Ft(),Lc=xn();To.exports=(e,t)=>{let s=Mc("div",{},{class:"line-numbers-column"});return Lc(s,e),s}});var Oo=C((sH,bo)=>{"use strict";var Vc=Ft();bo.exports=e=>{let t=Vc("div",{display:"none",position:"absolute"},{class:"autocomplete-list-view"});return e.parentNode.appendChild(t),t}});var vo=C((oH,Ho)=>{"use strict";Ho.exports=(e,t,s)=>{s.addEventListener("scroll",()=>{e.scrollTop=s.scrollTop,e.scrollLeft=s.scrollLeft,t.scrollTop=s.scrollTop},{passive:!0})}});var ko=C((rH,Wo)=>{"use strict";Wo.exports=e=>{e.addEventListener("keydown",t=>{t.key==="Enter"&&(e.scrollLeft=0)})}});var wo=C((aH,No)=>{"use strict";No.exports=e=>{e.addEventListener("input",()=>{e.selectionStart===e.value.length&&(e.scrollTop=e.scrollHeight)})}});var $o=C((lH,Io)=>{"use strict";Io.exports=(e,t)=>{let s=window.getComputedStyle(e),r=s.getPropertyValue("font-weight")||"normal",n=s.getPropertyValue("font-size")||"16px";return`${r} ${n} ${t}`}});var Fn=C((hH,Bo)=>{"use strict";var Rc=$o();Bo.exports=(e,t,s)=>{let n=document.createElement("canvas").getContext("2d");return n.font=Rc(e,s),n.measureText(t).width}});var Ao=C((uH,yo)=>{"use strict";var jc=Fn();yo.exports=(e,t,s)=>{let r=e.selectionStart,n=e.value.split(`
`),o=n.map(O=>O.length),a=e.value.substr(0,r).split(`
`).length-1,i=o.slice(0,a),l=i.length>=1?i.reduce((O,$)=>O+$):0,h=r,m=a,u=h-l-m,g=n[a].slice(0,u),d=jc(e,g,s),f=t*(a+1),p=d,T=e.scrollTop>f+t||e.scrollTop<f-e.clientHeight,b=e.scrollLeft>p||e.scrollLeft<p-e.clientWidth;if(T){let O=.3333333333333333;e.scrollTop=f-e.clientHeight*O}if(b){let O=.3333333333333333;e.scrollLeft=p-e.clientWidth*O}}});var Fo=C((mH,xo)=>{"use strict";var Sc=Ao();xo.exports=(e,t)=>{let r=window.getComputedStyle(e).getPropertyValue("line-height").split("px")[0]*1;e.addEventListener("input",()=>{Sc(e,r,t)})}});var Dn=C((cH,Do)=>{"use strict";Do.exports=e=>e>=48&&e<=57||e>=65&&e<=90||e>=96&&e<=111||e>=186&&e<=222||e===32||e===8||e===46||e===13});var Lo=C((dH,Mo)=>{"use strict";var Ec=Dn();Mo.exports=e=>{window.weAreTypingInTextarea=!1;let t;e.addEventListener("keydown",s=>{t&&window.clearTimeout(t),Ec(s.keyCode)&&(window.weAreTypingInTextarea=!0),t=window.setTimeout(()=>{window.weAreTypingInTextarea=!1},500)})}});var jo=C((gH,Ro)=>{"use strict";var Vo=`
`;Ro.exports=e=>(e[e.length-1]===Vo&&(e+=Vo),e)});var qo=C((fH,Eo)=>{"use strict";var So=`
`;Eo.exports=e=>{e["command is not recognizable"]={condition:(t,s,r,n,o,a,i)=>r.lastOnTheLine&&n.length>0,action:(t,s,r,n,o,a,i)=>{i.errors.push(`command '${o}' is not recognizable or applicable on the line ${s}`),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="nrch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(So);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="nrch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(So)})},itIsNewCommandProgressionFromLevel:"last level"}}});var Mn=C((pH,Uo)=>{"use strict";Uo.exports={"background color":"backgroundColor","background colour":"backgroundColor","bg color":"backgroundColor","bg colour":"backgroundColor","music font":"musicFont","text font":"textFont","chord letters font":"chordLettersFont","font color":"fontColor","font colour":"fontColor","page border color":"pageBorderStrokeColor","page border colour":"pageBorderStrokeColor","border color":"pageBorderStrokeColor","border colour":"pageBorderStrokeColor","stave lines color":"staveLinesColor","stave lines colour":"staveLinesColor","staff lines color":"staveLinesColor","staff lines colour":"staveLinesColor","font size":"intervalBetweenStaveLines","interval between stave lines":"intervalBetweenStaveLines","interval between staves":"intervalBetweenStaves","interval between lines":"intervalBetweenPageLines","page left and right paddings":"pageLeftAndRightPadding","page line width":"pageLineMaxWidth","page top padding":"pageTopPadding","page bottom padding":"pageBottomPadding","page lines top offset":"pageLinesTopOffset","page number bottom offset":"pageNumberOffsetFromBottomOfThePage","title top offset":"titleTopOffset","subtitle top offset":"subtitleTopOffset","left and right subtitles top offset":"leftAndRightSubtitlesTopOffset","page border width":"pageBorderStrokeWidth","title font size":"titleFontSize","subtitle font size":"subtitleFontSize","left subtitle font size":"leftSubtitleFontSize","right subtitle font size":"rightSubtitleFontSize","page number font size":"pageNumberFontSize","instrument font size":"instrumentTitleFontSize","instrument title font size":"instrumentTitleFontSize","empty measure width":"emptyMeasureWidth","page format":"pageFormat","page height":"pageHeight"}});var Ln=C((PH,_o)=>{"use strict";_o.exports=Object.keys(Mn())});var Vn=C((TH,Jo)=>{"use strict";Jo.exports=["bravura","leland"]});var Rn=C((CH,Ko)=>{"use strict";Ko.exports=["noto-sans","noto-serif"]});var jn=C((bH,Go)=>{"use strict";Go.exports=["gentium plus","gothic a1"]});var Sn=C((OH,zo)=>{"use strict";zo.exports={title:"title",subtitle:"subtitle",author:"subtitle",description:"subtitle",composer:"leftSubtitle",arrangement:"leftSubtitle","left subtitle":"leftSubtitle","right subtitle":"rightSubtitle","page number":"pageNumber"}});var En=C((HH,Yo)=>{"use strict";Yo.exports=Object.keys(Sn())});var Li=C((vH,Qo)=>{"use strict";Qo.exports={"bold double barline":"startBoldDoubleBarLine","double bold barline":"startBoldDoubleBarLine",barline:"startBarLine"}});var qn=C((WH,Xo)=>{"use strict";Xo.exports=Object.keys(Li())});var Vi=C((kH,Zo)=>{"use strict";Zo.exports={"bold double barline":"boldDoubleBarLine","double bold barline":"boldDoubleBarLine","double barline":"doubleBarLine","dotted barline":"dottedBarLine",barline:"barLine"}});var Un=C((NH,er)=>{"use strict";er.exports=Object.keys(Vi())});var _n=C((wH,tr)=>{"use strict";tr.exports={first:"first",last:"last",all:"all","first last":"first&last","first and last":"first&last","first & last":"first&last","first&last":"first&last"}});var nr=C((IH,ir)=>{"use strict";ir.exports=Object.keys(_n())});var Ri=C(($H,sr)=>{"use strict";sr.exports=["g major to c major|g major to a minor|e minor to c major|e minor to a minor","d major to c major|d major to a minor|b minor to c major|b minor to a minor","a major to c major|a major to a minor|f sharp minor to c major|f sharp minor to a minor","e major to c major|e major to a minor|c sharp minor to c major|c sharp minor to a minor","b major to c major|b major to a minor|g sharp minor to c major|g sharp minor to a minor","f sharp major to c major|f sharp major to a minor|d sharp minor to c major|d sharp minor to a minor","c sharp major to c major|c sharp major to a minor|a sharp minor to c major|a sharp minor to a minor","f major to c major|f major to a minor|d minor to c major|d minor to a minor","b flat major to c major|b flat major to a minor|g minor to c major|g minor to a minor","e flat major to c major|e flat major to a minor|c minor to c major|c minor to a minor","a flat major to c major|a flat major to a minor|f minor to c major|f minor to a minor","d flat major to c major|d flat major to a minor|b flat minor to c major|b flat minor to a minor","g flat major to c major|g flat major to a minor|e flat minor to c major|e flat minor to a minor","c flat major to c major|c flat major to a minor|a flat minor to c major|a flat minor to a minor","c major|a minor","g major|e minor","d major|b minor","a major|f sharp minor","e major|c sharp minor","b major|g sharp minor","f sharp major|d sharp minor","c sharp major|a sharp minor","f major|d minor","b flat major|g minor","e flat major|c minor","a flat major|f minor","d flat major|b flat minor","g flat major|e flat minor","c flat major|a flat minor"]});var Jn=C((BH,or)=>{"use strict";or.exports={whole:"whole",half:"half",quarter:"quarter",eighth:"eighth",sixteenth:"sixteenth","thirty\\s+second":"thirtySecond","sixty\\s+fourth":"sixtyFourth","1(?!\\d|/)":"whole","1/2(?!\\d|/)":"half","1/4(?!\\d|/)":"quarter","1/8(?!\\d|/)":"eighth","1/16(?!\\d|/)":"sixteenth","1/32(?!\\d|/)":"thirtySecond","1/64(?!\\d|/)":"sixtyFourth"}});var ar=C((yH,rr)=>{"use strict";rr.exports=Object.keys(Jn())});var zt=C((AH,lr)=>{"use strict";lr.exports={treble:"treble",g:"treble",bass:"bass",f:"bass",alto:"alto",c:"alto",baritone:"baritone","mezzo soprano":"mezzoSoprano",mezzo:"mezzoSoprano",octave:"octaveEightUp","octave eight up":"octaveEightUp","octave up":"octaveEightUp","octave 8 up":"octaveEightUp","octave eight down":"octaveEightDown","octave down":"octaveEightDown","octave 8 down":"octaveEightDown","octave fifteen up":"octaveFifteenUp","2 octaves up":"octaveFifteenUp","two octaves up":"octaveFifteenUp","octave 15 up":"octaveFifteenUp","octave fifteen down":"octaveFifteenDown","2 octaves down":"octaveFifteenDown","two octaves down":"octaveFifteenDown","octave 15 down":"octaveFifteenDown",soprano:"soprano",tenor:"tenor"}});var Kn=C((xH,hr)=>{"use strict";hr.exports=Object.keys(zt())});var ji=C((FH,ur)=>{"use strict";ur.exports={4:4,2:2,1:1,"1/2":1/2,"1/4":1/4,"1/8":1/8,"1/16":1/16,"1/32":1/32,"1/64":1/64,"1/128":1/128,"1/256":1/256}});var cr=C((DH,mr)=>{"use strict";mr.exports=Object.keys(ji())});var gr=C((MH,dr)=>{"use strict";dr.exports=["c","d","e","f","g","a","b"]});var Si=C((LH,fr)=>{"use strict";fr.exports={previous:"prev",prev:"prev",current:"current",cur:"current",next:"next"}});var Pr=C((VH,pr)=>{"use strict";pr.exports=Object.keys(Si())});var Gn=C((RH,Tr)=>{"use strict";Tr.exports={"2fl":"doubleFlatKey","2 flat":"doubleFlatKey","double fl":"doubleFlatKey","double flat":"doubleFlatKey","2#":"doubleSharpKey","2 sharp":"doubleSharpKey","double #":"doubleSharpKey","double sh":"doubleSharpKey","double sharp":"doubleSharpKey",fl:"flatKey",flat:"flatKey",n:"naturalKey",natural:"naturalKey","#":"sharpKey",sh:"sharpKey",sharp:"sharpKey","1/2fl":"demiflatKey","1/2 flat":"demiflatKey",dmfl:"demiflatKey",demiflat:"demiflatKey","demi flat":"demiflatKey","3/2fl":"sesquiflatKey","3/2 flat":"sesquiflatKey",sqfl:"sesquiflatKey","sesqui flat":"sesquiflatKey",sesquiflat:"sesquiflatKey","1/2#":"demisharpKey","1/2 sh":"demisharpKey","1/2 sharp":"demisharpKey","dm#":"demisharpKey","demi#":"demisharpKey",dmsh:"demisharpKey","demi sharp":"demisharpKey",demisharp:"demisharpKey","3/2#":"sesquisharpKey","3/2 sh":"sesquisharpKey","3/2 sharp":"sesquisharpKey",sqsh:"sesquisharpKey","sesqui sharp":"sesquisharpKey",sesquisharp:"sesquisharpKey"}});var zn=C((jH,Cr)=>{"use strict";Cr.exports=Object.keys(Gn())});var Yn=C((SH,br)=>{"use strict";br.exports={comma:"comma","double slashes":"double slash","double slash":"double slash"}});var Hr=C((EH,Or)=>{"use strict";Or.exports=Object.keys(Yn())});var Qn=C((qH,vr)=>{"use strict";vr.exports={staccato:"staccato",spiccato:"spiccato",accent:"accent",tenuto:"tenuto",marcato:"marcato",fermata:"fermata","left hand pizzicato":"leftHandPizzicato","left pizzicato":"leftHandPizzicato","left hand pizz":"leftHandPizzicato","left pizz":"leftHandPizzicato","snap pizzicato":"snapPizzicato","snap pizz":"snapPizzicato","natural harmonic":"naturalHarmonic","natural harm":"naturalHarmonic","up bow":"upBow","down bow":"downBow"}});var Xn=C((UH,Wr)=>{"use strict";Wr.exports=Object.keys(Qn())});var Zn=C((_H,kr)=>{"use strict";kr.exports={fl:"flat",flat:"flat",n:"natural",natural:"natural","#":"sharp",sh:"sharp",sharp:"sharp"}});var es=C((JH,Nr)=>{"use strict";Nr.exports=Object.keys(Zn())});var ts=C((KH,wr)=>{"use strict";wr.exports={"default instrument":"defaultInstrument","default tempo":"defaultTempo"}});var is=C((GH,Ir)=>{"use strict";var qc=ts();Ir.exports=Object.keys(qc)});var ns=C((zH,$r)=>{"use strict";$r.exports=["acoustic grand piano","grand piano","piano","bright acoustic piano","bright piano","electric grand piano","electric piano","honky-tonk piano","honky-tonk","electric piano 1","electric piano 2","harpsichord","harp","clavi","celesta","glockenspiel","music box","vibraphone","vibra","marimba","xylophone","xylo","tubular bells","bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","classic guitar","nylon guitar","acoustic guitar (steel)","acoustic guitar","concert guitar","steel guitar","guitar","electric guitar (jazz)","electric jazz guitar","jazz guitar","electric guitar (clean)","electric guitar","electric clean guitar","clean guitar","electric guitar (muted)","electric muted guitar","muted guitar","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","bass","electric bass (finger)","electric finger bass","finger bass","bass guitar","electric bass (pick)","electric pick bass","pick bass","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","square","lead 2 (sawtooth)","sawtooth","lead 3 (calliope)","calliope","lead 4 (chiff)","chiff","lead 5 (charang)","charang","lead 6 (voice)","voice","lead 7 (fifths)","fifths","lead 8 (bass + lead)","bass + lead","bass & lead","bass and lead","pad 1 (new age)","new age","pad 2 (warm)","warm","pad 3 (polysynth)","polysynth","pad 4 (choir)","choir","pad 5 (bowed)","bowed","pad 6 (metallic)","metallic","pad 7 (halo)","halo","pad 8 (sweep)","sweep","fx 1 (rain)","rain","fx 2 (soundtrack)","soundtrack","fx 3 (crystal)","crystal","fx 4 (atmosphere)","atmosphere","fx 5 (brightness)","brightness","fx 6 (goblins)","goblins","fx 7 (echoes)","echoes","fx 8 (sci-fi)","sci-fi","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","bird","tweet","telephone ring","telephone","ring","helicopter","applause","gunshot"]});var yr=C((YH,Br)=>{"use strict";Br.exports=e=>e.replace(/(\s){2,}/g," ").trim()});var ss=C((QH,Ar)=>{"use strict";Ar.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","goldenrod","gold","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavenderblush","lavender","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]});var y=C((XH,ya)=>{"use strict";var Uc=Ln(),_c=Vn(),Jc=Rn(),Kc=jn(),Gc=En(),Yi=qn(),Hs=Un(),Ta=nr(),zc=Ri(),xr=ar(),Os=Kn(),ht=cr(),os=gr(),Yt=Pr(),Ca=zn(),ft=Hr(),ba=Xn(),Oa=es(),Yc=is(),Qc=ns(),Fr=yr(),me="|",Xc="/",Zc="",B=" ",ut="(\\s+)",xe=":",rs=";",as=",",Dr="and",ed=";and",td=",and",id="and;",nd="and,",E="is",sd="are",S="the",od="of",Mr="for",rd="to",Lr="from",ad="till",ld="between",_="in",J="on",K="at",Ha="up",va="down",hd="left",ud="right",A="with",Ei="by",md=["with","next"],cd="next",Ee="before",Vr="after",dd="beside",gd="'",Wa='"',fd=["measure","numbers"],ls="measures",le="measure",pd="above",ka="below",Pd="over",vs="under",Td="is under",Cd="lyrics",it="stave",nt="staff",bd="compress",Od="stretch",Hd=[["stave"],["stave;"],["stave,"],["staff"],["staff;"],["staff,"]],vd=[["without","opening","bar","line"],["without","start","bar","line"],["without","opening","barline"],["without","start","barline"],["starts","without","bar","line"],["opens","without","bar","line"],["starts","without","barline"],["opens","without","barline"],["with","no","opening","bar","line"],["with","no","start","bar","line"],["with","no","opening","barline"],["with","no","start","barline"],["starts","with","no","bar","line"],["opens","with","no","bar","line"],["starts","with","no","barline"],["opens","with","no","barline"]],Wd=[["no","opening","bar","line"],["no","start","bar","line"],["no","opening","barline"],["no","start","barline"]],kd=["starts","begins","opens"],Nd=["closes","finishes","ends"],Na="opening",wa="start",Ia="closing",wd=[["with","repeat","sign"],["with","colon"]],Id=[["repeat","sign"],["colon"]],$d=[["at","the","start"],["at","start"]],Bd=[["at","the","end"],["at","end"]],yd=[["at","the","start","of","the","measure"],["at","the","start","of","measure"],["at","start","of","the","measure"],["at","start","of","measure"]],Ad=[["at","the","end","of","the","measure"],["at","the","end","of","measure"],["at","end","of","the","measure"],["at","end","of","measure"]],xd=[["with","multi","measure","rest"],["with","measure","rest"]],Fd=[["multi","measure","rest"],["measure","rest"]],Dd="time",Qt="times",Md="color",Ld="colour",Vd=[["of","prev.","beat"],["of","prev","beat"],["of","previous","beat"]],Rd=[["of","prev.","beats"],["of","prev","beats"],["of","previous","beats"]],jd=[["with","simile","of","prev.","measure"],["with","simile","of","prev","measure"],["with","simile","of","previous","measure"],["with","repeat","of","prev.","measure"],["with","repeat","of","prev","measure"],["with","repeat","of","previous","measure"],["with","simile","for","prev.","measure"],["with","simile","for","prev","measure"],["with","simile","for","previous","measure"],["with","repeat","for","prev.","measure"],["with","repeat","for","prev","measure"],["with","repeat","for","previous","measure"]],Sd=[["with","simile","of","2","prev.","measures"],["with","simile","of","2","prev","measures"],["with","simile","of","2","previous","measures"],["with","repeat","of","2","prev.","measures"],["with","repeat","of","2","prev","measures"],["with","repeat","of","2","previous","measures"],["with","simile","of","two","prev.","measures"],["with","simile","of","two","prev","measures"],["with","simile","of","two","previous","measures"],["with","repeat","of","two","prev.","measures"],["with","repeat","of","two","prev","measures"],["with","repeat","of","two","previous","measures"],["with","simile","for","2","prev.","measures"],["with","simile","for","2","prev","measures"],["with","simile","for","2","previous","measures"],["with","repeat","for","2","prev.","measures"],["with","repeat","for","2","prev","measures"],["with","repeat","for","2","previous","measures"],["with","simile","for","two","prev.","measures"],["with","simile","for","two","prev","measures"],["with","simile","for","two","previous","measures"],["with","repeat","for","two","prev.","measures"],["with","repeat","for","two","prev","measures"],["with","repeat","for","two","previous","measures"]],Ed=[["simile","of","prev.","measure"],["simile","of","prev","measure"],["simile","of","previous","measure"],["repeat","of","prev.","measure"],["repeat","of","prev","measure"],["repeat","of","previous","measure"],["simile","for","prev.","measure"],["simile","for","prev","measure"],["simile","for","previous","measure"],["repeat","for","prev.","measure"],["repeat","for","prev","measure"],["repeat","for","previous","measure"]],qd=[["simile","of","2","prev.","measures"],["simile","of","2","prev","measures"],["simile","of","2","previous","measures"],["repeat","of","2","prev.","measures"],["repeat","of","2","prev","measures"],["repeat","of","2","previous","measures"],["simile","of","two","prev.","measures"],["simile","of","two","prev","measures"],["simile","of","two","previous","measures"],["repeat","of","two","prev.","measures"],["repeat","of","two","prev","measures"],["repeat","of","two","previous","measures"],["simile","for","2","prev.","measures"],["simile","for","2","prev","measures"],["simile","for","2","previous","measures"],["repeat","for","2","prev.","measures"],["repeat","for","2","prev","measures"],["repeat","for","2","previous","measures"],["simile","for","two","prev.","measures"],["simile","for","two","prev","measures"],["simile","for","two","previous","measures"],["repeat","for","two","prev.","measures"],["repeat","for","two","prev","measures"],["repeat","for","two","previous","measures"]],Ud="new",ue="line",_d="lines",Jd=["bracket","brace"],mt="instrument",qi="title",Kd=["key","signature"],Gd=["time","signature"],Rr="signature",ct="c",Ui="crossed",jr="repetition",Xt="mark",We="note",Sr="instruction",Er="coda",zd="sign",Yd="segno",Qd="tempo",Xd="metronome",Zd="metro",eg=["tempo","mark"],tg=["tempo","note"],Zt="dotted",qr=["with","dot"],ei="clef",ze="voice",hs="1",Dt="2",ti="stem",_i=["on","in","at"],Ur="dot",ig="dots",ng="one",Mt="two",sg=["is","beamed"],og=["is","not","beamed"],rg=["not","beamed"],_r="beamed",ag=["with","only","one","line"],lg=["with","only","primary","line"],ii="key",Jr="text",hg=["with","parentheses"],Kr=["with","brackets"],ug="roundness",mg="convex",cg=["1","2","3","4","5","6","7","8","9","10"],dg=["is","tied","with","next"],gg=["tied","with","next"],fg=["is","tied","after"],pg=["tied","after"],Pg="tied",Tg=["is","tied","before"],Cg=["tied","before"],us=["top","middle","mid","bottom"],bg=["is","rest"],dt="rest",Og=["is","ghost"],Hg=["is","not","ghost"],vg=["not","ghost"],Gr="ghost",zr="grace",Yr="crushed",Wg=["is","grace"],kg=["is","crushed","grace"],Ng=["crushed","grace"],wg=["with","crush","line"],Ig="gliss",$g="gliss.",Bg="glissando",yg=[["with","glissando"],["with","gliss."],["with","gliss"]],Ag=["is","in","the","center"],xg=["in","the","center"],Fg=["is","centralized"],Dg=["centralized"],Mg=["is","not","in","the","center"],Lg=["not","in","the","center"],Vg=["is","not","centralized"],Rg=["not","centralized"],Ji="breath",jg="inverted",Sg="inverted",Eg=["with","wave","after"],Ie="chord",qg="letters",Qr="^",ms="octave",cs="octaves",Ug="higher",_g="lower",Jg=["with","tremolo"],Kg="tremolo",ds="repeat",Gg="simile",zg=["via","simile"],Xr="dynamic",Yg=["with","new","lyrics"],Qg=["with","new","lyric"],Xg=["with","lyrics"],Zg=["with","lyric"],ef=["with","turn"],tf="turn",nf=["with","mordent"],sf="mordent",of=["with","trill"],rf="trill",af=["with","1","stroke"],lf=["with","2","strokes"],hf=["with","3","strokes"],uf=["is","followed","by","dash"],mf=["is","followed","by","hyphen"],cf=["followed","by","dash"],df=["followed","by","hyphen"],gf=["where","underscore","starts"],ff=["where","underscore","begins"],pf=["with","underscore","starts"],Pf=["with","underscore","begins"],Tf=["underscore","starts"],Cf=["underscore","begins"],bf=["where","underscore","finishes"],Of=["where","underscore","ends"],Hf=["with","underscore","finishes"],vf=["with","underscore","ends"],Wf=["underscore","finishes"],kf=["underscore","ends"],Nf="underscore",wf=["for","each","line"],If=["for","lines","below"],$f=["for","lines"],Bf=["for","each"],Lt="comment",gs="side note",fs="side",yf=[["is","arpeggiated"],["is","arpeggio"],["arpeggiated"],["arpeggio"]],Af=["with","chord","below"],xf=["with","arrow"],Ff="arrow",Zr="slur",ps="starts",Ps="begins",Df=["starts","from"],Mf=["begins","from"],ea="finishes",ta="ends",Lf=["starts","before"],Vf=["begins","before"],Rf=["finishes","after"],jf=["ends","after"],Sf=["changes","stave"],Ef=["changes","staff"],qf=["goes","through"],Uf=["with","s","shape"],_f=["with","s-shape"],Jf=["with","sshape"],Kf=["with","left","point"],Gf=["with","right","point"],zf=["attached","to","middle","of","stem"],Yf=["attached","to","the","middle","of","the","stem"],Qf=["attached","to","note","body"],Xf=["attached","to","the","note","body"],Zf=["attached","to","note","head"],ep=["attached","to","the","note","head"],ia=["as","wave"],na=["as","waves"],tp=["as","line"],ip=["as","lines"],sa="wave",oa="tuplet",Ts="crescendo",ra="cres.",aa="cres",la="cresc.",ha="cresc",ua="diminuendo",np="dim.",sp="dim",op="volta",rp=["volta","bracket"],ap=["volta","brackets"],Cs="bracket",ma="brackets",lp=[["opens","with","bracket"],["starts","with","bracket"],["begins","with","bracket"]],ca=["with","sustain","pedal"],hp=["with","pedal"],up="pedal",mp=["after","measure"],cp="release",dp=["with","pedal","release"],gp=["with","release"],fp=["with","variable","peak"],gt="unit",bs="units",pp="sustain",Pp=["hide","the","last","measure"],Tp=["ends","with","fermata"],Cp=["fermata"],bp=["music","font"],Op=["text","font"],Hp=["chord","letters","font"],$a=zc.join(me),vp=$a.split(me),Wp=Gc.map(e=>e.split(B)),kp=Uc.map(e=>e.split(B)),Np=Yc.map(e=>e.split(B)),wp=Qc.map(e=>e.split(B)),Ip=Ta.map(e=>e.split(B)),$p=Yi.map(e=>e.split(B)),Bp=Yi.map(e=>`${wa} ${e}`.split(B)).concat(Yi.map(e=>`${Na} ${e}`.split(B))),yp=Hs.map(e=>e.split(B)),Ap=Hs.map(e=>`${Ia} ${e}`.split(B)),Ye=vp.map(e=>e.split(B)),Ki=Os.map(e=>e.split(B)),xp=Ca.map(e=>e.split(B)),Ba=["sharp","flat","natural","double sharp","double flat","demisharp","sesquisharp","demiflat","sesquiflat"],da=Ba.map(e=>e.split(B)),ga=[...ft.map(e=>e.split(B)),...ft.map(e=>["as"].concat(e.split(B)))],Fp=ba.map(e=>e.split(B)),Dp=Oa.map(e=>e.split(B)),Mp=ss(),Gi=e=>{let t=e.join(B);return/^#([a-f0-9]{3,4}|[a-f0-9]{4}(?:[a-f0-9]{2}){1,2})\b$/i.test(t)||/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.test(t)||/^rgba\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d*(?:\.\d+)?)\)$/.test(t)||Mp.indexOf(t)!==-1},Lp=e=>_c.indexOf(e.join(B).toLowerCase())!==-1,Vp=e=>Jc.indexOf(e.join(B).toLowerCase())!==-1,Rp=e=>Kc.indexOf(e.join(B).toLowerCase())!==-1,jp=["c4","a3","b4","a4"],Z=e=>!isNaN(e),fa={backgroundColor:e=>Gi(e),musicFont:e=>Lp(e),textFont:e=>Vp(e),chordLettersFont:e=>Rp(e),fontColor:e=>Gi(e),pageBorderStrokeColor:e=>Gi(e),staveLinesColor:e=>Gi(e),intervalBetweenStaveLines:e=>Z(e.join(B)),intervalBetweenStaves:e=>Z(e.join(B)),intervalBetweenPageLines:e=>Z(e.join(B)),pageLeftAndRightPadding:e=>Z(e.join(B)),pageLineMaxWidth:e=>Z(e.join(B)),pageTopPadding:e=>Z(e.join(B)),pageBottomPadding:e=>Z(e.join(B)),pageLinesTopOffset:e=>Z(e.join(B)),pageNumberOffsetFromBottomOfThePage:e=>Z(e.join(B)),titleTopOffset:e=>Z(e.join(B)),subtitleTopOffset:e=>Z(e.join(B)),leftAndRightSubtitlesTopOffset:e=>Z(e.join(B)),pageBorderStrokeWidth:e=>Z(e.join(B)),titleFontSize:e=>Z(e.join(B)),subtitleFontSize:e=>Z(e.join(B)),leftSubtitleFontSize:e=>Z(e.join(B)),rightSubtitleFontSize:e=>Z(e.join(B)),pageNumberFontSize:e=>Z(e.join(B)),instrumentTitleFontSize:e=>Z(e.join(B)),emptyMeasureWidth:e=>Z(e.join(B)),pageFormat:e=>e.length===1&&jp.indexOf(e[0])!==-1,pageHeight:e=>Z(e.join(B))},pa={defaultInstrument:e=>D(wp,e),defaultTempo:e=>ie(e)},v=(e,t)=>{if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0},D=(e,t)=>{for(let s=0;s<e.length;s++)if(v(e[s],t))return!0;return!1},H=e=>{if(typeof e!="string")return!1;let t=Number(e);return!!(Number.isInteger(t)&&t>0)},Qe=e=>e===Ha||e===va,Pa=e=>e===hd||e===ud,ni=e=>e===gd||e===Wa,Vt=e=>e===Wa,ie=(e,t=!1,s=!1)=>{if(e.length===0||e.length===1&&e[0].length===1)return!1;let r=e[0],n=e[e.length-1],o=r[0],a=n[n.length-1],i=n[n.length-2];return t?Vt(o)&&Vt(a)&&o===a:ni(o)&&ni(a)&&o===a||ni(o)&&ni(i)&&a===","&&o===i},he=e=>{let t=e.join(B);return t[t.length-1]===","?t.slice(1,t.length-2):t.slice(1,t.length-1)},Wt=e=>e===pd||e===ka||e===Pd||e===vs,zi=e=>e===ka||e===vs,ke=e=>e===it||e===nt,tt=e=>e===Ha||e===va||e===_g||e===Ug;ya.exports={punctuation:{test:e=>e.length===1&&(e[0]===as||e[0]===rs)},numbers:{test:e=>H(e[0])&&e.length===1,match:e=>[Number(e[0])]},stringHighlight:/(['"])(.+)\1/,numberHighlight:/(\d+)/,globalCommandDelimiter:{replaceAllWithEmptyString:e=>{let t=[];for(let s=0;s<e.length;s++)if(e[s].value!==ed&&e[s].value!==td&&e[s].value!==id&&e[s].value!==nd&&e[s].value!==as&&e[s].value!==rs&&e[s].value!==Dr){let r=[];for(let n=0;n<e[s].value.length;n++)e[s].value[n]!==rs&&e[s].value[n]!==as&&r.push(e[s].value[n]);r.length>0&&t.push(r.join(""))}return t}},is:{test:e=>e[0]===E&&e.length===1},verticalCorrection:{test:e=>!!(e[0]===E&&Z(e[1])&&Qe(e[2])||Z(e[0])&&Qe(e[1])),match:e=>e[0]===E?[e[1],e[2]]:[e[0],e[1]]},verticalCorrectionHighlight:/(\d*\.?\d*)(\s+)(up|down)/,horizontalCorrection:{test:e=>!!(e[0]===E&&Pa(e[1])&&e[2]===Ei&&Z(e[3])||Pa(e[0])&&e[1]===Ei&&Z(e[2])),match:e=>e[0]===E?[e[3],e[1]]:[e[2],e[0]]},horizontalCorrectionHighlight:/(left|right)(\s+)(by)(\s+)(\d*\.?\d*)/,styleName:{test:e=>D(kp,e),match:e=>[e.join(B)]},isIs:{test:e=>e[0]===E},styleValue:{test:(e,t)=>fa[t]?fa[t](e):!1,match:e=>[e.join(B)]},midiSettingName:{test:e=>D(Np,e),match:e=>[e.join(B)]},midiSettingValue:{test:(e,t)=>pa[t]?pa[t](e):!1,match:e=>[e.join(B)]},pageMeta:{test:e=>{let t=e.indexOf(E);return t===-1?!1:!!(D(Wp,e.slice(0,t))&&ie(e.slice(t+1)))},match:e=>{let t=e.indexOf(E),s=e.slice(0,t).join(B),r=he(e.slice(t+1));return[s,r]}},measureNumbers:{test:e=>v(e,fd)},measureNumbersHighlight:/measure(\s+)numbers/,applicationOfMeasureNumbers:{test:e=>e[0]===Mr&&e[e.length-1]===ls&&D(Ip,e.slice(1,e.length-1)),match:e=>[e.slice(1,e.length-1).join(B)]},applicationOfMeasureNumbersHighlight:new RegExp(`(${Ta.join(me)}) measures`.replaceAll(B,ut)),measure:{test:e=>e[0]===le&&e.length===1},measureHighlight:le,measures:{test:e=>e[0]===ls&&e.length===1},measuresHighlight:ls,lyricsPosition:{test:e=>e[0]!==Cd?!1:e.length===3?Wt(e[2])&&(e[1]===E||e[1]===sd):e.length===2?Wt(e[1]):!1},staveIndex:{test:e=>e.length===3?e[0]===S&&ke(e[1])&&H(e[2]):e.length===2?ke(e[0])&&H(e[1]):!1,match:e=>{if(e.length===3)return[e[2]];if(e.length===2)return[e[1]]}},indexOfStave:{test:e=>e.length===3?e[0]===S&&H(e[1])&&ke(e[2]):e.length===2?H(e[0])&&ke(e[1]):!1,match:e=>{if(e.length===3)return[e[1]];if(e.length===2)return[e[0]]}},staveIndexHighlight:/(((stave|staff)((\w|\s)+\w))|(((\w|\s)+\s)(stave|staff)))/,measureIndexHighlight:/(((measure)((\w|\s)+\w))|(((\w|\s)+\s)(measure)))/,withoutStartBarLine:{test:e=>D(vd,e)},withoutStartBarLineHighlight:/without(\s+)(opening|start)(\s+)(bar(\s+)line|barline)/,noStartBarLine:{test:e=>D(Wd,e)},noStartBarLineHighlight:/no(\s+)(opening|start)(\s+)(bar(\s+)line|barline)/,opensWithBarLine:{test:e=>kd.indexOf(e[0])!==-1&&e[1]===A&&D($p,e.slice(2)),match:e=>[e.slice(2).join(B)]},openingBarLine:{test:e=>D(Bp,e),match:e=>[e.slice(1).join(B)]},closesWithBarLine:{test:e=>Nd.indexOf(e[0])!==-1&&e[1]===A&&D(yp,e.slice(2)),match:e=>[e.slice(2).join(B)]},closingBarLine:{test:e=>D(Ap,e),match:e=>[e.slice(1).join(B)]},openingBarLineHighlight:new RegExp(`((${wa}|${Na}) )?(${Yi.join(me)})`.replaceAll(B,ut)),closingBarLineHighlight:new RegExp(`(${Ia} )?(${Hs.join(me)})`.replaceAll(B,ut)),withRepeatSign:{test:e=>D(wd,e)},repeatSign:{test:e=>D(Id,e)},withRepeatSignHighlight:/((repeat(\s+)sign)|colon)/,atTheStart:{test:e=>D($d,e)},atTheStartHighlight:/(at(\s+))?(the(\s+))?start/,atTheEnd:{test:e=>D(Bd,e)},atTheEndHighlight:/(at(\s+))?(the(\s+))?end/,atTheStartOfTheMeasure:{test:e=>D(yd,e)},atTheStartOfTheMeasureHighlight:/(at(\s+))?(the(\s+))?start((\s+)of)?((\s+)the)?((\s+)measure)?/,atTheEndOfTheMeasure:{test:e=>D(Ad,e)},atTheEndOfTheMeasureHighlight:/(at(\s+))?(the(\s+))?end((\s+)of)?((\s+)the)?((\s+)measure)?/,withMeasureRest:{test:e=>D(xd,e)},measureRest:{test:e=>D(Fd,e)},measureRestHighlight:/(multi\s+)?measure(\s+)rest/,multiMeasureRestCount:{test:e=>H(e[0])&&e[1]===Qt,match:e=>[e[0]]},ofPreviousBeat:{test:e=>D(Vd,e)},ofPreviousBeats:{test:e=>D(Rd,e)},measureWithSimileOfPreviousMeasure:{test:e=>D(jd,e)},measureWithSimileOfTwoPreviousMeasures:{test:e=>D(Sd,e)},simileOfPreviousMeasure:{test:e=>D(Ed,e)},simileOfTwoPreviousMeasures:{test:e=>D(qd,e)},simileHighlight:/(simile|repeat)/,previousMeasureHighlight:/prev(.|ious)?(\s+)measure/,twoPreviousMeasuresHighlight:/(two|2)(\s+)prev(.|ious)?(\s+)measures/,simileCount:{test:e=>H(e[0])&&e[1]===Qt,match:e=>[e[0]]},new:{test:e=>e[0]===Ud},line:{test:e=>e[0]===ue},newHighlight:/new(\s+)/,lineHighlight:ue,crossStaveConnection:{test:e=>Jd.indexOf(e[0])!==-1},crossStaveConnectionHighlight:/(bracket|brace)/,to:{test:e=>e[0]===rd&&e.length===1},from:{test:e=>e[0]===Lr&&e.length===1},for:{test:e=>e[0]===Mr&&e.length===1},of:{test:e=>e[0]===od&&e.length===1},till:{test:e=>e[0]===ad&&e.length===1},stave:{test:e=>ke(e[0])&&e.length===1},staveWithAndWithoutDelimeter:{test:e=>D(Hd,e)},staveHighlight:/stave|staff/,instrumentTitle:{test:e=>e[0]===mt&&e[1]===qi&&e[2]===E&&ie(e.slice(3))||e[0]===mt&&e[1]===qi&&ie(e.slice(2))||e[0]===mt&&e[1]===E&&ie(e.slice(2))||e[0]===mt&&ie(e.slice(1)),match:e=>{if(e[0]===mt&&e[1]===qi&&e[2]===E){let t=e.slice(3);return[he(t)]}if(e[0]===mt&&e[1]===qi){let t=e.slice(2);return[he(t)]}if(e[0]===mt&&e[1]===E){let t=e.slice(2);return[he(t)]}if(e[0]===mt){let t=e.slice(1);return[he(t)]}}},instrumentTitleHighlight:/instrument( title)?/,between:{test:e=>e[0]===ld&&e.length===1},and:{test:e=>e[0]===Dr&&e.length===1},keySignature:{test:e=>v(e,Kd)},keySignatureHighlight:/key(\s+)signature/,keySignatureName:{test:e=>e[0]===E?D(Ye,e.slice(1)):D(Ye,e),match:e=>e[0]===E?[e.slice(1).join(B)]:[e.join(B)]},keySignatureNameHighlight:new RegExp(`(${$a})`.replaceAll(" ","(\\s+)")),timeSignature:{test:e=>v(e,Gd)},timeSignatureHighlight:/time(\s+)signature/,color:{test:e=>e.indexOf(Md)!==-1||e.indexOf(Ld)!==-1},musicFont:{test:e=>v(e,bp)},textFont:{test:e=>v(e,Op)},chordLettersFont:{test:e=>v(e,Hp)},timeSignatureValue:{test:e=>{if(e[0]===E){if(e[1]===ct||e[1]===Ui&&e[2]===ct)return!0;if(e[1]){let t=e[1].split(xe);if(t.length===2&&H(t[0])&&H(t[1]))return!0}}if(e[0]===ct||e[0]===Ui&&e[1]===ct)return!0;if(e[0]){let t=e[0].split(xe);if(t.length===2&&H(t[0])&&H(t[1]))return!0}return!1},match:e=>{if(e[0]===E){if(e[1]===ct)return["c"];if(e[1]===Ui&&e[2]===ct)return["crossed c"];let s=e[1].split(xe);if(s.length===2&&H(s[0])&&H(s[1]))return[s[0],s[1]]}if(e[0]===ct)return["c"];if(e[0]===Ui&&e[1]===ct)return["crossed c"];let t=e[0].split(xe);if(t.length===2&&H(t[0])&&H(t[1]))return[t[0],t[1]]}},timeSignatureValueHighlight:new RegExp("((\\d+:\\d+)|crossed c|c)".replaceAll(B,ut)),repetitionNote:{test:e=>e[2]===E?e[0]===jr&&(e[1]===Xt||e[1]===We||e[1]===Sr)&&ie(e.slice(3)):e[0]===jr&&(e[1]===Xt||e[1]===We||e[1]===Sr)&&ie(e.slice(2)),match:e=>{if(e[2]===E){let r=e.slice(3);return[he(r)]}let t=e.slice(2);return[he(t)]}},repetitionNoteHighlight:/repetition(\s+)(mark|note|instruction)/,coda:{test:e=>e[0]===Er},codaHighlight:Er,sign:{test:e=>e[0]===zd||e[0]===Yd},signHighlight:/sign|segno/,tempoOrMetronome:{test:e=>e[0]===Qd||e[0]===Xd||e[0]===Zd},markOrNote:{test:e=>e[0]===Xt||e[0]===We},tempoMarkOrTempoNote:{test:e=>v(e,eg)||v(e,tg)},tempoMarkHighlight:/(tempo(\s+)mark|tempo(\s+)note|tempo|metronome|metro)/,tempoMarkWithDotHighlight:{test:e=>Fr(e)===qr},tempoMarkDottedHighlight:{test:e=>Fr(e)===Zt},tempoMarkText:{test:e=>e[0]===E?ie(e.slice(1)):ie(e),match:e=>e[0]===E?[he(e.slice(1))]:[he(e)]},tempoDurationPart:new RegExp(`(${xr.join(me)}|dotted|with dot)`),tempoDurationPartHighlight:new RegExp(`(${xr.join(me)}|dotted|with dot)`,"g"),tempoDurationPartIsDot:{test:e=>e[0]===Zt||v(e,qr)},withClef:{test:e=>e[0]===A&&e[e.length-1]===ei&&D(Ki,e.slice(1,e.length-1)),match:e=>[e.slice(1,e.length-1).join(B)]},clef:{test:e=>e[e.length-1]===ei&&D(Ki,e.slice(0,e.length-1)),match:e=>[e.slice(0,e.length-1).join(B)]},clefHighlight:new RegExp(`(${Os.join(me)}) clef`.replaceAll(B,ut)),voice:{test:e=>e[0]===ze},voiceHighlight:ze,noteWithDurationAndOctave:{test:e=>e.length===1?os.indexOf(e[0][0])!==-1&&(!e[0][1]||H(e[0][1])&&!e[0][2]):e.length===2?ht.indexOf(e[0])!==-1&&os.indexOf(e[1][0])!==-1&&(!e[1][1]||H(e[1][1])&&!e[1][2]):!1,match:e=>{if(e.length===1)return[null,e[0][0],e[0][1]];if(e.length===2)return[e[0],e[1][0],e[1][1]]}},noteWithDurationAndOctaveHighlight:new RegExp(`(${ht.join(me)})?( *)(${os.join(me)})(\\d)?`),stemDirection:{test:e=>e[0]===A&&e[1]===ti&&Qe(e[2])||e[0]===ti&&Qe(e[1]),match:e=>e[0]===A?[e[2]]:[e[1]]},directionOfStem:{test:e=>e[0]===A&&Qe(e[1])&&e[2]===ti||Qe(e[0])&&e[1]===ti,match:e=>{if(Qe(e[1]))return[e[1]];if(Qe(e[0]))return[e[0]]}},stemHighlight:ti,stavePosition:{test:e=>e[0]===E&&(_i.indexOf(e[1])!==-1&&e[2]===S&&Yt.indexOf(e[3])!==-1&&ke(e[4])||_i.indexOf(e[1])!==-1&&Yt.indexOf(e[2])!==-1&&ke(e[3]))||_i.indexOf(e[0])!==-1&&e[1]===S&&Yt.indexOf(e[2])!==-1&&ke(e[3])||_i.indexOf(e[0])!==-1&&Yt.indexOf(e[1])!==-1&&ke(e[2]),match:e=>{if(ke(e[3]))return[e[2]];if(ke(e[2]))return[e[1]]}},stavePositionHighlight:new RegExp(`(${Yt.join(me)})(\\s+)(stave|staff)`),withNumberOfDots:{test:e=>e[0]===A&&e[1]&&e[1].length===1&&H(e[1])&&e[2]===ig,match:e=>[e[1]]},withNumberOfDotsHighlight:/(with\s+)(((\w|\s)+)(\s+)dots)/,dotted:{test:e=>e[0]===E&&e[1]===Zt||e[0]===Zt},dottedHighlight:Zt,withDot:{test:e=>e[0]===A&&(e[1]===hs||e[1]===ng)&&e[2]===Ur||e[0]===A&&e[1]===Ur},withDotHighlight:/( (1|one))? dot/,beamed:{test:e=>v(e,sg)||e[0]===_r},beamedHighlight:_r,notBeamed:{test:e=>v(e,og)||v(e,rg)},withNext:{test:e=>v(e,md)},withNextHighlight:cd,withOnlyPrimaryLine:{test:e=>v(e,ag)||v(e,lg)},withOnlyPrimaryLineHighlight:/only(\s+)(primary|one)?(\s+)line/,withNoteKey:{test:e=>e[0]===A&&D(xp,e.slice(1,e.length-1))&&e[e.length-1]===ii||D(da,e),match:e=>D(da,e)?[e.join(B)]:[e.slice(1,e.length-1).join(B)]},withNoteKeyHighlight:new RegExp(`((${Ca.join(me)})(\\s+)key)|(${Ba.join(me)})`),withParentheses:{test:e=>v(e,Kr)||v(e,hg)},withParenthesesHighlight:/(parentheses|brackets)/,withText:{test:e=>e[0]===A&&e[1]===Jr&&ie(e.slice(2))||e[0]===A&&ie(e.slice(1)),match:e=>{if(ie(e.slice(2)))return[he(e.slice(2))];if(ie(e.slice(1)))return[he(e.slice(1))]}},withTextHighlight:Jr,direction:{test:e=>e[0]===E&&Qe(e[1])||Qe(e[0])&&e.length===1,match:e=>e[0]===E?[e[1]]:[e[0]]},beside:{test:e=>e[0]===dd&&e.length===1},aboveBelowOverUnderStaveLines:{test:e=>e[0]===E&&Wt(e[1])&&ke(e[2])||Wt(e[0])&&ke(e[1]),match:e=>e[0]===E?[e[1]]:[e[0]]},belowUnderStaveLines:{test:e=>e[0]===E&&zi(e[1])&&ke(e[2])||zi(e[0])&&ke(e[1])},belowUnder:{test:e=>e[0]===E&&zi(e[1])||zi(e[0])},withRoundness:{test:e=>e[0]===A&&(e[1]===ug||e[1]===mg)&&cg.indexOf(e[2])!==-1,match:e=>[e[2]]},roundnessHighlight:/(roundness|convex)(\s+)(10|[1-9])/,tiedWithNext:{test:e=>v(e,dg)||v(e,gg)},tiedBefore:{test:e=>v(e,Tg)||v(e,Cg)},tiedAfter:{test:e=>v(e,fg)||v(e,pg)},tiedHighlight:Pg,topMidBottomRest:{test:e=>ht.indexOf(e[0])!==-1&&us.indexOf(e[1])!==-1&&e[2]===dt||ht.indexOf(e[0])!==-1&&e[1]===dt||us.indexOf(e[0])!==-1&&e[1]===dt||e[0]===dt,match:e=>{if(e[2]===dt)return[e[0],e[1]];if(e[1]===dt){if(ht.indexOf(e[0])!==-1)return[e[0]];if(us.indexOf(e[0])!==-1)return[null,e[0]]}return[null,null]}},topMidBottomRestHighlight:new RegExp(`(${ht.join(me)})?( *)((top|middle|mid|bottom)(\\s+))?rest`),isRest:{test:e=>v(e,bg)},rest:{test:e=>e[0]===dt&&e.length===1},restHighlight:dt,isGhost:{test:e=>v(e,Og)||e[0]===Gr},ghostHighlight:Gr,isNotGhost:{test:e=>v(e,Hg)||v(e,vg)},isGrace:{test:e=>v(e,kg)||v(e,Ng)||v(e,Wg)||e[0]===zr,match:e=>[e[0]===Yr||e[1]===Yr]},graceHighlight:zr,withCrushLine:{test:e=>v(e,wg)},crushLineHighlight:/crush\s+line/,measureNumber:{test:e=>e[0]===le&&H(e[1]),match:e=>[e[1]]},numberOfMeasure:{test:e=>H(e[0])&&e[1]===le,match:e=>[e[0]]},isCentralized:{test:e=>v(e,Ag)||v(e,xg)||v(e,Fg)||v(e,Dg)},isNotCentralized:{test:e=>v(e,Mg)||v(e,Lg)||v(e,Vg)||v(e,Rg)},withBreathMarkBefore:{test:e=>e[0]===A&&e[1]===Ji&&e[2]===Xt&&D(ga,e.slice(3,e.length-1))&&e[e.length-1]===Ee||e[0]===A&&e[1]===Ji&&D(ga,e.slice(2,e.length-1))&&e[e.length-1]===Ee||e[0]===A&&e[1]===Ji&&e[2]===Xt&&e[3]===Ee||e[0]===A&&e[1]===Ji&&e[2]===Ee,match:e=>{let t=e.join(B);for(let s=0;s<ft.length;s++)if(t.includes(ft[s]))return[ft[s]];return[ft[0]]}},withBreathMarkBeforeHighlight:new RegExp(`breath( mark)?( (${ft.join(me)}))?|(${ft.join(me)})`.replaceAll(" ",ut),"g"),withKeySignatureBefore:{test:e=>e[0]===A&&e[1]===ii&&e[2]===Rr&&D(Ye,e.slice(3,e.length-1))&&e[e.length-1]===Ee||e[0]===A&&D(Ye,e.slice(1,e.length-1))&&e[e.length-1]===Ee,match:e=>{let t=e.slice(3,e.length-1);if(D(Ye,t))return[t.join(B)];let s=e.slice(1,e.length-1);if(D(Ye,s))return[s.join(B)]}},withClefBefore:{test:e=>e[0]===A&&D(Ki,e.slice(1,e.length-2))&&e[e.length-2]===ei&&e[e.length-1]===Ee,match:e=>[e.slice(1,e.length-2).join(B)]},withClefAndKeySignatureBefore:{test:e=>{let t=e.indexOf(ei);return t===-1?!1:e[0]===A&&D(Ki,e.slice(1,t))&&e[t+1]===ii&&e[t+2]===Rr&&D(Ye,e.slice(t+3,e.length-1))&&e[e.length-1]===Ee||e[0]===A&&Os.indexOf(e.slice(1,t).join(B))!==-1&&D(Ye,e.slice(t+1,e.length-1))&&e[e.length-1]===Ee},match:e=>{let t=e.indexOf(ei),s=e.slice(1,t).join(B),r=e.slice(t+3,e.length-1);if(D(Ye,r))return[s,r.join(B)];let n=e.slice(t+1,e.length-1);if(D(Ye,n))return[s,n.join(B)]}},withArticulation:{test:e=>e[0]===A&&D(Fp,e.slice(1)),match:e=>[e.slice(1).join(B)]},withArticulationHighlight:new RegExp(`(${ba.join(me)})`.replaceAll(B,ut)),withTurn:{test:e=>v(ef,e)},withTurnHighlight:tf,withMordent:{test:e=>v(nf,e)},withMordentHighlight:sf,withTrill:{test:e=>v(of,e)},withTrillHighlight:rf,withOrnamentKeyAboveBelowOverUnder:{test:e=>{let t=e.indexOf(ii);return t===-1?!1:e[0]===A&&D(Dp,e.slice(1,t))&&Wt(e[t+1])},match:e=>{let t=e.indexOf(ii);return[e.slice(1,t).join(B),e[t+1]]}},ornamentKeyHighlight:new RegExp(`(${Oa.join(me)}) key`.replaceAll(B,ut)),isInverted:{test:e=>e[0]===Sg&&e.length===1||v(e,jg)},withWaveAfter:{test:e=>v(e,Eg)},waveHighlight:sa,withChord:{test:e=>{let t=e.slice(2);if(e[0]===A&&e[1]===Ie&&ie(t)){let r=he(t).split(Xc);if(r.length===1||r.length===2){let n=r[0].split(Qr);if(n.length===1||n.length===2){if(r.length===2){let o=r[1].split(Qr);return o.length===1||o.length===2}return!0}return!1}return!1}return!1},match:e=>{let t=e.slice(2);return[he(t)]}},withChordHighlight:Ie,withChordWithDurationHighlight:new RegExp(`(${ht.join(me)})?( *)chord`),isOctaveOrTwoOctavesHigherOrLower:{test:e=>e[0]===E&&(e[1]===Dt||e[1]===Mt)&&e[2]===cs&&tt(e[3])&&e.length===4||(e[0]===Dt||e[0]===Mt)&&e[1]===cs&&tt(e[2])&&e.length===3||e[0]===E&&e[1]===ms&&tt(e[2])&&e.length===3||e[0]===ms&&tt(e[1])&&e.length===2,match:e=>{if(e[1]===Dt||e[1]===Mt)return[e[1],e[3]];if(e[0]===Dt||e[0]===Mt)return[e[0],e[2]];if(tt(e[2]))return[null,e[2]];if(tt(e[1]))return[null,e[1]]}},isOctaveOrTwoOctavesHigherOrLowerHighlight:/((2|two)(\s+))?octave(s)?/,octaveOrTwoOctavesHigherOrLower:{test:e=>(e[0]===Dt||e[0]===Mt)&&e[1]===cs&&tt(e[2])&&e.length===3||e[0]===ms&&tt(e[1])&&e.length===2,match:e=>{if(e[0]===Dt||e[0]===Mt)return[e[0],e[2]];if(tt(e[1]))return[null,e[1]]}},withTremolo:{test:e=>v(e,Jg)},withTremoloHighlight:Kg,withNumberOfStrokes:{test:e=>v(e,af)||v(e,lf)||v(e,hf),match:e=>[e[1]]},withNumberOfStrokesHighlight:/(\w+)(\s+)stroke(s)?/,numberOfTimes:{test:e=>e[0]===hs&&e[1]===Dd||e[0]!==hs&&H(e[0])&&e[1]===Qt,match:e=>[e[0]]},numberOfTimesHighlight:/^(\d+) time(s)?$/,repeat:{test:e=>e[0]===ds},repeatHighlight:ds,viaSimile:{test:e=>v(e,zg)},withDynamic:{test:e=>e[0]===A&&e[1]===Xr&&ie(e.slice(2)),match:e=>[he(e.slice(2))]},withDynamicHighlight:Xr,withLyrics:{test:e=>v(e,Yg)||v(e,Qg)||v(e,Xg)||v(e,Zg)},lyricsHighlight:/lyric(s)?/,textValue:{test:e=>ie(e),match:e=>[he(e)]},followedByDash:{test:e=>v(e,uf)||v(e,mf)||v(e,cf)||v(e,df)},dashHighlight:/(dash|hyphen)/,underscoreStarts:{test:e=>v(e,gf)||v(e,ff)||v(e,pf)||v(e,Pf)||v(e,Tf)||v(e,Cf)},underscoreFinishes:{test:e=>v(e,bf)||v(e,Of)||v(e,Hf)||v(e,vf)||v(e,Wf)||v(e,kf)},underscoreHighlight:Nf,forEachLine:{test:e=>v(e,wf)},forLinesBelow:{test:e=>v(e,If)},forLines:{test:e=>v(e,$f)},forEachLineHighlight:/each(\s+)line/,forEach:{test:e=>v(e,Bf)},commentStartsAndEndsWithText:{test:e=>{if(!e||!e[0]||!e[0].startsWith(Lt)&&!e[0].startsWith(fs))return!1;let s=e.join(B).split(xe);return(s[0]===Lt||s[0]===gs)&&s[1]&&ie([s[1].slice(1)],!0)},match:e=>{let s=e.join(B).split(xe);return[s[1][0],he([s[1].slice(1)])]}},commentStartsWithText:{test:e=>{if(!e||!e[0]||!e[0].startsWith(Lt)&&!e[0].startsWith(fs))return!1;let s=e.join(B).split(xe);return(s[0]===Lt||s[0]===gs)&&s[1]&&ni(s[1][0])},match:e=>{let s=e.join(B).split(xe);return[s[1][0],s[1].slice(1)]}},comment:{test:e=>{if(!e||!e[0]||!e[0].startsWith(Lt)&&!e[0].startsWith(fs))return!1;let s=e.join(B).split(xe);return(s[0]===Lt||s[0]===gs)&&(s[1]===void 0||s[1].trimStart()===Zc)}},column:{test:e=>e[0]===xe},commentTextStartsAndEnds:{test:e=>ie(e,!0),match:e=>{let t=e.join(B);return[t[0],t.slice(1,t.length-1)]}},commentTextStarts:{test:e=>{let s=e.join(B).split(xe);return s.length===1?Vt(s[0][0]):s.length>1?Vt(s[1][0]):!1},match:e=>{let s=e.join(B).split(xe);if(s.length===1)return[s[0][0],s[0].slice(1)];if(s.length>1)return[s[1][0],s[1].slice(1)]}},commentTextEnds:{test:e=>{let t=e.join(B);return Vt(t[t.length-1])},match:e=>{let t=e.join(B);return[t.slice(0,t.length-1),t[t.length-1]]}},commentQuote:{test:e=>Vt(e[0])&&e.length===1},anything:{test:e=>e.length>0,match:e=>[e.join(B)]},chordWithDuration:{test:e=>e[0]===Ie&&e.length===1?!0:ht.indexOf(e[0])!==-1&&e[1]===Ie,match:e=>e[0]===Ie?[null]:[e[0]]},letters:{test:e=>e[0]===qg},noteIndex:{test:e=>e[0]===S&&e[1]===We&&H(e[2])||e[0]===We&&H(e[1]),match:e=>{if(H(e[2]))return[e[2]];if(H(e[1]))return[e[1]]}},indexOfNote:{test:e=>e[0]===S&&H(e[1])&&e[2]===We||H(e[0])&&e[1]===We,match:e=>{if(H(e[1]))return[e[1]];if(H(e[0]))return[e[0]]}},noteIndexHighlight:/(((note)((\w|\s)+\w))|(((\w|\s)+\s)(note)))/,arpeggiated:{test:e=>D(yf,e)},arpeggiatedHighlight:/arpeggiated|arpeggio/,withChordBelow:{test:e=>v(e,Af)},chordHighlight:Ie,withArrow:{test:e=>v(e,xf)},arrowHighlight:Ff,positionPreposition:/((in|on|at|with)(\s+))?((\w|\s)+)/g,unitPosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&(e[2]===gt||e[2]===Ie||e[2]===We)&&H(e[3])||e[0]===S&&(e[1]===gt||e[1]===Ie||e[1]===We)&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&(e[1]===gt||e[1]===Ie||e[1]===We)&&H(e[2])||(e[0]===gt||e[0]===Ie||e[0]===We)&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},positionOfUnit:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&(e[3]===gt||e[3]===Ie||e[3]===We)||e[0]===S&&H(e[1])&&(e[2]===gt||e[2]===Ie||e[2]===We)||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&(e[2]===gt||e[2]===Ie||e[2]===We)||H(e[0])&&(e[1]===gt||e[1]===Ie||e[1]===We),match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},unitLinePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&e[2]===ue&&H(e[3])||e[0]===S&&e[1]===ue&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===ue&&H(e[2])||e[0]===ue&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},linePositionOfUnit:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&e[3]===ue||e[0]===S&&H(e[1])&&e[2]===ue||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&e[2]===ue||H(e[0])&&e[1]===ue,match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},unitMeasurePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&e[2]===le&&H(e[3])||e[0]===S&&e[1]===le&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===le&&H(e[2])||e[0]===le&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},measurePositionOfUnit:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&e[3]===le||e[0]===S&&H(e[1])&&e[2]===le||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&e[2]===le||H(e[0])&&e[1]===le,match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},unitStavePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&(e[2]===it||e[2]===nt)&&H(e[3])||e[0]===S&&(e[1]===it||e[1]===nt)&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&(e[1]===it||e[1]===nt)&&H(e[2])||(e[0]===it||e[0]===nt)&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},stavePositionOfUnit:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&(e[3]===it||e[3]===nt)||e[0]===S&&H(e[1])&&(e[2]===it||e[2]===nt)||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&(e[2]===it||e[2]===nt)||H(e[0])&&(e[1]===it||e[1]===nt),match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},unitVoicePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&e[2]===ze&&H(e[3])||e[0]===S&&e[1]===ze&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===ze&&H(e[2])||e[0]===ze&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},voicePositionOfUnit:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&e[3]===ze||e[0]===S&&H(e[1])&&e[2]===ze||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&e[2]===ze||H(e[0])&&e[1]===ze,match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},pageLinePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&e[2]===ue&&H(e[3])||e[0]===S&&e[1]===ue&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===ue&&H(e[2])||e[0]===ue&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},positionOfPageLine:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&e[3]===ue||e[0]===S&&H(e[1])&&e[2]===ue||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&e[2]===ue||H(e[0])&&e[1]===ue,match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},measurePosition:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&e[2]===le&&H(e[3])||e[0]===S&&e[1]===le&&H(e[2])||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===le&&H(e[2])||e[0]===le&&H(e[1]),match:e=>H(e[3])?[e[3]]:H(e[2])?[e[2]]:[e[1]]},positionOfMeasure:{test:e=>(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&e[1]===S&&H(e[2])&&e[3]===le||e[0]===S&&H(e[1])&&e[2]===le||(e[0]===_||e[0]===J||e[0]===K||e[0]===A)&&H(e[1])&&e[2]===le||H(e[0])&&e[1]===le,match:e=>H(e[2])?[e[2]]:H(e[1])?[e[1]]:[e[0]]},slur:{test:e=>e[0]===Zr},slurHighlight:Zr,starts:{test:e=>(e[0]===ps||e[0]===Ps)&&e.length===1},startsFrom:{test:e=>v(e,Df)||v(e,Mf)},finishes:{test:e=>(e[0]===ea||e[0]===ta)&&e.length===1},startsBefore:{test:e=>v(e,Lf)||v(e,Vf)},before:{test:e=>e[0]===Ee&&e.length===1},finishesAfter:{test:e=>v(e,Rf)||v(e,jf)},after:{test:e=>e[0]===Vr&&e.length===1},changesStaveOrGoesThrough:{test:e=>v(e,Sf)||v(e,Ef)||v(e,qf)},withSShape:{test:e=>v(e,Uf)||v(e,_f)||v(e,Jf)},aboveBelowOverUnder:{test:e=>e[0]===E&&Wt(e[1])||Wt(e[0])&&e.length===1,match:e=>e[0]===E?[e[1]]:[e[0]]},leftPoint:{test:e=>v(e,Kf)},rightPoint:{test:e=>v(e,Gf)},attachedToMiddleOfStem:{test:e=>v(e,zf)||v(e,Yf)},attachedToNoteBody:{test:e=>v(e,Qf)||v(e,Xf)||v(e,Zf)||v(e,ep)},glissando:{test:e=>e[0]===Ig||e[0]===$g||e[0]===Bg},withGlissando:{test:e=>D(yg,e)},glissandoHighlight:/(glissando|gliss\.|gliss|glis\.|glis)/,asWaveLine:{test:e=>v(e,ia)||v(e,na)||v(e,tp)||v(e,ip),match:e=>v(e,ia)||v(e,na)?[sa]:[ue]},asWaveLineHighlight:/(line|wave)(s)?/,tupletWithValue:{test:e=>{if(e[0]!==oa||!e[1])return!1;let t=e[1].split(xe);return t.length===1?H(t[0]):t.length===2?H(t[0])&&H(t[1]):!1},match:e=>[e[1]]},tupletHighlight:oa,tupletValueHighlight:/((\d+)(:(\d+)))|(\d+)/,withBrackets:{test:e=>v(e,Kr)},bracketsHighlight:ma,startsWithTextValue:{test:e=>(e[0]===ps||e[0]===Ps)&&e[1]===A&&ie(e.slice(2)),match:e=>[he(e.slice(2))]},startsWithTextValueFrom:{test:e=>(e[0]===ps||e[0]===Ps)&&e[1]===A&&ie(e.slice(2,e.length-1))&&e[e.length-1]===Lr,match:e=>[he(e.slice(2,e.length-1))]},finishesWithTextValue:{test:e=>(e[0]===ea||e[0]===ta)&&e[1]===A&&ie(e.slice(2)),match:e=>[he(e.slice(2))]},crescendoOrDiminuendo:{test:e=>(e[0]===Ts||e[0]===ra||e[0]===aa||e[0]===la||e[0]===ha||e[0]===ua||e[0]===np||e[0]===sp)&&e.length===1,match:e=>e[0]===Ts||e[0]===ra||e[0]===aa||e[0]===la||e[0]===ha?[Ts]:[ua]},crescendoOrDiminuendoHighlight:/(crescendo|cres.|cres|cresc.|cresc|diminuendo|dim.|dim)/,with:{test:e=>e[0]===A&&e.length===1},repeatSimile:{test:e=>(e[0]===ds||e[0]===Gg)&&e.length===1},repeatSimileHighlight:/(repeat|simile)/,volta:{test:e=>e[0]===op&&e.length===1},voltaBrackets:{test:e=>v(e,rp)||v(e,ap)},voltaBracketsHighlight:/volta( bracket(s)?)?/,brackets:{test:e=>(e[0]===Cs||e[0]===ma)&&e.length===1},withPedal:{test:e=>v(e,ca)||v(e,hp)},withSustain:{test:e=>v(e,ca)},withSustainHighlight:pp,withPedalHighlight:up,under:{test:e=>v(e,Td)||e[0]===vs&&e.length===1},afterBefore:{test:e=>(e[0]===Ee||e[0]===Vr)&&e.length===1,match:e=>[e.join(B)]},text:{test:e=>ie(e),match:e=>[he(e)]},bracket:{test:e=>e[0]===Cs&&e.length===1},opensWithBracket:{test:e=>D(lp,e)},bracketHighlight:Cs,afterMeasure:{test:e=>v(e,mp)},release:{test:e=>e[0]===cp&&e.length===1},withRelease:{test:e=>v(e,dp)||v(e,gp)},withReleaseHighlight:/(pedal(\s+))?release/,withVariablePeak:{test:e=>v(e,fp)},withVariablePeakHighlight:/variable(\s+)peak/,lines:{test:e=>e[0]===_d&&e.length===1},linesHighlight:/lines/,somethingIsSomethingWithDelimetersHighlight:/^(.+?)(?=(is))(.+)$/m,compressUnitsByNTimes:{test:e=>{let t=e[3]*1;return e[0]===bd&&e[1]===bs&&e[2]===Ei&&t>1&&t<=5&&e[4]===Qt&&e.length===5},match:e=>[e[3]*1]},stretchUnitsByNTimes:{test:e=>{let t=e[3];return e[0]===Od&&e[1]===bs&&e[2]===Ei&&t>1&&t<=5&&e[4]===Qt&&e.length===5},match:e=>[e[3]*1]},unitsHighlight:bs,hideLastMeasure:{test:e=>v(Pp,e)},lastMeasureHighlight:/the(\s+)last(\s+)measure/,endsWithFermata:{test:e=>v(Tp,e)},fermata:{test:e=>v(Cp,e)},fermataHighlight:/fermata/}});var Rt=C((ZH,Aa)=>{"use strict";Aa.exports=(e,t)=>{if(!e)throw new Error("scenario does not exist");let s=Object.assign({},e);return s.requiredCommandProgression=t,s}});var Fa=C((ev,xa)=>{"use strict";var He=y(),Ws=Rt(),ks=e=>e.comments[e.comments.length-1],Pe=`
`;xa.exports=e=>{e["comment starts and ends with text"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>He.commentStartsAndEndsWithText.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.commentStartsAndEndsWithText.match(n),h=l[0],m=l[1];i.comments.push({text:m,startLineNumber:s,endLineNumber:s,currentLineNumber:s,startQuote:h}),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment starts with text"]={considerJoinedTokenAccumulatorWithoutCommandDelimiters:!0,prohibitedCommandProgressions:["comment starts with text","comment text starts","comment text"],condition:(t,s,r,n,o,a,i)=>He.commentStartsWithText.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.commentStartsWithText.match(n),h=l[0],m=l[1];i.comments.push({text:m,startLineNumber:s,currentLineNumber:s,startQuote:h}),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment text ends (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:(t,s,r,n,o,a,i)=>He.commentTextEnds.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.commentTextEnds.match(n)[0],h=ks(i);h.currentLineNumber!==s?h.text+=`
${l}`:h.text+=` ${l}`,h.endLineNumber=s,h.currentLineNumber=s,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["quote ends comment (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:(t,s,r,n,o,a,i)=>He.commentQuote.test(n),action:(t,s,r,n,o,a,i)=>{let l=ks(i);l.endLineNumber=s,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment text (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:(t,s,r,n,o,a,i)=>He.anything.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.anything.match(n)[0],h=ks(i);h.currentLineNumber!==s?h.text+=`
${l}`:h.text+=` ${l}`,h.currentLineNumber=s,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:1},e.comment={considerJoinedTokenAccumulatorWithoutCommandDelimiters:!0,prohibitedCommandProgressions:["comment starts with text","comment text starts","comment text"],condition:(t,s,r,n,o,a,i)=>He.comment.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment followed by column or is"]={requiredCommandProgression:"comment",onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>He.column.test(n)||He.is.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})}},e["comment text starts and ends"]={requiredCommandProgression:"comment",condition:(t,s,r,n,o,a,i)=>He.commentTextStartsAndEnds.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.commentTextStartsAndEnds.match(n),h=l[0],m=l[1];i.comments.push({text:m,startLineNumber:s,endLineNumber:s,currentLineNumber:s,startQuote:h}),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment text starts"]={requiredCommandProgression:"comment",condition:(t,s,r,n,o,a,i)=>He.commentTextStarts.test(n),action:(t,s,r,n,o,a,i)=>{let l=He.commentTextStarts.match(n),h=l[0],m=l[1];i.comments.push({text:m,startLineNumber:s,currentLineNumber:s,startQuote:h}),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Pe);n.forEach((o,a)=>{t.highlightsHtmlBuffer.push(`<span class="ch">${o}</span>`),a<n.length-1&&t.highlightsHtmlBuffer.push(Pe)})},itIsNewCommandProgressionFromLevel:0},e["comment text ends (comment text starts)"]=Ws(e["comment text ends (comment starts with text)"],"comment text starts"),e["quote ends comment (comment text starts)"]=Ws(e["quote ends comment (comment starts with text)"],"comment text starts"),e["comment text (comment text starts)"]=Ws(e["comment text (comment starts with text)"],"comment text starts")}});var Va=C((tv,La)=>{"use strict";var Da=Mn(),ce=y(),Ma=`
`,si=(e,t,s,r,n,o,a)=>{let l=ce.styleName.match(r)[0];a.lastMentionedStyleKey=Da[l],a.applyHighlighting&&a.highlightsHtmlBuffer.push(`<span class="sh">${n}</span>`)},oi=(e,t,s)=>{let n=ce.styleName.match(s)[0];e.lastMentionedStyleKey=Da[n];let o=t.lastIndexOf(Ma);o===-1?e.highlightsHtmlBuffer.push(`<span class="sh">${t}</span>`):e.highlightsHtmlBuffer.push(`${t.slice(0,o+1)}<span class="sh">${t.slice(o+1)}</span>`)},ri=(e,t,s,r,n,o,a)=>{a.applyHighlighting&&a.highlightsHtmlBuffer.push(n)},ai=(e,t,s)=>{e.highlightsHtmlBuffer.push(t)},li=(e,t,s,r,n,o,a)=>{a.customStyles[a.lastMentionedStyleKey]=ce.styleValue.match(r)[0],a.applyHighlighting&&a.highlightsHtmlBuffer.push(`<span class="svh">${n}</span>`)},hi=(e,t,s)=>{let r=t.indexOf(Ma);r===-1?e.highlightsHtmlBuffer.push(`<span class="svh">${t}</span>`):e.highlightsHtmlBuffer.push(`<span class="svh">${t.slice(0,r)}</span>${t.slice(r)}`)};La.exports=e=>{e["color style name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ce.styleName.test(n)&&ce.color.test(n),action:si,actionOnlyForHighlightingWithoutRefIds:oi,itIsNewCommandProgressionFromLevel:0},e["color style name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"color style name",condition:(t,s,r,n,o,a,i)=>ce.isIs.test(n),action:ri,actionOnlyForHighlightingWithoutRefIds:ai,itIsNewCommandProgressionFromLevel:1},e["color style value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"color style name is",condition:(t,s,r,n,o,a,i)=>ce.styleValue.test(n,i.lastMentionedStyleKey)&&r.lastOnTheLine,action:li,actionOnlyForHighlightingWithoutRefIds:hi,itIsNewCommandProgressionFromLevel:1},e["music font style name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ce.musicFont.test(n),action:si,actionOnlyForHighlightingWithoutRefIds:oi,itIsNewCommandProgressionFromLevel:0},e["music font style name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"music font style name",condition:(t,s,r,n,o,a,i)=>ce.isIs.test(n),action:ri,actionOnlyForHighlightingWithoutRefIds:ai,itIsNewCommandProgressionFromLevel:1},e["music font style value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"music font style name is",condition:(t,s,r,n,o,a,i)=>ce.styleValue.test(n,i.lastMentionedStyleKey)&&r.lastOnTheLine,action:li,actionOnlyForHighlightingWithoutRefIds:hi,itIsNewCommandProgressionFromLevel:1},e["text font style name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ce.textFont.test(n),action:si,actionOnlyForHighlightingWithoutRefIds:oi,itIsNewCommandProgressionFromLevel:0},e["text font style name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"text font style name",condition:(t,s,r,n,o,a,i)=>ce.isIs.test(n),action:ri,actionOnlyForHighlightingWithoutRefIds:ai,itIsNewCommandProgressionFromLevel:1},e["text font style value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"text font style name is",condition:(t,s,r,n,o,a,i)=>ce.styleValue.test(n,i.lastMentionedStyleKey)&&r.lastOnTheLine,action:li,actionOnlyForHighlightingWithoutRefIds:hi,itIsNewCommandProgressionFromLevel:1},e["chord letters font style name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ce.chordLettersFont.test(n),action:si,actionOnlyForHighlightingWithoutRefIds:oi,itIsNewCommandProgressionFromLevel:0},e["chord letters font style name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"chord letters font style name",condition:(t,s,r,n,o,a,i)=>ce.isIs.test(n),action:ri,actionOnlyForHighlightingWithoutRefIds:ai,itIsNewCommandProgressionFromLevel:1},e["chord letters font style value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"chord letters font style name is",condition:(t,s,r,n,o,a,i)=>ce.styleValue.test(n,i.lastMentionedStyleKey)&&r.lastOnTheLine,action:li,actionOnlyForHighlightingWithoutRefIds:hi,itIsNewCommandProgressionFromLevel:1},e["style name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ce.styleName.test(n),action:si,actionOnlyForHighlightingWithoutRefIds:oi,itIsNewCommandProgressionFromLevel:0},e["style name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"style name",condition:(t,s,r,n,o,a,i)=>ce.isIs.test(n),action:ri,actionOnlyForHighlightingWithoutRefIds:ai,itIsNewCommandProgressionFromLevel:1},e["style value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"style name is",condition:(t,s,r,n,o,a,i)=>ce.styleValue.test(n,i.lastMentionedStyleKey)&&r.lastOnTheLine,action:li,actionOnlyForHighlightingWithoutRefIds:hi,itIsNewCommandProgressionFromLevel:1}}});var Ea=C((iv,Sa)=>{"use strict";var Ra=ts(),jt=y(),ja=`
`;Sa.exports=e=>{e["midi setting name"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>jt.midiSettingName.test(n),action:(t,s,r,n,o,a,i)=>{let h=jt.midiSettingName.match(n)[0];i.lastMentionedMidiSettingKey=Ra[h],i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="msh">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=jt.midiSettingName.match(r)[0];t.lastMentionedMidiSettingKey=Ra[o];let a=s.lastIndexOf(ja);a===-1?t.highlightsHtmlBuffer.push(`<span class="msh">${s}</span>`):t.highlightsHtmlBuffer.push(`${s.slice(0,a+1)}<span class="msh">${s.slice(a+1)}</span>`)},itIsNewCommandProgressionFromLevel:0},e["midi setting name is"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"midi setting name",condition:(t,s,r,n,o,a,i)=>jt.isIs.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["midi setting value"]={onTheSameLineAsPrevScenario:!0,requiredCommandProgression:"midi setting name is",condition:(t,s,r,n,o,a,i)=>jt.midiSettingValue.test(n,i.lastMentionedMidiSettingKey)&&r.lastOnTheLine,action:(t,s,r,n,o,a,i)=>{i.midiSettings[i.lastMentionedMidiSettingKey]=jt.midiSettingValue.match(n)[0],i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="msvh">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.indexOf(ja);n===-1?t.highlightsHtmlBuffer.push(`<span class="msvh">${s}</span>`):t.highlightsHtmlBuffer.push(`<span class="msvh">${s.slice(0,n)}</span>${s.slice(n)}`)},itIsNewCommandProgressionFromLevel:1}}});var ee=C((nv,Ua)=>{"use strict";var qa=["1st","2nd","3rd","4th","5th","6th","7th","8th","9th","0th","11th","12th"],Sp={first:"1",second:"2",third:"3",fourth:"4",fifth:"5",sixth:"6",seventh:"7",eighth:"8",ninth:"9",tenth:"10",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};Ua.exports=(e,t)=>e.map(s=>{let r=s.length;return(qa.indexOf(`${s[r-3]}${s[r-2]}${s[r-1]}`)!==-1||qa.indexOf(`${s[r-4]}${s[r-3]}${s[r-2]}${s[r-1]}`)!==-1)&&(s=s.slice(0,r-2)),Sp[s]||s})});var Ja=C((sv,_a)=>{"use strict";var Le=ee(),te=y();_a.exports=e=>{e["compress units by n times"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>te.compressUnitsByNTimes.test(Le(n)),action:(t,s,r,n,o,a,i)=>{if(i.lastMentionedUnitsCompression=te.compressUnitsByNTimes.match(Le(n))[0],i.applyHighlighting){let l=o.replace(te.unitsHighlight,h=>`<span class="cuph" ref-id="all-units">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-units">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(te.unitsHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.lastMentionedUnitsCompressionWasForSpecificLine?(t.lastMentionedUnitsCompressionWasForSpecificLine=!1,t.lastMentionedUnitsCompression=void 0):(t.pageSchema.compressUnitsByNTimes=t.lastMentionedUnitsCompression,t.lastMentionedUnitsCompression=void 0),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["compress units by n times in line position"]={requiredCommandProgression:"compress units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>te.unitLinePosition.test(Le(n)),action:(t,s,r,n,o,a,i)=>{let l=Le(n),h=te.unitLinePosition.match(l)[0]*1-1;if(i.pageSchema.compressUnitsByNTimesInLines=i.pageSchema.compressUnitsByNTimesInLines||[],i.pageSchema.compressUnitsByNTimesInLines[h]=i.lastMentionedUnitsCompression,i.lastMentionedUnitsCompressionWasForSpecificLine=!0,i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll("all-units",`all-units-on-line-${h+1}`);let m=o.trimEnd(),u=m.replace(te.positionPreposition,(c,g,d,f,p)=>`${g||""}<span class="clph" ref-id="line-${h+1}">${p}</span>`);i.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="${h}">${u}</span>${o.slice(m.length)}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.trimEnd(),o=n.replace(te.positionPreposition,(a,i,l,h,m)=>`${i||""}<span class="clph">${m}</span>`);t.highlightsHtmlBuffer.push(`${o}${s.slice(n.length)}`)},itIsNewCommandProgressionFromLevel:1},e["compress units by n times in position of line"]={requiredCommandProgression:"compress units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>te.linePositionOfUnit.test(Le(n)),action:(t,s,r,n,o,a,i)=>{let l=Le(n),h=te.linePositionOfUnit.match(l)[0]*1-1;if(i.pageSchema.compressUnitsByNTimesInLines=i.pageSchema.compressUnitsByNTimesInLines||[],i.pageSchema.compressUnitsByNTimesInLines[h]=i.lastMentionedUnitsCompression,i.lastMentionedUnitsCompressionWasForSpecificLine=!0,i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll("all-units",`all-units-on-line-${h+1}`);let m=o.trimEnd(),u=m.replace(te.positionPreposition,(c,g,d,f,p)=>`${g||""}<span class="clph" ref-id="line-${h+1}">${p}</span>`);i.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="${h}">${u}</span>${o.slice(m.length)}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.trimEnd(),o=n.replace(te.positionPreposition,(a,i,l,h,m)=>`${i||""}<span class="clph">${m}</span>`);t.highlightsHtmlBuffer.push(`${o}${s.slice(n.length)}`)},itIsNewCommandProgressionFromLevel:1},e["stretch units by n times"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>te.stretchUnitsByNTimes.test(Le(n)),action:(t,s,r,n,o,a,i)=>{if(i.lastMentionedUnitsStretching=te.stretchUnitsByNTimes.match(Le(n))[0],i.applyHighlighting){let l=o.replace(te.unitsHighlight,h=>`<span class="cuph" ref-id="all-units">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-units">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(te.unitsHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.lastMentionedUnitsStretchingWasForSpecificLine?(t.lastMentionedUnitsStretchingWasForSpecificLine=!1,t.lastMentionedUnitsStretching=void 0):(t.pageSchema.stretchUnitsByNTimes=t.lastMentionedUnitsStretching,t.lastMentionedUnitsStretching=void 0),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["stretch units by n times in line"]={requiredCommandProgression:"stretch units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>te.unitLinePosition.test(Le(n)),action:(t,s,r,n,o,a,i)=>{let l=Le(n),h=te.unitLinePosition.match(l)[0]*1-1;if(i.pageSchema.stretchUnitsByNTimesInLines=i.pageSchema.stretchUnitsByNTimesInLines||[],i.pageSchema.stretchUnitsByNTimesInLines[h]=i.lastMentionedUnitsStretching,i.lastMentionedUnitsStretchingWasForSpecificLine=!0,i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll("all-units",`all-units-on-line-${h+1}`);let m=o.trimEnd(),u=m.replace(te.positionPreposition,(c,g,d,f,p)=>`${g||""}<span class="clph" ref-id="line-${h+1}">${p}</span>`);i.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="line-${h+1}">${u}</span>${o.slice(m.length)}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.trimEnd(),o=n.replace(te.positionPreposition,(a,i,l,h,m)=>`${i||""}<span class="clph">${m}</span>`);t.highlightsHtmlBuffer.push(`${o}${s.slice(n.length)}`)},itIsNewCommandProgressionFromLevel:1},e["stretch units by n times in position of line"]={requiredCommandProgression:"stretch units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>te.linePositionOfUnit.test(Le(n)),action:(t,s,r,n,o,a,i)=>{let l=Le(n),h=te.linePositionOfUnit.match(l)[0]*1-1;if(i.pageSchema.stretchUnitsByNTimesInLines=i.pageSchema.stretchUnitsByNTimesInLines||[],i.pageSchema.stretchUnitsByNTimesInLines[h]=i.lastMentionedUnitsStretching,i.lastMentionedUnitsStretchingWasForSpecificLine=!0,i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll("all-units",`all-units-on-line-${h+1}`);let m=o.trimEnd(),u=m.replace(te.positionPreposition,(c,g,d,f,p)=>`${g||""}<span class="clph" ref-id="line-${h+1}">${p}</span>`);i.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="line-${h+1}">${u}</span>${o.slice(m.length)}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.trimEnd(),o=n.replace(te.positionPreposition,(a,i,l,h,m)=>`${i||""}<span class="clph">${m}</span>`);t.highlightsHtmlBuffer.push(`${o}${s.slice(n.length)}`)},itIsNewCommandProgressionFromLevel:1}}});var Ga=C((ov,Ka)=>{"use strict";var Ep=ee(),Ns=y();Ka.exports=e=>{e["hide the last measure on a page"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ns.hideLastMeasure.test(Ep(n)),action:(t,s,r,n,o,a,i)=>{if(i.pageSchema.hideLastMeasure=!0,i.applyHighlighting){let l=o.replace(Ns.lastMeasureHighlight,h=>`<span class="cmph" ref-id="last-measure-on-page">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="last-measure-on-page">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ns.lastMeasureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0}}});var Qa=C((rv,Ya)=>{"use strict";var qp=Sn(),ws=y(),ui="is",Up="",za=`
`;Ya.exports=e=>{e["page meta"]={startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>ws.pageMeta.test(n)&&r.lastOnTheLine,action:(t,s,r,n,o,a,i)=>{let l=ws.pageMeta.match(n),h=l[0],m=qp[h],u=l[1];i.pageSchema[m]=u,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o.replace(ws.somethingIsSomethingWithDelimetersHighlight,(c,g,d,f)=>{f.startsWith(ui)&&(f=f.replace(ui,Up));let p=g.trimEnd(),T=f.trimStart();return`<span class="th" ref-id="${m}"><span class="eh" ref-id="${m}">${p}</span>${g.slice(p.length)}${d}${f.slice(0,f.length-T.length)}<span class="sth" ref-id="${m}">${T}</span></span>`}))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.indexOf(ui),o=[s.slice(0,n),s.slice(n+2)],a=o[0].lastIndexOf(za),i=o[1].indexOf(za);a===-1?t.highlightsHtmlBuffer.push(`<span class="eh">${o[0]}</span>${ui}`):t.highlightsHtmlBuffer.push(`${o[0].slice(0,a+1)}<span class="eh">${o[0].slice(a+1)}</span>${ui}`),i===-1?t.highlightsHtmlBuffer.push(`<span class="sth">${o[1]}</span>`):t.highlightsHtmlBuffer.push(`<span class="sth">${o[1].slice(0,i)}</span>${o[1].slice(i)}`)},itIsNewCommandProgressionFromLevel:0}}});var pt=C((av,Xa)=>{"use strict";var _p=y();Xa.exports=(e,t)=>_p.direction.test(e)});var Pt=C((lv,Za)=>{"use strict";var Jp=y();Za.exports=(e,t)=>Jp.direction.match(e)[0]});var mi=C((hv,el)=>{"use strict";var Kp=y();el.exports=(e,t)=>Kp.aboveBelowOverUnder.test(e)});var ci=C((uv,tl)=>{"use strict";var Gp=y();tl.exports=(e,t)=>{let r=Gp.aboveBelowOverUnder.match(e)[0];return r==="above"||r==="over"?"up":"down"}});var nl=C((mv,il)=>{"use strict";var zp=pt(),Yp=Pt(),Qp=mi(),Xp=ci(),Fe=y(),Zp=_n();il.exports=e=>{e["measure numbers"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Fe.measureNumbers.test(n),action:(t,s,r,n,o,a,i)=>{if(i.pageSchema.showMeasureNumbers="all",i.pageSchema.directionOfMeasureNumbers="up",i.applyHighlighting){let l=o.replace(Fe.measureNumbersHighlight,h=>`<span class="eh" ref-id="measure-numbers">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-numbers">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Fe.measureNumbersHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["direction of measure numbers"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>zp(n),action:(t,s,r,n,o,a,i)=>{i.pageSchema.directionOfMeasureNumbers=Yp(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["measure numbers above or below"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Qp(n),action:(t,s,r,n,o,a,i)=>{i.pageSchema.directionOfMeasureNumbers=Xp(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="every-measure">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure numbers above or below measures"]={requiredCommandProgression:"measure numbers above or below",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Fe.measures.test(n),action:(t,s,r,n,o,a,i)=>{if(i.applyHighlighting){let l=o.replace(Fe.measuresHighlight,h=>`<span class="cmph" ref-id="every-measure">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="every-measure">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Fe.measuresHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["application of measure numbers"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Fe.applicationOfMeasureNumbers.test(n),action:(t,s,r,n,o,a,i)=>{let l=Fe.applicationOfMeasureNumbers.match(n)[0],h=Zp[l];if(i.pageSchema.showMeasureNumbers=h,i.applyHighlighting){let m;h==="first&last"?m=o.replace(Fe.applicationOfMeasureNumbersHighlight,u=>`<span class="cmph" ref-id="first-or-last-measure">${u}</span>`):h==="first"?m=o.replace(Fe.applicationOfMeasureNumbersHighlight,u=>`<span class="cmph" ref-id="first-measure">${u}</span>`):h==="last"?m=o.replace(Fe.applicationOfMeasureNumbersHighlight,u=>`<span class="cmph" ref-id="last-measure">${u}</span>`):m=o.replace(Fe.applicationOfMeasureNumbersHighlight,u=>`<span class="cmph" ref-id="every-measure">${u}</span>`),i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-numbers">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Fe.applicationOfMeasureNumbersHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var di=C((cv,sl)=>{"use strict";var eP=ee(),Qi=y();sl.exports=(e,t)=>{let s=eP(e);if(Qi.staveIndex.test(s)){let r=Qi.staveIndex.match(s);if(r!==void 0&&r[0]!==void 0)return r[0]*1-(t?1:0)}if(Qi.indexOfStave.test(s)){let r=Qi.indexOfStave.match(s);if(r!==void 0&&r[0]!==void 0)return r[0]*1-(t?1:0)}return 0}});var gi=C((dv,rl)=>{"use strict";var tP=ee(),ol=y();rl.exports=(e,t)=>{let s=tP(e);return ol.staveIndex.test(s)||ol.indexOfStave.test(s)}});var hl=C((gv,ll)=>{"use strict";var al=di(),iP=gi(),fi=y();ll.exports=e=>{e["lyrics position"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>fi.lyricsPosition.test(n),action:(t,s,r,n,o,a,i)=>{if(i.applyHighlighting){let l=o.replace(fi.lyricsHighlight,h=>`<span class="eh" ref-id="lyrics">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(fi.lyricsHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["lyrics position stave index"]={requiredCommandProgression:"lyrics position",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>iP(n),action:(t,s,r,n,o,a,i)=>{let l=al(n);if(i.pageSchema.lyricsUnderStaveIndex=al(n,!0),i.applyHighlighting){let h=o.replace(fi.staveIndexHighlight,m=>`<span class="csph" ref-id="stave-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(fi.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var ml=C((fv,ul)=>{"use strict";ul.exports=(e,t)=>{e.measuresParams=e.measuresParams||[],t.numberOfPageLines===0&&(t.numberOfPageLines+=1),t.newlineAlreadyIntroducedNewMeasure||e.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:t.numberOfPageLines}),t.newlineAlreadyIntroducedNewMeasure=!1}});var re=C((pv,cl)=>{"use strict";cl.exports=e=>e.measuresParams[e.measuresParams.length-1]});var be=C((Pv,dl)=>{"use strict";dl.exports=(e,t)=>{let s=[];if(t!==void 0&&e[t-1]!==`
`)for(let r=t;r<e.length;r++){let n=e[r];if(/\s/.test(n))break;s.push(n)}return s.join("")}});var fl=C((Tv,gl)=>{"use strict";var nP=ml(),De=re(),sP=Li(),oP=Vi(),St=ee(),rP=be(),x=y();gl.exports=e=>{e.measure={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>{let l=rP(t,r.firstCharIndexOfNextToken);return r.firstOnTheLine&&x.measure.test(n)&&!x.measureNumbers.test([r.value,l])&&!x.rest.test([l])},action:(t,s,r,n,o,a,i)=>{nP(i.pageSchema,i);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.measureHighlight,m=>`<span class="cmph" ref-id="measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")}},e["measure without start bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.withoutStartBarLine.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).withoutStartBarLine=!0;let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.withoutStartBarLineHighlight,m=>`<span class="th" ref-id="measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.withoutStartBarLineHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["measure opens with bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.opensWithBarLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=x.opensWithBarLine.match(n)[0],h=sP[l];De(i.pageSchema).openingBarLineName=h;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(x.openingBarLineHighlight,c=>`<span class="eh" ref-id="opening-barline-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="opening-barline-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.openingBarLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["measure closes with bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.closesWithBarLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=x.closesWithBarLine.match(n)[0],h=oP[l];De(i.pageSchema).closingBarLineName=h;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(x.closingBarLineHighlight,c=>`<span class="eh" ref-id="closing-barline-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="closing-barline-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.closingBarLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["measure with repeat sign"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.withRepeatSign.test(n),action:(t,s,r,n,o,a,i)=>{let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.withRepeatSignHighlight,m=>`<span class="eh" ref-id="repeat-sign-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repeat-sign-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.withRepeatSignHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=De(t.pageSchema);!o.repeatDotsMarkAtTheStart&&!o.repeatDotsMarkAtTheEnd&&(o.repeatDotsMarkAtTheStart=!0,o.repeatDotsMarkAtTheEnd=!0),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure with repeat sign at the start"]={requiredCommandProgression:"measure with repeat sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.atTheStart.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).repeatDotsMarkAtTheStart=!0;let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.atTheStartHighlight,m=>`<span class="th" ref-id="repeat-sign-at-the-start-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repeat-sign-at-the-start-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.atTheStartHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["measure with repeat sign at the end"]={requiredCommandProgression:"measure with repeat sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.atTheEnd.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).repeatDotsMarkAtTheEnd=!0;let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.atTheEndHighlight,m=>`<span class="th" ref-id="repeat-sign-at-the-end-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repeat-sign-at-the-end-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.atTheEndHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["measure with measure rest"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.withMeasureRest.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).isMeasureRest=!0;let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.measureRestHighlight,m=>`<span class="eh" ref-id="measure-rest-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-rest-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.measureRestHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure with multi measure rest count"]={requiredCommandProgression:"measure with measure rest",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>{let l=St(n);return x.multiMeasureRestCount.test(l)},action:(t,s,r,n,o,a,i)=>{let l=St(n),h=x.multiMeasureRestCount.match(l)[0];De(i.pageSchema).multiMeasureRestCount=`${h}`;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(x.numberHighlight,c=>`<span class="cnh" ref-id="measure-rest-count-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-rest-count-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["measure with simile of previous measure"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.measureWithSimileOfPreviousMeasure.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).similePreviousMeasureCount="1";let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.simileHighlight,m=>`<span class="eh" ref-id="simile-${l}">${m}</span>`).replace(x.previousMeasureHighlight,m=>`<span class="cmph" ref-id="simile-prev-measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.simileHighlight,o=>`<span class="eh">${o}</span>`).replace(x.previousMeasureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure with simile of two previous measures"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.measureWithSimileOfTwoPreviousMeasures.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).simileTwoPreviousMeasuresCount="1";let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.simileHighlight,m=>`<span class="eh" ref-id="simile-${l}">${m}</span>`).replace(x.twoPreviousMeasuresHighlight,m=>`<span class="cmph" ref-id="simile-two-prev-measures-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.simileHighlight,o=>`<span class="eh">${o}</span>`).replace(x.twoPreviousMeasuresHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure with simile count for previous measure"]={requiredCommandProgression:"measure with simile of previous measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.simileCount.test(St(n)),action:(t,s,r,n,o,a,i)=>{let l=x.simileCount.match(St(n))[0];De(i.pageSchema).similePreviousMeasureCount=l;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(x.numberHighlight,u=>`<span class="cnh" ref-id="simile-count-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-count-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["measure with simile count for two previous measures"]={requiredCommandProgression:"measure with simile of two previous measures",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.simileCount.test(St(n)),action:(t,s,r,n,o,a,i)=>{let l=x.simileCount.match(St(n))[0];De(i.pageSchema).simileTwoPreviousMeasuresCount=l;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(x.numberHighlight,u=>`<span class="cnh" ref-id="simile-count-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-count-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["measure ends with fermata"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>x.endsWithFermata.test(n),action:(t,s,r,n,o,a,i)=>{De(i.pageSchema).endsWithFermata=!0;let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(x.fermataHighlight,m=>`<span class="eh" ref-id="measure-fermata-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-fermata-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(x.fermataHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var de=C((Cv,Pl)=>{"use strict";var pl=re();Pl.exports=(e,t,s)=>{e.measuresParams=e.measuresParams||[],s.numberOfPageLines===0&&(s.numberOfPageLines+=1);let r=t!=="closingBarLineName";e.measuresParams.length===0&&(r?e.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:s.numberOfPageLines}):s.newlineAlreadyIntroducedNewMeasure||e.measuresParams.push({pageLineNumber:s.numberOfPageLines})),t&&pl(e)[t]&&!Array.isArray(pl(e)[t])&&r&&!s.newlineAlreadyIntroducedNewMeasure&&e.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:s.numberOfPageLines}),s.newlineAlreadyIntroducedNewMeasure=!1,s.newlineAlreadyIntroducedNewStave=!1}});var Cl=C((bv,Tl)=>{"use strict";var Is=de(),$s=re(),aP=Li(),lP=Vi(),qe=y();Tl.exports=e=>{e["no start bar line"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>qe.noStartBarLine.test(n),action:(t,s,r,n,o,a,i)=>{Is(i.pageSchema,"withoutStartBarLine",i);let l=$s(i.pageSchema);l.withoutStartBarLine=!0;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(qe.noStartBarLineHighlight,u=>`<span class="th" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(qe.noStartBarLine,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0},e["opening bar line"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>qe.openingBarLine.test(n),action:(t,s,r,n,o,a,i)=>{Is(i.pageSchema,"openingBarLineName",i);let l=$s(i.pageSchema),h=qe.openingBarLine.match(n)[0],m=aP[h];l.openingBarLineName=m;let u=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let c=o.replace(qe.openingBarLineHighlight,g=>`<span class="eh" ref-id="opening-barline-${u}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="opening-barline-${u}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(qe.openingBarLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["closing bar line"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>qe.closingBarLine.test(n),action:(t,s,r,n,o,a,i)=>{Is(i.pageSchema,"closingBarLineName",i);let l=$s(i.pageSchema),h=qe.closingBarLine.match(n)[0],m=lP[h];l.closingBarLineName=m;let u=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let c=o.replace(qe.closingBarLineHighlight,g=>`<span class="eh" ref-id="closing-barline-${u}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="closing-barline-${u}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(qe.closingBarLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0}}});var Ol=C((Ov,bl)=>{"use strict";var Bs=de(),Xi=re(),st=y();bl.exports=e=>{e["repeat sign"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>st.repeatSign.test(n),action:(t,s,r,n,o,a,i)=>{if(i.applyHighlighting){let l=o.replace(st.withRepeatSignHighlight,h=>`<span class="eh" ref-id="">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(st.withRepeatSignHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=Xi(t.pageSchema);if(!o.repeatDotsMarkAtTheStart&&!o.repeatDotsMarkAtTheEnd){Bs(t.pageSchema,"repeatDotsMarkAtTheStart",t);let i=Xi(t.pageSchema);i.repeatDotsMarkAtTheStart=!0,i.repeatDotsMarkAtTheEnd=!0}let a=t.pageSchema.measuresParams.length;t.applyHighlighting&&(t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2].replaceAll('ref-id=""',`ref-id="repeat-sign-${a}"`),t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="repeat-sign-${a}"`),t.highlightsHtmlBuffer.push("</span>"))},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["repeat sign at the start"]={requiredCommandProgression:"repeat sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>st.atTheStart.test(n),action:(t,s,r,n,o,a,i)=>{Bs(i.pageSchema,"repeatDotsMarkAtTheStart",i);let l=Xi(i.pageSchema);l.repeatDotsMarkAtTheStart=!0;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(st.atTheStartHighlight,u=>`<span class="th" ref-id="repeat-sign-at-the-start-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repeat-sign-at-the-start-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(st.atTheStartHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["repeat sign at the end"]={requiredCommandProgression:"repeat sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>st.atTheEnd.test(n),action:(t,s,r,n,o,a,i)=>{Bs(i.pageSchema,"repeatDotsMarkAtTheEnd",i);let l=Xi(i.pageSchema);l.repeatDotsMarkAtTheEnd=!0;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(st.atTheEndHighlight,u=>`<span class="th" ref-id="repeat-sign-at-the-end-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repeat-sign-at-the-end-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(st.atTheEndHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var kl=C((Hv,Wl)=>{"use strict";var hP=de(),Hl=re(),vl=ee(),kt=y();Wl.exports=e=>{e["measure rest"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>kt.measureRest.test(n),action:(t,s,r,n,o,a,i)=>{hP(i.pageSchema,"isMeasureRest",i);let l=Hl(i.pageSchema);l.isMeasureRest=!0;let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(kt.measureRestHighlight,u=>`<span class="eh" ref-id="measure-rest-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-rest-${h}">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(kt.measureRestHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["multi measure rest count"]={requiredCommandProgression:"measure rest",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>{let l=vl(n);return kt.multiMeasureRestCount.test(l)},action:(t,s,r,n,o,a,i)=>{let l=vl(n),h=kt.multiMeasureRestCount.match(l)[0];Hl(i.pageSchema).multiMeasureRestCount=`${h}`;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(kt.numberHighlight,c=>`<span class="cnh" ref-id="measure-rest-count-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-rest-count-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(kt.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var Il=C((vv,wl)=>{"use strict";var Nl=de(),Zi=re(),en=ee(),Te=y();wl.exports=e=>{e["simile of previous measure"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Te.simileOfPreviousMeasure.test(n),action:(t,s,r,n,o,a,i)=>{Nl(i.pageSchema,"similePreviousMeasureCount",i);let l=Zi(i.pageSchema);l.similePreviousMeasureCount="1";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Te.simileHighlight,u=>`<span class="eh" ref-id="simile-${h}">${u}</span>`).replace(Te.previousMeasureHighlight,u=>`<span class="cmph" ref-id="simile-prev-measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-${h}">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Te.simileHighlight,o=>`<span class="eh">${o}</span>`).replace(Te.previousMeasureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["simile of two previous measures"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Te.simileOfTwoPreviousMeasures.test(n),action:(t,s,r,n,o,a,i)=>{Nl(i.pageSchema,"simileTwoPreviousMeasuresCount",i);let l=Zi(i.pageSchema);l.simileTwoPreviousMeasuresCount="1";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Te.simileHighlight,u=>`<span class="eh" ref-id="simile-${h}">${u}</span>`).replace(Te.twoPreviousMeasuresHighlight,u=>`<span class="cmph" ref-id="simile-two-prev-measures-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-${h}">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Te.simileHighlight,o=>`<span class="eh">${o}</span>`).replace(Te.twoPreviousMeasuresHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["simile count for previous measure"]={requiredCommandProgression:"simile of previous measure",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Te.simileCount.test(en(n)),action:(t,s,r,n,o,a,i)=>{let l=Te.simileCount.match(en(n))[0],h=Zi(i.pageSchema);h.similePreviousMeasureCount=l;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(Te.numberHighlight,c=>`<span class="cnh" ref-id="simile-count-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-count-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Te.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["simile count for two previous measures"]={requiredCommandProgression:"simile of two previous measures",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Te.simileCount.test(en(n)),action:(t,s,r,n,o,a,i)=>{let l=Te.simileCount.match(en(n))[0],h=Zi(i.pageSchema);h.simileTwoPreviousMeasuresCount=l;let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(Te.numberHighlight,c=>`<span class="cnh" ref-id="simile-count-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-count-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Te.numberHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)}}}});var Bl=C((Wv,$l)=>{"use strict";var uP=de(),mP=re(),Et=y();$l.exports=e=>{e["measure fermata"]={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Et.fermata.test(n),action:(t,s,r,n,o,a,i)=>{uP(i.pageSchema,"endsWithFermata",i);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(Et.fermataHighlight,m=>`<span class="eh" ref-id="measure-fermata-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-fermata-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Et.fermataHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=mP(t.pageSchema);o.endsWithFermata=!0,t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["measure fermata at the end"]={requiredCommandProgression:"measure fermata",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Et.atTheEnd.test(n),action:(t,s,r,n,o,a,i)=>{let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(Et.atTheEndHighlight,m=>`<span class="th" ref-id="measure-fermata-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-fermata-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Et.atTheEndHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var xl=C((kv,Al)=>{"use strict";var cP=be(),Nt=y(),yl=re();Al.exports=e=>{e.new={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>r.firstOnTheLine&&Nt.new.test(n)&&Nt.line.test([cP(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{if(i.applyHighlighting){let l=o.replace(Nt.newHighlight,h=>`<span class="clph" ref-id="">${h}`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Nt.newHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["new line"]={requiredCommandProgression:"new",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>r.lastOnTheLine&&Nt.line.test(n),action:(t,s,r,n,o,a,i)=>{i.pageSchema.measuresParams=i.pageSchema.measuresParams||[],i.numberOfPageLines+=1;let l=yl(i.pageSchema);l&&(l.isLastMeasureOnPageLine=!0),i.pageSchema.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:i.numberOfPageLines}),i.newlineAlreadyIntroducedNewMeasure=!0;let h=yl(i.pageSchema);if(i.lastCrossStaveConnectionsParamsForEachLine&&(h.connectionsParams=JSON.parse(JSON.stringify(i.lastCrossStaveConnectionsParamsForEachLine))),i.lastInstrumentTitlesParamsForEachLine&&(h.instrumentTitlesParams=JSON.parse(JSON.stringify(i.lastInstrumentTitlesParamsForEachLine))),i.lastKeySignatureName&&(h.keySignatureName=i.lastKeySignatureName,h.keySignatureNameForEachLineId=i.lastKeySignatureNameForEachLineId),i.lastTimeSignatureParams&&(h.timeSignatureParams=i.lastTimeSignatureParams),i.lastBeamStatus={},i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="line-${i.numberOfPageLines}"`);let m=o.replace(Nt.lineHighlight,u=>`${u}</span>`);i.highlightsHtmlBuffer.push(`${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Nt.lineHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var Dl=C((Nv,Fl)=>{"use strict";Fl.exports=e=>e.connectionsParams[e.connectionsParams.length-1]});var jl=C((wv,Rl)=>{"use strict";var Ce=y(),dP=de(),pi=re(),tn=Dl(),Ml=di(),Ll=gi(),Vl=be(),gP=Rt();Rl.exports=e=>{e["bracket or brace"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>r.firstOnTheLine&&Ce.crossStaveConnection.test(n),action:(t,s,r,n,o,a,i)=>{dP(i.pageSchema,"connectionsParams",i);let l=pi(i.pageSchema);l.connectionsParams=l.connectionsParams||[],i.lastCrossStaveConnectionsParamsForEachLine=i.lastCrossStaveConnectionsParamsForEachLine||[];let h=r.value;l.connectionsParams.push({name:h,staveStartNumber:0,staveEndNumber:0});let m=i.pageSchema.measuresParams.length,u=l.connectionsParams.length;if(i.applyHighlighting){let c=o.replace(Ce.crossStaveConnectionHighlight,g=>`<span class="eh" ref-id="cross-stave-connection-${m}-${u}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="cross-stave-connection-${m}-${u}">${c}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ce.crossStaveConnectionHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection for"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ce.for.test(n)&&!Ce.forEach.test([r.value,Vl(t,r.firstCharIndexOfNextToken)])&&!Ce.forLines.test([r.value,Vl(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection from"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ce.from.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection for stave index"]={requiredCommandProgression:"connection for",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ll(n),action:(t,s,r,n,o,a,i)=>{let l=Ml(n,!0),h=pi(i.pageSchema),m=tn(h),u=h.connectionsParams.findIndex(d=>d.staveStartNumber===l||d.staveEndNumber===l);u!==-1&&u!==h.connectionsParams.length-1&&h.connectionsParams.splice(u,1);let c=i.lastCrossStaveConnectionsParamsForEachLine.findIndex(d=>d.staveStartNumber===l||d.staveEndNumber===l);c!==-1&&i.lastCrossStaveConnectionsParamsForEachLine.splice(c,1),m.staveStartNumber=l,m.staveEndNumber=l;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replace('ref-id=""',`ref-id="stave-${g}-${l+1}"`);let d=o.replace(Ce.staveIndexHighlight,f=>`<span class="csph" ref-id="stave-${g}-${l+1}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${g}-${l+1}">${d}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ce.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection from stave index"]=gP(e["connection for stave index"],"connection from"),e["connection to"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ce.to.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection to stave index"]={requiredCommandProgression:"connection to",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ll(n),action:(t,s,r,n,o,a,i)=>{let l=Ml(n,!0),h=pi(i.pageSchema),m=tn(h),u=h.connectionsParams.findIndex(d=>d.staveEndNumber===l);u!==-1&&u!==h.connectionsParams.length-1&&h.connectionsParams.splice(u,1);let c=i.lastCrossStaveConnectionsParamsForEachLine.findIndex(d=>d.staveEndNumber===l);c!==-1&&i.lastCrossStaveConnectionsParamsForEachLine.splice(c,1),m.staveEndNumber=l;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replace('ref-id=""',`ref-id="stave-${g}-${l+1}"`);let d=o.replace(Ce.staveIndexHighlight,f=>`<span class="csph" ref-id="stave-${g}-${l+1}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${g}-${l+1}">${d}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ce.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["connection for each line"]={requiredCommandProgression:"bracket or brace",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ce.forEachLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=pi(i.pageSchema),h=tn(l);if(h.forEachLineId=i.lastCrossStaveConnectionsParamsForEachLineId,i.lastCrossStaveConnectionsParamsForEachLine.push(h),i.applyHighlighting){let m=o.replace(Ce.forEachLineHighlight,u=>`<span class="clph" ref-id="cross-stave-connection-for-each-line-${i.lastCrossStaveConnectionsParamsForEachLineId}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="cross-stave-connection-for-each-line-${i.lastCrossStaveConnectionsParamsForEachLineId}">${m}</span>`)}i.lastCrossStaveConnectionsParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ce.forEachLineHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["connection for lines below"]={requiredCommandProgression:"bracket or brace",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ce.forLinesBelow.test(n),action:(t,s,r,n,o,a,i)=>{let l=pi(i.pageSchema),h=tn(l);if(h.forEachLineId=i.lastCrossStaveConnectionsParamsForEachLineId,i.lastCrossStaveConnectionsParamsForEachLine.push(h),i.applyHighlighting){let m=o.replace(Ce.linesHighlight,u=>`<span class="clph" ref-id="cross-stave-connection-for-each-line-${i.lastCrossStaveConnectionsParamsForEachLineId}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="cross-stave-connection-for-each-line-${i.lastCrossStaveConnectionsParamsForEachLineId}">${m}</span>`)}i.lastCrossStaveConnectionsParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ce.linesHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var El=C((Iv,Sl)=>{"use strict";Sl.exports=e=>e.instrumentTitlesParams[e.instrumentTitlesParams.length-1]});var Pi=C(($v,ql)=>{"use strict";ql.exports=(e,t,s)=>{let r=[],n=[];if(t!==void 0&&e[t-1]!==`
`){let o=e.length-1;for(let a=t;a<e.length;a++){let i=e[a],l=/\s/.test(i);if((l||a===o)&&r.length>0){if(!l&&a===o&&r.push(i),n.push(r.join("")),r.length=0,n.length===s||i===`
`)break}else r.push(i)}}return n}});var Gl=C((Bv,Kl)=>{"use strict";var ae=y(),fP=de(),Ti=re(),nn=El(),Ul=di(),_l=gi(),Jl=be(),pP=Pi(),PP=Rt();Kl.exports=e=>{e["instrument title"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ae.instrumentTitle.test(n),action:(t,s,r,n,o,a,i)=>{fP(i.pageSchema,"instrumentTitlesParams",i);let l=Ti(i.pageSchema);l.instrumentTitlesParams=l.instrumentTitlesParams||[],i.lastInstrumentTitlesParamsForEachLine=i.lastInstrumentTitlesParamsForEachLine||[];let h=ae.instrumentTitle.match(n)[0];l.instrumentTitlesParams.push({value:h,staveNumber:0,staveStartNumber:0,staveEndNumber:0});let m=i.pageSchema.measuresParams.length,u=l.instrumentTitlesParams.length;if(i.applyHighlighting){let g=o.replace(ae.stringHighlight,d=>`<span class="sth" ref-id="instrument-title-${m}-${u}">${d}</span>`).replace(ae.instrumentTitleHighlight,d=>`<span class="eh" ref-id="instrument-title-${m}-${u}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="instrument-title-${m}-${u}">${g}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=s.replace(ae.stringHighlight,a=>`<span class="sth">${a}</span>`).replace(ae.instrumentTitleHighlight,a=>`<span class="eh">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title for"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:!0,prohibitedCommandProgressions:["instrument title for each line","instrument title for lines below"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ae.for.test(n)&&!ae.forEach.test([r.value,Jl(t,r.firstCharIndexOfNextToken)])&&!ae.forLines.test([r.value,Jl(t,r.firstCharIndexOfNextToken)])&&!ae.forLinesBelow.test([r.value,pP(t,r.firstCharIndexOfNextToken,2)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title between"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:!0,prohibitedCommandProgressions:["instrument title for each line","instrument title for lines below"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ae.between.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},itIsNewCommandProgressionFromLevel:1,actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title for stave index"]={requiredCommandProgression:"instrument title for",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_l(n),action:(t,s,r,n,o,a,i)=>{let l=Ul(n,!0),h=Ti(i.pageSchema),m=nn(h),u=h.instrumentTitlesParams.findIndex(d=>d.staveStartNumber===l||d.staveEndNumber===l);u!==-1&&u!==h.instrumentTitlesParams.length-1&&h.instrumentTitlesParams.splice(u,1);let c=i.lastInstrumentTitlesParamsForEachLine.findIndex(d=>d.staveStartNumber===l||d.staveEndNumber===l);c!==-1&&i.lastInstrumentTitlesParamsForEachLine.splice(c,1),m.staveNumber=l,m.staveStartNumber=l,m.staveEndNumber=l;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replace('ref-id=""',`ref-id="stave-${g}-${l+1}"`);let d=o.replace(ae.staveIndexHighlight,f=>`<span class="csph" ref-id="stave-${g}-${l+1}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${g}-${l+1}">${d}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ae.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title between stave index 1"]=PP(e["instrument title for stave index"],"instrument title between"),e["instrument title between stave index 1 followed by and"]={requiredCommandProgression:"instrument title between stave index 1",onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>ae.and.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title between stave index 2"]={requiredCommandProgression:"instrument title between stave index 1 followed by and",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_l(n),action:(t,s,r,n,o,a,i)=>{let l=Ul(n,!0),h=Ti(i.pageSchema),m=nn(h),u=h.instrumentTitlesParams.findIndex(d=>d.staveEndNumber===l);u!==-1&&u!==h.instrumentTitlesParams.length-1&&h.instrumentTitlesParams.splice(u,1);let c=i.lastInstrumentTitlesParamsForEachLine.findIndex(d=>d.staveEndNumber===l);c!==-1&&i.lastInstrumentTitlesParamsForEachLine.splice(c,1),m.staveEndNumber=l;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-2]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-2].replace('ref-id=""',`ref-id="stave-${g}-${l+1}"`),i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replace('ref-id=""',`ref-id="stave-${g}-${l+1}"`);let d=o.replace(ae.staveIndexHighlight,f=>`<span class="csph" ref-id="stave-${g}-${l+1}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${g}-${l+1}">${d}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ae.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["instrument title for each line"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ae.forEachLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ti(i.pageSchema),h=nn(l);if(h.forEachLineId=i.lastInstrumentTitlesParamsForEachLineId,i.lastInstrumentTitlesParamsForEachLine.push(h),i.applyHighlighting){let m=o.replace(ae.forEachLineHighlight,u=>`<span class="clph" ref-id="instrument-title-for-each-line-${i.lastInstrumentTitlesParamsForEachLineId}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="instrument-title-for-each-line-${i.lastInstrumentTitlesParamsForEachLineId}">${m}</span>`)}i.lastInstrumentTitlesParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ae.forEachLineHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["instrument title for lines below"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ae.forLinesBelow.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ti(i.pageSchema),h=nn(l);if(h.forEachLineId=i.lastInstrumentTitlesParamsForEachLineId,i.lastInstrumentTitlesParamsForEachLine.push(h),i.applyHighlighting){let m=o.replace(ae.linesHighlight,u=>`<span class="clph" ref-id="instrument-title-for-each-line-${i.lastInstrumentTitlesParamsForEachLineId}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="instrument-title-for-each-line-${i.lastInstrumentTitlesParamsForEachLineId}">${m}</span>`)}i.lastInstrumentTitlesParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ae.linesHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var ys=C((yv,zl)=>{"use strict";var TP=Ri();zl.exports=e=>TP.find(t=>t.split("|").indexOf(e)!==-1)});var Ql=C((Av,Yl)=>{"use strict";var CP=be(),$e=y(),bP=de(),As=re(),OP=ys();Yl.exports=e=>{e["key signature"]={condition:(t,s,r,n,o,a,i)=>$e.keySignature.test(n),action:(t,s,r,n,o,a,i)=>{bP(i.pageSchema,"keySignatureName",i);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace($e.keySignatureHighlight,m=>`<span class="eh" ref-id="key-signature-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace($e.keySignatureHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0},e["key signature name"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>$e.keySignatureName.test(n)&&!$e.to.test([CP(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{let l=As(i.pageSchema),h=$e.keySignatureName.match(n)[0];i.lastKeySignatureName&&(l.keySignatureNameForEachLineId=void 0,i.lastKeySignatureName=void 0,i.lastKeySignatureNameForEachLineId+=1),l.keySignatureName=OP(h);let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace($e.keySignatureNameHighlight,c=>`<span class="sth" ref-id="key-signature-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace($e.keySignatureNameHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["key signature for each line"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>$e.forEachLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=As(i.pageSchema);if(i.lastKeySignatureName=l.keySignatureName,l.keySignatureNameForEachLineId=i.lastKeySignatureNameForEachLineId,i.applyHighlighting){let h=o.replace($e.forEachLineHighlight,m=>`<span class="clph" ref-id="key-signature-for-each-line-${i.lastKeySignatureNameForEachLineId}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-for-each-line-${i.lastKeySignatureNameForEachLineId}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace($e.forEachLineHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["key signature for lines below"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>$e.forLinesBelow.test(n),action:(t,s,r,n,o,a,i)=>{let l=As(i.pageSchema);if(i.lastKeySignatureName=l.keySignatureName,l.keySignatureNameForEachLineId=i.lastKeySignatureNameForEachLineId,i.applyHighlighting){let h=o.replace($e.linesHighlight,m=>`<span class="clph" ref-id="key-signature-for-each-line-${i.lastKeySignatureNameForEachLineId}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-for-each-line-${i.lastKeySignatureNameForEachLineId}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace($e.linesHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var Zl=C((xv,Xl)=>{"use strict";var Me=y(),HP=de(),sn=re();Xl.exports=e=>{e["time signature"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Me.timeSignature.test(n),action:(t,s,r,n,o,a,i)=>{HP(i.pageSchema,"timeSignatureParams",i);let l=sn(i.pageSchema);i.lastTimeSignatureParams&&(l.lastTimeSignatureParams=void 0,i.lastTimeSignatureParams=void 0),l.timeSignatureParams={};let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Me.timeSignatureHighlight,u=>`<span class="eh" ref-id="time-signature-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="eh" ref-id="time-signature-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Me.timeSignatureHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0},e["time signature value"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Me.timeSignatureValue.test(n),action:(t,s,r,n,o,a,i)=>{let l=sn(i.pageSchema),h=Me.timeSignatureValue.match(n);if(h[0]==="c")l.timeSignatureParams.numerator="4",l.timeSignatureParams.denominator="4",l.timeSignatureParams.cMode=!0;else if(h[0]==="crossed c")l.timeSignatureParams.numerator="2",l.timeSignatureParams.denominator="2",l.timeSignatureParams.cMode=!0;else{let u=h[0],c=h[1];l.timeSignatureParams.numerator=u,l.timeSignatureParams.denominator=c}let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(Me.timeSignatureValueHighlight,c=>`<span class="cnh" ref-id="time-signature-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="time-signature-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Me.timeSignatureValueHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["time signature for each line"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Me.forEachLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=sn(i.pageSchema).timeSignatureParams;if(l.forEachLineId=i.lastTimeSignatureValueForEachLineId,i.lastTimeSignatureParams=l,i.applyHighlighting){let h=o.replace(Me.forEachLineHighlight,m=>`<span class="clph" ref-id="time-signature-for-each-line-${i.lastTimeSignatureValueForEachLineId}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="time-signature-for-each-line-${i.lastTimeSignatureValueForEachLineId}">${h}</span>`)}i.lastTimeSignatureValueForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Me.forEachLineHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["time signature for lines below"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Me.forLinesBelow.test(n),action:(t,s,r,n,o,a,i)=>{let l=sn(i.pageSchema).timeSignatureParams;if(l.forEachLineId=i.lastTimeSignatureValueForEachLineId,i.lastTimeSignatureParams=l,i.applyHighlighting){let h=o.replace(Me.linesHighlight,m=>`<span class="clph" ref-id="time-signature-for-each-line-${i.lastTimeSignatureValueForEachLineId}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="time-signature-for-each-line-${i.lastTimeSignatureValueForEachLineId}">${h}</span>`)}i.lastTimeSignatureValueForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Me.linesHighlight,o=>`<span class="clph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var Ve=C((Fv,eh)=>{"use strict";var vP=ee(),WP=y();eh.exports=(e,t)=>WP.verticalCorrection.test(vP(e))});var Re=C((Dv,th)=>{"use strict";var kP=ee(),NP=y();th.exports=(e,t)=>{let s=kP(e),r=NP.verticalCorrection.match(s),n=r[0];return(r[1]==="up"?-1:1)*n}});var nh=C((Mv,ih)=>{"use strict";var Be=y(),wP=de(),on=re(),IP=Ve(),$P=Re();ih.exports=e=>{e["repetition note"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Be.repetitionNote.test(n),action:(t,s,r,n,o,a,i)=>{wP(i.pageSchema,"repetitionNote",i);let l=on(i.pageSchema),h=Be.repetitionNote.match(n)[0];l.repetitionNote={value:h,measurePosition:"start"};let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(Be.stringHighlight,c=>`<span class="sth" ref-id="repetition-note-${m}">${c}</span>`).replace(Be.repetitionNoteHighlight,c=>`<span class="eh" ref-id="repetition-note-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repetition-note-${m}">${u}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Be.stringHighlight,o=>`<span class="sth">${o}</span>`).replace(Be.repetitionNoteHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["repetition note at the start of the measure"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Be.atTheStartOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=on(i.pageSchema);l.repetitionNote.measurePosition="start";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Be.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repetition-note-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s)=>{let r=s.replace(Be.measureHighlight,n=>`<span class="cmph">${n}</span>`);t.highlightsHtmlBuffer.push(r)}},e["repetition note at the end of the measure"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Be.atTheEndOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=on(i.pageSchema);l.repetitionNote.measurePosition="end";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Be.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repetition-note-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s)=>{let r=s.replace(Be.measureHighlight,n=>`<span class="cmph">${n}</span>`);t.highlightsHtmlBuffer.push(r)}},e["repetition note vertical correction"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>IP(n),action:(t,s,r,n,o,a,i)=>{let l=on(i.pageSchema);l.repetitionNote.yCorrection=$P(n);let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Be.verticalCorrectionHighlight,u=>`<span class="th" ref-id="repetition-note-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="repetition-note-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Be.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}}}});var oh=C((Lv,sh)=>{"use strict";var Ue=y(),BP=de(),rn=re(),yP=Ve(),AP=Re();sh.exports=e=>{e.coda={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ue.coda.test(n),action:(t,s,r,n,o,a,i)=>{BP(i.pageSchema,"coda",i);let l=rn(i.pageSchema);l.coda={measurePosition:"start"};let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Ue.codaHighlight,u=>`<span class="eh" ref-id="coda-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="coda-${h}">${m}`)}},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ue.codaHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["coda at the start of the measure"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ue.atTheStartOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=rn(i.pageSchema);l.coda.measurePosition="start";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Ue.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="coda-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ue.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["coda at the end of the measure"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ue.atTheEndOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=rn(i.pageSchema);l.coda.measurePosition="end";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Ue.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="coda-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ue.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["coda vertical correction"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>yP(n),action:(t,s,r,n,o,a,i)=>{let l=rn(i.pageSchema);l.coda.yCorrection=AP(n);let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(Ue.verticalCorrectionHighlight,u=>`<span class="th" ref-id="coda-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="coda-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Ue.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}}}});var ah=C((Vv,rh)=>{"use strict";var _e=y(),xP=de(),an=re(),FP=Ve(),DP=Re();rh.exports=e=>{e.sign={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_e.sign.test(n),action:(t,s,r,n,o,a,i)=>{xP(i.pageSchema,"sign",i);let l=an(i.pageSchema);l.sign={measurePosition:"start"};let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(_e.signHighlight,u=>`<span class="eh" ref-id="sign-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="sign-${h}">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(_e.signHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["sign at the start of the measure"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_e.atTheStartOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=an(i.pageSchema);l.sign.measurePosition="start";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(_e.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="sign-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(_e.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["sign at the end of the measure"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_e.atTheEndOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=an(i.pageSchema);l.sign.measurePosition="end";let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(_e.measureHighlight,u=>`<span class="cmph" ref-id="measure-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="sign-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(_e.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["sign vertical correction"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>FP(n),action:(t,s,r,n,o,a,i)=>{let l=an(i.pageSchema);l.sign.yCorrection=DP(n);let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(_e.verticalCorrectionHighlight,u=>`<span class="th" ref-id="sign-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="sign-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(_e.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}}}});var hh=C((Rv,lh)=>{"use strict";var MP=y(),xs=Jn(),LP=["1","1/2","1/4","1/8","1/16","1/32","1/64"];lh.exports=e=>{let t=e.split(MP.tempoDurationPart),s=[];for(let r=0;r<t.length;r++){let n=t[r],o=LP.indexOf(n)!==-1?`${n}(?!\\d|/)`:n;xs[o]?t[r+1]!==void 0&&/^\s{0,1}$/.test(t[r+1])&&t[r+2]!==void 0&&(t[r+2]==="dotted"||t[r+2]==="with dot")?(r+=2,s.push(`${xs[o]}Dotted`)):s.push(xs[o]):s.push(n)}return s}});var ch=C((jv,mh)=>{"use strict";var ge=y(),VP=de(),uh=re(),RP=Ve(),jP=Re(),SP=hh(),EP=be();mh.exports=e=>{e["tempo mark"]={condition:(t,s,r,n,o,a,i)=>ge.tempoOrMetronome.test(n)&&!ge.markOrNote.test([EP(t,r.firstCharIndexOfNextToken)])||ge.tempoMarkOrTempoNote.test(n),action:(t,s,r,n,o,a,i)=>{VP(i.pageSchema,"tempoMark",i);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(ge.tempoMarkHighlight,m=>`<span class="eh" ref-id="tempo-mark-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tempo-mark-${l}">${h}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ge.tempoMarkHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["tempo mark text"]={requiredCommandProgression:"tempo mark",onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>ge.tempoMarkText.test(n),action:(t,s,r,n,o,a,i)=>{let l=uh(i.pageSchema),h=ge.tempoMarkText.match(n)[0];l.tempoMark={textValueParts:SP(h)};let m=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let u=o.replace(ge.stringHighlight,c=>{let g=0,d=!1,f=c.replace(ge.tempoDurationPartHighlight,(p,T,b,O)=>{if(ge.tempoDurationPartIsDot.test(p))return d?(d=!1,`<span class="eh" ref-id="tempo-duration-part-${m}-${++g}">${p}</span>`):`<span class="sth" ref-id="tempo-mark-${m}">${p}</span>`;{d=!0;let $=O.slice(b+p.length);return!ge.tempoMarkWithDotHighlight.test($)&&!ge.tempoMarkDottedHighlight.test($)?(d=!1,`<span class="cuph" ref-id="tempo-duration-part-${m}-${++g}">${p}</span>`):`<span class="cuph" ref-id="tempo-duration-part-${m}-${++g}">${p}</span>`}});return`<span class="sth" ref-id="tempo-mark-${m}">${f}</span>`});i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tempo-mark-${m}">${u}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ge.stringHighlight,o=>{let a=!1;return`<span class="sth">${o.replace(ge.tempoDurationPartHighlight,(l,h,m,u)=>{if(ge.tempoDurationPartIsDot.test(l))return a?(a=!1,`<span class="eh">${l}</span>`):`<span class="sth">${l}</span>`;{a=!0;let c=u.slice(m+l.length);return!ge.tempoMarkWithDotHighlight.test(c)&&!ge.tempoMarkDottedHighlight.test(c)?(a=!1,`<span class="cuph">${l}</span>`):`<span class="cuph">${l}</span>`}})}</span>`});t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["tempo mark vertical correction"]={requiredCommandProgression:"tempo mark",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>RP(n),action:(t,s,r,n,o,a,i)=>{let l=uh(i.pageSchema);l.tempoMark.yCorrection=jP(n);let h=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let m=o.replace(ge.verticalCorrectionHighlight,u=>`<span class="th" ref-id="tempo-mark-${h}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tempo-mark-${h}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ge.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var wt=C((Sv,dh)=>{"use strict";dh.exports=e=>e.stavesParams[e.stavesParams.length-1]});var Ph=C((Ev,ph)=>{"use strict";var Tt=y(),gh=de(),fh=re(),qP=wt(),UP=zt(),_P=be();ph.exports=e=>{e.stave={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>r.firstOnTheLine&&Tt.stave.test([r.value])&&!Tt.lines.test([_P(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{gh(i.pageSchema,"stavesParams",i);let l=fh(i.pageSchema);l.stavesParams=l.stavesParams||[],l.stavesParams.push({});let h=i.pageSchema.measuresParams.length,m=l.stavesParams.length;if(i.applyHighlighting){let u=o.replace(Tt.staveHighlight,c=>`<span class="csph" ref-id="stave-lines-${h}-${m}">${c}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-lines-${h}-${m}">${u}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Tt.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")}},e["stave with clef"]={requiredCommandProgression:"stave",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Tt.withClef.test(n),action:(t,s,r,n,o,a,i)=>{gh(i.pageSchema,"stavesParams",i);let l=fh(i.pageSchema),h=qP(l),m=Tt.withClef.match(n)[0];h.clef=UP[m];let u=l.stavesParams.length;i.lastClef[u-1]=h.clef;let c=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let g=o.replace(Tt.clefHighlight,d=>`<span class="eh" ref-id="clef-${c}-${u}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="clef-${c}-${u}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Tt.clefHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var Ci=C((qv,Ch)=>{"use strict";var Th=wt();Ch.exports=(e,t,s)=>{e.stavesParams||(e.stavesParams=[]),e.stavesParams.length===0&&e.stavesParams.push({}),t&&Th(e)[t]&&!Array.isArray(Th(e)[t])&&e.stavesParams.push({})}});var Oh=C((Uv,bh)=>{"use strict";var ln=y(),JP=de(),KP=Ci(),GP=re(),zP=wt(),YP=zt();bh.exports=e=>{e.clef={startsOnNewLine:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ln.clef.test(n),action:(t,s,r,n,o,a,i)=>{JP(i.pageSchema,"stavesParams",i);let l=GP(i.pageSchema);KP(l,"clef",i);let h=zP(l),m=l.stavesParams.length,u=ln.clef.match(n)[0];h.clef=YP[u],i.lastClef[m-1]=h.clef;let c=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let g=o.replace(ln.clefHighlight,d=>`<span class="eh" ref-id="clef-${c}-${m}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="clef-${c}-${m}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ln.clefHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0}}});var vh=C((_v,Hh)=>{"use strict";var Fs=y(),QP=de(),XP=Ci(),ZP=re(),eT=wt();Hh.exports=e=>{e.voice={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>r.firstOnTheLine&&Fs.voice.test([r.value]),action:(t,s,r,n,o,a,i)=>{QP(i.pageSchema,"stavesParams",i);let l=ZP(i.pageSchema);XP(l,"voicesParams",i);let h=eT(l);h.voicesParams=h.voicesParams||[],h.voicesParams.push([]);let m=i.pageSchema.measuresParams.length,u=l.stavesParams.length,c=h.voicesParams.length;if(i.applyHighlighting){let g=o.replace(Fs.voiceHighlight,d=>`<span class="cvph" ref-id="voice-${m}-${u}-${c}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="voice-${m}-${u}-${c}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Fs.voiceHighlight,o=>`<span class="cvph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0}}});var kh=C((Jv,Wh)=>{"use strict";var tT=ee(),iT=y();Wh.exports=(e,t)=>iT.horizontalCorrection.test(tT(e))});var wh=C((Kv,Nh)=>{"use strict";var nT=ee(),sT=y();Nh.exports=(e,t)=>{let s=nT(e),r=sT.horizontalCorrection.match(s),n=r[0];return(r[1]==="left"?-1:1)*n}});var Ds=C((Gv,Ih)=>{"use strict";var oT=y();Ih.exports=(e,t)=>oT.withRoundness.test(e)});var Ms=C((zv,$h)=>{"use strict";var rT=y();$h.exports=(e,t)=>rT.withRoundness.match(e)[0]*1});var hn=C((Yv,Bh)=>{"use strict";var aT=y();Bh.exports=(e,t)=>aT.aboveBelowOverUnderStaveLines.test(e)});var un=C((Qv,yh)=>{"use strict";var lT=y();yh.exports=(e,t)=>{let r=lT.aboveBelowOverUnderStaveLines.match(e)[0];return r==="above"||r==="over"?"up":"down"}});var Fh=C((Xv,xh)=>{"use strict";var Ah=y(),hT=ee();xh.exports=(e,t)=>{let s=hT(e);return Ah.measureNumber.test(s)||Ah.numberOfMeasure.test(s)}});var Mh=C((Zv,Dh)=>{"use strict";var Ls=y(),uT=ee();Dh.exports=(e,t)=>{let s=uT(e),r;return Ls.measureNumber.test(s)?r=Ls.measureNumber.match(s):r=Ls.numberOfMeasure.match(s),r[0]*1}});var Vh=C((eW,Lh)=>{"use strict";var mT=y(),cT=ee();Lh.exports=(e,t)=>mT.withNumberOfStrokes.test(cT(e))});var jh=C((tW,Rh)=>{"use strict";var dT=y(),gT=ee();Rh.exports=(e,t)=>dT.withNumberOfStrokes.match(gT(e))[0]*1});var Eh=C((iW,Sh)=>{"use strict";var fT=y(),pT=ee();Sh.exports=(e,t)=>fT.numberOfTimes.test(pT(e))});var Uh=C((nW,qh)=>{"use strict";var PT=y(),TT=ee();qh.exports=(e,t)=>PT.numberOfTimes.match(TT(e))[0]*1});var Jh=C((sW,_h)=>{"use strict";_h.exports=e=>e==="top"?.5:e==="mid"||e==="middle"?2:e==="bottom"?3.5:2});var mn=C((oW,Kh)=>{"use strict";Kh.exports=e=>{for(let t=e.length-1;t>=0;t--)if(!e[t].isSimile)return e[t];return null}});var Vs=C((rW,Gh)=>{"use strict";var CT=mn();Gh.exports=(e,t,s)=>{if(e.voicesParams||(e.voicesParams=[]),e.voicesParams.length===0&&e.voicesParams.push([]),t){let r=CT(e);r&&r[t]&&!Array.isArray(r[t])&&e.voicesParams.push([])}}});var Rs=C((aW,zh)=>{"use strict";zh.exports=e=>e.voicesParams[e.voicesParams.length-1]});var Qh=C((lW,Yh)=>{"use strict";Yh.exports=e=>e.notes[e.notes.length-1]});var Zh=C((hW,Xh)=>{"use strict";Xh.exports=e=>e.keysParams[e.keysParams.length-1]});var tu=C((uW,eu)=>{"use strict";eu.exports=e=>e.articulationParams[e.articulationParams.length-1]});var nu=C((mW,iu)=>{"use strict";iu.exports=e=>e.glissandoMarks[e.glissandoMarks.length-1]});var ou=C((cW,su)=>{"use strict";su.exports=e=>e.relatedLyrics[e.relatedLyrics.length-1]});var cu=C((dW,mu)=>{"use strict";var P=y(),qt=be(),bT=Pi(),ru=ee(),ot=Ve(),rt=Re(),OT=kh(),HT=wh(),Ct=pt(),vT=gi(),Xe=Pt(),WT=di(),js=Ds(),bi=Ms(),Ss=hn(),It=mi(),Es=un(),at=ci(),cn=Fh(),dn=Mh(),kT=Vh(),NT=jh(),wT=Eh(),IT=Uh(),$T=Jh(),BT=de(),yT=Ci(),AT=Vs(),k=re(),N=wt(),I=Rs(),w=mn(),$t=Qh(),xT=Zh(),ye=tu(),Ut=nu(),Oi=ou(),au=ys(),lu=ji(),FT=Si(),DT=Gn(),MT=Yn(),hu=zt(),LT=Qn(),VT=Zn(),Oe=Rt(),RT=1/4,jT=(e,t,s,r,n,o)=>{for(let a=0;a<t.count;a++)e.pageSchema.measuresParams[s-1].stavesParams[r-1].voicesParams[n-1].splice(o-1+a+1,0,{notes:[{positionNumber:(t.yCorrection||0)+2}],isSimile:!0,simileRefId:`simile-mark-${e.numberOfSimileMarks}`,simileCountDown:t.count-a,simileYCorrection:t.yCorrection})},ST="clef",uu="note";mu.exports=e=>{e.note={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(P.noteWithDurationAndOctave.test(n)||P.rest.test(n)&&r.firstOnTheLine||P.topMidBottomRest.test(n))&&qt(t,r.firstCharIndexOfNextToken)!==ST&&(a.indexOf(uu)!==-1||r.isOnNewLine),action:(t,s,r,n,o,a,i)=>{BT(i.pageSchema,"stavesParams",i);let l=k(i.pageSchema);yT(l,"voicesParams",i);let h=N(l);AT(h,"notes");let m=I(h);if(!i.chordScopeIsActive){m.push({});let V=l.stavesParams.length,oe=h.voicesParams.length;i.lastStavePosition[V-1]&&i.lastStavePosition[V-1][oe-1]&&(i.lastStavePosition[V-1][oe-1]=void 0)}let c=P.noteWithDurationAndOctave.test(n),g=P.rest.test(n)&&r.firstOnTheLine||P.topMidBottomRest.test(n),d,f,p,T;if(c){let V=P.noteWithDurationAndOctave.match(n);V[0]&&(d=lu[V[0]]),V[1]&&(f=V[1]),V[2]&&(p=V[2])}else if(g){let V=w(m);V.notes&&V.notes.length>0&&(i.chordScopeIsActive=!1,m.push({}));let oe=P.topMidBottomRest.match(n);d=lu[oe[0]],T=$T(oe[1])}let b=l.stavesParams.length,O=h.voicesParams.length,$=m.length;i.numberOfUnitsBeforeFinishingDeclaringNewOne=$;let F={noteName:f,octaveNumber:p,positionNumber:T},M=w(m);M.notes=M.notes||[],M.notes.push(F);let L=M.notes.length;F.id=L-1;let Q=$t(M);if(g&&(M.isRest=!0),d?(M.unitDuration=d,i.lastChordDuration[b-1]||(i.lastChordDuration[b-1]={}),i.lastChordDuration[b-1][O-1]=d):i.lastChordDuration[b-1]&&i.lastChordDuration[b-1][O-1]?M.unitDuration=i.lastChordDuration[b-1][O-1]:(M.unitDuration=RT,i.lastChordDuration[b-1]||(i.lastChordDuration[b-1]={}),i.lastChordDuration[b-1][O-1]=d),i.keysOfLastNote=[],i.lastStemDirection[b-1]&&i.lastStemDirection[b-1][O-1]?M.stemDirection=i.lastStemDirection[b-1][O-1]:O===1?M.stemDirection="up":M.stemDirection="down",i.lastStavePosition[b-1]&&i.lastStavePosition[b-1][O-1]&&(Q.stave=i.lastStavePosition[b-1][O-1]),i.lastGhostStatus[b-1]&&i.lastGhostStatus[b-1][O-1]&&(Q.isGhost=!0),i.applyHighlighting){let V;P.noteWithDurationAndOctave.test(n)?V=P.noteWithDurationAndOctaveHighlight:P.topMidBottomRest.test(n)&&(V=P.topMidBottomRestHighlight);let oe=o.replace(V,z=>`<span class="cuph" ref-id="">${z}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${oe}`),i.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.push(i.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n;P.noteWithDurationAndOctave.test(r)?n=P.noteWithDurationAndOctaveHighlight:P.topMidBottomRest.test(r)&&(n=P.topMidBottomRestHighlight);let o=s.replace(n,a=>`<span class="cuph">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=k(t.pageSchema),a=N(o),i=I(a),l=w(i),h=t.pageSchema.measuresParams.length,m=o.stavesParams.length,u=a.voicesParams.length,c=t.numberOfUnitsBeforeFinishingDeclaringNewOne,g=l.notes.length,d=t.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord[t.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length-1];l.isRest?t.applyHighlighting&&(t.highlightsHtmlBuffer[d]=t.highlightsHtmlBuffer[d].replaceAll('ref-id=""',`ref-id="rest-${h}-${m}-${u}-${c}"`)):t.applyHighlighting&&(t.highlightsHtmlBuffer[d]=t.highlightsHtmlBuffer[d].replaceAll('ref-id=""',`ref-id="note-${h}-${m}-${u}-${c}-${g}"`)),t.lastBeamStatus[m-1]||(t.lastBeamStatus[m-1]={}),t.lastBeamStatus[m-1][u-1]||(t.lastBeamStatus[m-1][u-1]={plain:!1,grace:!1}),l.unitDuration>=1/4&&(l.beamedWithNext=!1),l.beamedWithNext===!1&&t.lastBeamStatus[m-1]&&t.lastBeamStatus[m-1][u-1]&&t.lastBeamStatus[m-1][u-1].plain&&!l.isGrace&&(t.lastBeamStatus[m-1][u-1].plain=!1,t.lastBeamStatus[m-1][u-1].grace=!1),l.beamedWithNext===!1&&t.lastBeamStatus[m-1]&&t.lastBeamStatus[m-1][u-1]&&t.lastBeamStatus[m-1][u-1].grace&&l.isGrace&&(t.lastBeamStatus[m-1][u-1].grace=!1),t.lastBeamStatus[m-1]&&t.lastBeamStatus[m-1][u-1]&&t.lastBeamStatus[m-1][u-1].grace&&!l.isGrace&&(t.lastBeamStatus[m-1][u-1].grace=!1),t.lastBeamStatus[m-1]&&t.lastBeamStatus[m-1][u-1]&&t.lastBeamStatus[m-1][u-1].plain&&!l.isGrace&&(l.beamedWithNext=!0),t.lastBeamStatus[m-1]&&t.lastBeamStatus[m-1][u-1]&&t.lastBeamStatus[m-1][u-1].grace&&l.isGrace&&(l.beamedWithNext=!0),l.beamedWithNext===!0&&!l.isGrace&&(t.lastBeamStatus[m-1][u-1].plain=!0),l.beamedWithNext===!0&&l.isGrace&&(t.lastBeamStatus[m-1][u-1].grace=!0),t.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length=0,t.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length=0,s!==uu&&(t.chordScopeIsActive=!1),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["empty line after note"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,type:"on empty line",condition:(t,s,r,n,o,a,i)=>!0,action:(t,s,r,n,o,a,i)=>{i.chordScopeIsActive=!1;let l=k(i.pageSchema),h=N(l),m=l.stavesParams.length,u=h.voicesParams.length;i.lastStavePosition[m-1]&&i.lastStavePosition[m-1][u-1]&&(i.lastStavePosition[m-1][u-1]=void 0),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:0},e["note stem direction"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.stemDirection.test(n)||P.directionOfStem.test(n),action:(t,s,r,n,o,a,i)=>{let l=P.stemDirection.match(n),h=P.directionOfStem.match(n),m=(l||h)[0],u=k(i.pageSchema),c=N(u),g=I(c),d=w(g);d.stemDirection=m;let f=i.pageSchema.measuresParams.length,p=u.stavesParams.length,T=c.voicesParams.length,b=g.length;if(i.lastStemDirection[p-1]||(i.lastStemDirection[p-1]={}),i.lastStemDirection[p-1][T-1]=m,i.applyHighlighting){let O=o.replace(P.stemHighlight,$=>`<span class="eh" ref-id="stem-${f}-${p}-${T}-${b}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stem-${f}-${p}-${T}-${b}">${O}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.stemHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note stave position"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.stavePosition.test(n),action:(t,s,r,n,o,a,i)=>{let l=P.stavePosition.match(n)[0],h=FT[l],m=k(i.pageSchema),u=N(m),c=I(u),g=w(c),d=$t(g);d.stave=h,i.keysOfLastNote.forEach(b=>{b.stave=h});let f=i.pageSchema.measuresParams.length,p=m.stavesParams.length,T=p;if(i.applyHighlighting){let b=o.replace(P.stavePositionHighlight,O=>(l==="next"?T=p+1:l==="prev"&&(T=p-1),`<span class="csph" ref-id="stave-${f}-${T}">${O}</span>`));i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${f}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.stavePositionHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note with number of dots"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withNumberOfDots.test(ru(n)),action:(t,s,r,n,o,a,i)=>{let l=P.withNumberOfDots.match(ru(n))[0]*1,h=k(i.pageSchema),m=N(h),u=I(m),c=w(u);c.numberOfDots=l;let g=i.pageSchema.measuresParams.length,d=h.stavesParams.length,f=m.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let T=o.replace(P.withNumberOfDotsHighlight,(b,O,$)=>`${O}<span class="eh" ref-id="dots-${g}-${d}-${f}-${p}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="dots-${g}-${d}-${f}-${p}">${T}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNumberOfDotsHighlight,(o,a,i)=>`${a}<span class="eh">${i}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["dotted note"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.dotted.test(n)||P.withDot.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.numberOfDots=1;let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=P.dotted.test(n)?o.replace(P.dottedHighlight,T=>`<span class="eh" ref-id="dots-${c}-${g}-${d}-${f}">${T}</span>`):o.replace(P.withDotHighlight,T=>`<span class="eh" ref-id="dots-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="dots-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=P.dotted.test(r)?s.replace(P.dottedHighlight,o=>`<span class="eh">${o}</span>`):s.replace(P.withDotHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note beamed"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.beamed.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(u.beamedWithNext=!0,i.applyHighlighting){let p=o.replace(P.beamedHighlight,T=>`<span class="eh" ref-id="beam-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="beam-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.beamedHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note not beamed"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.notBeamed.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.beamedWithNext=!1,i.groupScoreIsActive=!1,i.graceGroupScoreIsActive=!1,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note beamed with next"]={requiredCommandProgression:"note beamed",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withNext.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=i.pageSchema.measuresParams.length,u=l.stavesParams.length,c=h.voicesParams.length,g=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let d=o.replace(P.withNextHighlight,f=>`<span class="cuph" ref-id="next-to-unit-connected-with-beam-${m}-${u}-${c}-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="next-to-unit-connected-with-beam-${m}-${u}-${c}-${g}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNextHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note not beamed with next"]={requiredCommandProgression:"note not beamed",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withNext.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=i.pageSchema.measuresParams.length,u=l.stavesParams.length,c=h.voicesParams.length,g=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let d=o.replace(P.withNextHighlight,f=>`<span class="cuph" ref-id="next-to-unit-not-connected-with-beam-${m}-${u}-${c}-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="next-to-unit-not-connected-with-beam-${m}-${u}-${c}-${g}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNextHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note beamed with only primary line"]={requiredCommandProgression:"note beamed",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withOnlyPrimaryLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.beamedWithNextWithJustOneBeam=!0;let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.withOnlyPrimaryLineHighlight,T=>`<span class="eh" ref-id="beam-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="beam-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withOnlyPrimaryLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with key"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["note with turn","note with mordent","note with trill"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withNoteKey.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=$t(u),{noteName:g,octaveNumber:d,positionNumber:f,stave:p}=c;u.keysParams=u.keysParams||[];let T=P.withNoteKey.match(n),b=DT[T],O={noteName:g,octaveNumber:d,positionNumber:f,stave:p,keyType:b};u.keysParams.push(O),i.keysOfLastNote.push(O);let $=i.pageSchema.measuresParams.length,F=l.stavesParams.length,M=h.voicesParams.length,L=i.numberOfUnitsBeforeFinishingDeclaringNewOne,Q=u.keysParams.length;if(O.id=Q-1,i.applyHighlighting){let V=o.replace(P.withNoteKeyHighlight,oe=>`<span class="eh" ref-id="note-key-${$}-${F}-${M}-${L}-${Q}">${oe}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-key-${$}-${F}-${M}-${L}-${Q}">${V}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNoteKeyHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with key with parentheses"]={requiredCommandProgression:"note with key",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withParentheses.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=xT(u);c.withParentheses=!0;let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.keysParams.length;if(i.applyHighlighting){let b=o.replace(P.withParenthesesHighlight,O=>`<span class="eh" ref-id="note-key-parentheses-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-key-parentheses-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withParenthesesHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note with parentheses"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["note with key"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withParentheses.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=u.notes.length;u.parentheses=u.parentheses||[],u.parentheses.push({fromNoteIndex:c-1,toNoteIndex:c-1,id:c-1});let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.notes.length;if(i.applyHighlighting){let b=o.replace(P.withParenthesesHighlight,O=>`<span class="eh" ref-id="note-parentheses-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-parentheses-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withParenthesesHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note with text"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withText.test(n),action:(t,s,r,n,o,a,i)=>{let l=P.withText.match(n)[0];if(i.lastNoteTextValue=l,i.applyHighlighting){let m=o.replace(P.stringHighlight,u=>`<span class="sth" ref-id="">${u}</span>`).replace(P.withTextHighlight,u=>`<span class="eh" ref-id="">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=s.replace(P.stringHighlight,a=>`<span class="sth">${a}</span>`).replace(P.withTextHighlight,a=>`<span class="eh">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastNoteTextPositionApplicationToNote===void 0){t.lastNoteTextPositionApplicationToNote=!0;let o=k(t.pageSchema),a=N(o),i=I(a),l=w(i),h=$t(l),{noteName:m,octaveNumber:u,positionNumber:c,stave:g}=h;l.keysParams=l.keysParams||[];let d="noteLetter",f=t.lastNoteTextValue,p={noteName:m,octaveNumber:u,positionNumber:c,stave:g,keyType:d,textValue:f};l.keysParams.push(p),p.id=l.keysParams.length-1,t.keysOfLastNote.push(p);let T=t.pageSchema.measuresParams.length,b=o.stavesParams.length,O=a.voicesParams.length,$=t.numberOfUnitsBeforeFinishingDeclaringNewOne;t.applyHighlighting&&(t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="note-key-${T}-${b}-${O}-${$}-${p.id+1}"`))}t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>"),t.lastNoteTextValue=void 0,t.lastNoteTextPositionApplicationToNote=void 0},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with text beside"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.beside.test(n),action:(t,s,r,n,o,a,i)=>{i.lastNoteTextPositionApplicationToNote="beside";let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=$t(u),{noteName:g,octaveNumber:d,positionNumber:f,stave:p}=c;u.keysParams=u.keysParams||[];let T="noteLetter",b=i.lastNoteTextValue,O={noteName:g,octaveNumber:d,positionNumber:f,stave:p,keyType:T,textValue:b};u.keysParams.push(O),O.id=u.keysParams.length-1,i.keysOfLastNote.push(O);let $=i.pageSchema.measuresParams.length,F=l.stavesParams.length,M=h.voicesParams.length,L=i.numberOfUnitsBeforeFinishingDeclaringNewOne;i.applyHighlighting&&(i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="note-key-${$}-${F}-${M}-${L}-${O.id+1}"`),i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-key-${$}-${F}-${M}-${L}-${O.id+1}">${o}</span>`))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with text up or down"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{i.lastNoteTextPositionApplicationToNote="up|down";let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.articulationParams=u.articulationParams||[];let c={name:"noteLetter",direction:Xe(n),textValue:i.lastNoteTextValue};u.articulationParams.push(c);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;i.applyHighlighting&&(i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="articulation-${g}-${d}-${f}-${p}-${T}"`),i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${o}</span>`))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with text above or below"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n)&&!P.staveWithAndWithoutDelimeter.test([qt(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.lastNoteTextPositionApplicationToNote="up|down";let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.articulationParams=u.articulationParams||[];let c={name:"noteLetter",direction:at(n),textValue:i.lastNoteTextValue};u.articulationParams.push(c);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;i.applyHighlighting&&(i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="articulation-${g}-${d}-${f}-${p}-${T}"`),i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${o}</span>`))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with text above or below stave"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ss(n),action:(t,s,r,n,o,a,i)=>{i.lastNoteTextPositionApplicationToNote="up|down";let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.articulationParams=u.articulationParams||[];let c={name:"noteLetter",direction:Es(n),textValue:i.lastNoteTextValue,aboveBelowOverUnderStaveLines:!0};u.articulationParams.push(c);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1]=i.highlightsHtmlBuffer[i.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="articulation-${g}-${d}-${f}-${p}-${T}"`);let b=o.replace(P.staveHighlight,O=>`<span class="csph" ref-id="all-staves-in-measure-${g}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-staves-in-measure-${g}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with text up or down vertical correction"]={requiredCommandProgression:"note with text up or down",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.yCorrection=rt(n);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){let b=o.replace(P.verticalCorrectionHighlight,O=>`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:3},e["note with text above or below vertical correction"]=Oe(e["note with text up or down vertical correction"],"note with text above or below"),e["note with text above or below stave vertical correction"]=Oe(e["note with text up or down vertical correction"],"note with text above or below stave"),e["note is tied with next"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.tiedWithNext.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedWithNext={};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.tiedHighlight,T=>`<span class="eh" ref-id="tie-${c}-${g}-${d}-${f}">${T}</span>`).replace(P.withNextHighlight,T=>`<span class="cuph" ref-id="next-to-unit-under-tie-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.tiedHighlight,o=>`<span class="eh">${o}</span>`).replace(P.withNextHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note is tied before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.tiedBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedBefore={};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.tiedHighlight,T=>`<span class="eh" ref-id="tie-before-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-before-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.tiedHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note is tied before measure number"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>cn(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=dn(n);if(u.tiedBeforeMeasure=Object.assign({index:c},u.tiedBefore),u.tiedBefore=void 0,i.applyHighlighting){let g=o.replace(P.measureIndexHighlight,d=>`<span class="cmph" ref-id="measure-${i.numberOfPageLines}-${c}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${i.numberOfPageLines}-${c}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureIndexHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note is tied after"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.tiedAfter.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedAfter={};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.tiedHighlight,T=>`<span class="eh" ref-id="tie-after-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-after-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.tiedHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note is tied after measure number"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>cn(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=dn(n);if(u.tiedAfterMeasure=Object.assign({index:c},u.tiedAfter),u.tiedAfter=void 0,i.applyHighlighting){let g=o.replace(P.measureIndexHighlight,d=>`<span class="cmph" ref-id="measure-${i.numberOfPageLines}-${c}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${i.numberOfPageLines}-${c}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureIndexHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note tied with next direction"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedWithNext.direction=Xe(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied with next above or below"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedWithNext.direction=at(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied before direction"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedBefore?u.tiedBefore.direction=Xe(n):u.tiedBeforeMeasure&&(u.tiedBeforeMeasure.direction=Xe(n)),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied before above or below"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedBefore?u.tiedBefore.direction=at(n):u.tiedBeforeMeasure&&(u.tiedBeforeMeasure.direction=at(n)),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied after direction"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedAfter?u.tiedAfter.direction=Xe(n):u.tiedAfterMeasure&&(u.tiedAfterMeasure.direction=Xe(n)),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied after above or below"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedAfter?u.tiedAfter.direction=at(n):u.tiedAfterMeasure&&(u.tiedAfterMeasure.direction=at(n)),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note tied with next roundness"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>js(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedWithNext.roundCoefficientFactor=bi(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.roundnessHighlight,T=>`<span class="th" ref-id="tie-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.roundnessHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note tied before roundness"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>js(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedBefore?u.tiedBefore.roundCoefficientFactor=bi(n):u.tiedBeforeMeasure&&(u.tiedBeforeMeasure.roundCoefficientFactor=bi(n));let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.roundnessHighlight,T=>`<span class="th" ref-id="tie-before-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-before-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.roundnessHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note tied after roundness"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>js(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tiedAfter?u.tiedAfter.roundCoefficientFactor=bi(n):u.tiedAfterMeasure&&(u.tiedAfterMeasure.roundCoefficientFactor=bi(n));let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.roundnessHighlight,T=>`<span class="th" ref-id="tie-after-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tie-after-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.roundnessHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with glissando"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withGlissando.test(n),action:(t,s,r,n,o,a,i)=>{i.numberOfGlissandos+=1;let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=`glissando-${i.numberOfGlissandos}`;if(u.glissandoMarks=u.glissandoMarks||[],u.glissandoMarks.push({key:c}),i.applyHighlighting){let g=o.replace(P.glissandoHighlight,d=>`<span class="eh" ref-id="glissando-${i.numberOfGlissandos}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${g}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.glissandoHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=k(t.pageSchema),a=N(o),i=I(a),l=w(i),h=Ut(l);h&&!h.after&&h.afterMeasure===void 0&&!h.before&&h.beforeMeasure===void 0&&(h.after=!0),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with glissando direction"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Ut(u);c.direction=Xe(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with glissando after"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.after.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Ut(u);c.after=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with glissando before"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.before.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Ut(u);c.before=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with glissando after measure number"]={requiredCommandProgression:"note with glissando after",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>cn(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Ut(u),g=dn(n);if(c.afterMeasure=g,c.after=!1,i.applyHighlighting){let d=o.replace(P.measureIndexHighlight,f=>`<span class="cmph" ref-id="measure-${i.numberOfPageLines}-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureIndexHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with glissando before measure number"]={requiredCommandProgression:"note with glissando before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>cn(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Ut(u),g=dn(n);if(c.beforeMeasure=g,c.after=!1,i.applyHighlighting){let d=o.replace(P.measureIndexHighlight,f=>`<span class="cmph" ref-id="measure-${i.numberOfPageLines}-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureIndexHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note is rest"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isRest.test(n)&&!r.firstOnTheLine,action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.isRest=!0;let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.restHighlight,T=>`<span class="eh" ref-id="rest-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="rest-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.restHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note is ghost"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isGhost.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=$t(u),g=l.stavesParams.length,d=h.voicesParams.length;!i.chordScopeIsActive&&(i.lastGhostStatus[g-1]||(i.lastGhostStatus[g-1]={}),i.lastGhostStatus[g-1][d-1]=!0),c.isGhost=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["note is not ghost"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isNotGhost.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=$t(u),g=l.stavesParams.length,d=h.voicesParams.length;!i.chordScopeIsActive&&(i.lastGhostStatus[g-1]||(i.lastGhostStatus[g-1]={}),i.lastGhostStatus[g-1][d-1]=!1),c.isGhost=!1,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["note is grace"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isGrace.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.isGrace=!0,P.isGrace.match(n)[0]&&(u.hasGraceCrushLine=!0),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["note with crushed grace"]={requiredCommandProgression:"note is grace",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withCrushLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.hasGraceCrushLine=!0;let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.crushLineHighlight,T=>`<span class="eh" ref-id="grace-crush-line-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="grace-crush-line-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.crushLineHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note is centralized"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isCentralized.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.isFullMeasure=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["note with breath mark before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withBreathMarkBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.withBreathMarkBefore.match(n)[0],g=MT[c];u.breathMarkBefore={type:g};let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let b=o.replace(P.withBreathMarkBeforeHighlight,O=>`<span class="eh" ref-id="breath-mark-before-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="breath-mark-before-${d}-${f}-${p}-${T}">${b}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withBreathMarkBeforeHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with breath mark before vertical correction"]={requiredCommandProgression:"note with breath mark before",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.breathMarkBefore.yCorrection=rt(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.verticalCorrectionHighlight,T=>`<span class="th" ref-id="breath-mark-before-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="breath-mark-before-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with key signature before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withKeySignatureBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne,p=P.withKeySignatureBefore.match(n)[0];if(u.keySignatureBefore=au(p),i.lastKeySignatureName&&(i.lastKeySignatureName=u.keySignatureBefore,i.lastKeySignatureNameForEachLineId+=1),u.clefBefore||(u.clefBefore=i.lastClef[g-1]||"treble"),i.applyHighlighting){let b=o.replace(P.keySignatureHighlight,O=>`<span class="eh" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${O}</span>`).replace(P.keySignatureNameHighlight,O=>`<span class="sth" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=s.replace(P.keySignatureHighlight,a=>`<span class="eh">${a}</span>`).replace(P.keySignatureNameHighlight,a=>`<span class="sth">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:1},e["note with clef before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withClefBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne,p=P.withClefBefore.match(n)[0],T=hu[p];if(u.clefBefore=T,i.lastClef[g-1]=T,i.applyHighlighting){let b=o.replace(P.clefHighlight,O=>`<span class="eh" ref-id="clef-before-${c}-${g}-${d}-${f}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="clef-before-${c}-${g}-${d}-${f}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.clefHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["note with clef and key signature before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withClefAndKeySignatureBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne,p=P.withClefAndKeySignatureBefore.match(n),T=p[0],b=hu[T],O=p[1],$=au(O);if(u.clefBefore=b,u.keySignatureBefore=$,i.lastClef[g-1]=b,i.applyHighlighting){let M=o.replace(P.keySignatureHighlight,L=>`<span class="eh" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${L}</span>`).replace(P.clefHighlight,L=>`<span class="eh" ref-id="clef-before-${c}-${g}-${d}-${f}">${L}</span>`).replace(P.keySignatureNameHighlight,L=>`<span class="sth" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${L}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="key-signature-before-${c}-${g}-${d}-${f}">${M}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=s.replace(P.keySignatureHighlight,a=>`<span class="eh">${a}</span>`).replace(P.clefHighlight,a=>`<span class="eh">${a}</span>`).replace(P.keySignatureNameHighlight,a=>`<span class="sth">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:1},e["note with articulation"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withArticulation.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.withArticulation.match(n),g=LT[c[0]];u.articulationParams=u.articulationParams||[];let d={name:g};u.articulationParams.push(d);let f=i.pageSchema.measuresParams.length,p=l.stavesParams.length,T=h.voicesParams.length,b=i.numberOfUnitsBeforeFinishingDeclaringNewOne,O=u.articulationParams.length;if(i.applyHighlighting){let $=o.replace(P.withArticulationHighlight,F=>`<span class="eh" ref-id="articulation-${f}-${p}-${T}-${b}-${O}">${F}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${f}-${p}-${T}-${b}-${O}">${$}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withArticulationHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with turn"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withTurn.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c="turn";u.articulationParams=u.articulationParams||[];let g={name:c};u.articulationParams.push(g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne,b=u.articulationParams.length;if(i.applyHighlighting){let O=o.replace(P.withTurnHighlight,$=>`<span class="eh" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${O}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withTurnHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with mordent"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withMordent.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c="mordent";u.articulationParams=u.articulationParams||[];let g={name:c};u.articulationParams.push(g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne,b=u.articulationParams.length;if(i.applyHighlighting){let O=o.replace(P.withMordentHighlight,$=>`<span class="eh" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${O}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withMordentHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with trill"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withTrill.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c="trill";u.articulationParams=u.articulationParams||[];let g={name:c};u.articulationParams.push(g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne,b=u.articulationParams.length;if(i.applyHighlighting){let O=o.replace(P.withTrillHighlight,$=>`<span class="eh" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${O}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withTrillHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with articulation direction"]={requiredCommandProgression:"note with articulation",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=Xe(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with turn direction"]=Oe(e["note with articulation direction"],"note with turn"),e["note with mordent direction"]=Oe(e["note with articulation direction"],"note with mordent"),e["note with trill direction"]=Oe(e["note with articulation direction"],"note with trill"),e["note with articulation above or below"]={requiredCommandProgression:"note with articulation",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n)&&!P.staveWithAndWithoutDelimeter.test([qt(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=at(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with turn above or below"]=Oe(e["note with articulation above or below"],"note with turn"),e["note with mordent above or below"]=Oe(e["note with articulation above or below"],"note with mordent"),e["note with trill above or below"]=Oe(e["note with articulation above or below"],"note with trill"),e["note with articulation above or below stave"]={requiredCommandProgression:"note with articulation",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ss(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=Es(n),c.aboveBelowOverUnderStaveLines=!0;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let d=o.replace(P.staveHighlight,f=>`<span class="csph" ref-id="all-staves-in-measure-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-staves-in-measure-${g}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with turn above or below stave"]=Oe(e["note with articulation above or below stave"],"note with turn"),e["note with mordent above or below stave"]=Oe(e["note with articulation above or below stave"],"note with mordent"),e["note with trill above or below stave"]=Oe(e["note with articulation above or below stave"],"note with trill"),e["note with turn key above or below"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withOrnamentKeyAboveBelowOverUnder.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u),g=P.withOrnamentKeyAboveBelowOverUnder.match(n),d=VT[g[0]],f=g[1],p;f==="above"||f==="over"?(c.keyAbove=d,p="above"):(f==="below"||f==="under")&&(c.keyBelow=d,p="below");let T=i.pageSchema.measuresParams.length,b=l.stavesParams.length,O=h.voicesParams.length,$=i.numberOfUnitsBeforeFinishingDeclaringNewOne,F=u.articulationParams.length;if(i.applyHighlighting){let M=o.replace(P.ornamentKeyHighlight,L=>`<span class="eh" ref-id="articulation-key-${p}-${T}-${b}-${O}-${$}-${F}">${L}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-key-${p}-${T}-${b}-${O}-${$}-${F}">${M}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.ornamentKeyHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with mordent key above or below"]=Oe(e["note with turn key above or below"],"note with mordent"),e["note with trill key above or below"]=Oe(e["note with turn key above or below"],"note with trill"),e["note with turn after"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.after.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.followedAfter=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with turn inverted"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.isInverted.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.inverted=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with mordent inverted"]=Oe(e["note with turn inverted"],"note with mordent"),e["note with trill with wave after"]={requiredCommandProgression:"note with trill",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withWaveAfter.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.withWave=!0;let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){let b=o.replace(P.waveHighlight,O=>`<span class="eh" ref-id="articulation-wave-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-wave-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.waveHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with articulation vertical correction"]={requiredCommandProgression:"note with articulation",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.yCorrection=rt(n);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){let b=o.replace(P.verticalCorrectionHighlight,O=>`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with turn vertical correction"]=Oe(e["note with articulation vertical correction"],"note with turn"),e["note with mordent vertical correction"]=Oe(e["note with articulation vertical correction"],"note with mordent"),e["note with trill vertical correction"]=Oe(e["note with articulation vertical correction"],"note with trill"),e["note with chord letter"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withChord.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.withChord.match(n)[0];u.relatedChordLetter={textValue:c},i.lastChordLetterDirection&&(u.relatedChordLetter.direction=i.lastChordLetterDirection);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let T=o.split(P.withChordHighlight),b=T[0],O=T[1],$=`${b}<span class="eh" ref-id="chord-letter-${g}-${d}-${f}-${p}">chord</span>`,F=O.replace(P.stringHighlight,L=>`<span class="sth" ref-id="chord-letter-${g}-${d}-${f}-${p}">${L}</span>`),M=`${$}${F}`;i.highlightsHtmlBuffer.push(`<span class="th" ref-id="chord-letter-${g}-${d}-${f}-${p}">${M}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(P.withChordHighlight),o=n[0],a=n[1],i=`${o}<span class="eh">chord</span>`,l=a.replace(P.stringHighlight,m=>`<span class="sth">${m}</span>`),h=`${i}${l}`;t.highlightsHtmlBuffer.push(h)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with chord letter direction"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.relatedChordLetter.direction=Xe(n),i.lastChordLetterDirection=u.relatedChordLetter.direction,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with chord letter above or below"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;u.relatedChordLetter.direction=at(n),i.lastChordLetterDirection=u.relatedChordLetter.direction,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="chord-letter-${c}-${g}-${d}-${f}">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with chord letter above or below measure"]={requiredCommandProgression:"note with chord letter above or below",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.measure.test(n),action:(t,s,r,n,o,a,i)=>{let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(P.measureHighlight,m=>`<span class="cmph" ref-id="measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with chord letter vertical correction"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.relatedChordLetter.yCorrection=rt(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.verticalCorrectionHighlight,T=>`<span class="th" ref-id="chord-letter-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="chord-letter-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with octave sign"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>{let l=bT(t,r.firstCharIndexOfNextToken,2);return P.isOctaveOrTwoOctavesHigherOrLower.test(n)&&l.indexOf("from")===-1&&l.indexOf("starts")===-1&&l.indexOf("clef")===-1},action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.isOctaveOrTwoOctavesHigherOrLower.match(n),g=c[0],d=g?"15":"8",f=g?"ma":"va",p=c[1]==="up"||c[1]==="higher"?"up":"down";u.articulationParams=u.articulationParams||[];let T={name:"octaveSign",aboveBelowOverUnderStaveLines:!0,direction:p,textValue:d,subTextValue:f};u.articulationParams.push(T);let b=i.pageSchema.measuresParams.length,O=l.stavesParams.length,$=h.voicesParams.length,F=i.numberOfUnitsBeforeFinishingDeclaringNewOne,M=u.articulationParams.length;if(i.applyHighlighting){let L=o.replace(P.isOctaveOrTwoOctavesHigherOrLowerHighlight,Q=>`<span class="eh" ref-id="articulation-${b}-${O}-${$}-${F}-${M}">${Q}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${b}-${O}-${$}-${F}-${M}">${L}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.isOctaveOrTwoOctavesHigherOrLowerHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with octave sign vertical correction"]={requiredCommandProgression:"note with octave sign",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.yCorrection=rt(n);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){let b=o.replace(P.verticalCorrectionHighlight,O=>`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with tremolo"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withTremolo.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tremoloParams={type:"single"};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.withTremoloHighlight,T=>`<span class="eh" ref-id="tremolo-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tremolo-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withTremoloHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with tremolo with next"]={requiredCommandProgression:"note with tremolo",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withNext.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tremoloParams.type="withNext";let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.withNextHighlight,T=>`<span class="cuph" ref-id="unit-${c}-${g}-${d}-${f+1}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="unit-${c}-${g}-${d}-${f+1}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNextHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with tremolo number of strokes"]={requiredCommandProgression:"note with tremolo",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>kT(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.tremoloParams.customNumberOfTremoloStrokes=NT(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.withNumberOfStrokesHighlight,T=>`<span class="eh" ref-id="tremolo-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tremolo-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withNumberOfStrokesHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["repeat note"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["empty line after note"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.repeat.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(i.numberOfSimileMarks+=1,u.simileMark={refId:`simile-mark-${i.numberOfSimileMarks}`,count:1,finish:!0},i.applyHighlighting){let c=o.replace(P.repeatHighlight,g=>`<span class="eh" ref-id="simile-mark-${i.numberOfSimileMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${c}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.repeatHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=k(t.pageSchema),a=N(o),i=I(a),l=w(i),h=t.pageSchema.measuresParams.length,m=o.stavesParams.length,u=a.voicesParams.length,c=t.numberOfUnitsBeforeFinishingDeclaringNewOne;jT(t,l.simileMark,h,m,u,c),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["repeat note via simile"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.viaSimile.test(n),action:(t,s,r,n,o,a,i)=>{i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["repeat note number of times"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>wT(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.simileMark.count=IT(n),i.applyHighlighting){let c=o.replace(P.simileCountHighlight,g=>`<span class="cnh" ref-id="simile-mark-${i.numberOfSimileMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.simileCountHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["repeat note vertical correction"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.simileMark.yCorrection=rt(n),i.applyHighlighting){let c=o.replace(P.verticalCorrectionHighlight,g=>`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.simileCountHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with dynamic"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withDynamic.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.withDynamic.match(n)[0];u.articulationParams=u.articulationParams||[];let g={name:"dynamicMark",textValue:c};u.articulationParams.push(g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne,b=u.articulationParams.length;if(i.applyHighlighting){let O=o.split(P.withDynamicHighlight),$=O[0],F=O[1],M=`${$}<span class="eh" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">dynamic</span>`,L=F.replace(P.stringHighlight,V=>`<span class="sth" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${V}</span>`),Q=`${M}${L}`;i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${d}-${f}-${p}-${T}-${b}">${Q}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(P.withDynamicHighlight),o=n[0],a=n[1],i=`${o}<span class="eh">dynamic</span>`,l=a.replace(P.stringHighlight,m=>`<span class="sth">${m}</span>`),h=`${i}${l}`;t.highlightsHtmlBuffer.push(h)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with dynamic above or below"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>It(n)&&!P.staveWithAndWithoutDelimeter.test([qt(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=at(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with dynamic above or below stave"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ss(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=Es(n);let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let d=o.replace(P.staveHighlight,f=>`<span class="csph" ref-id="all-staves-in-measure-${g}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-staves-in-measure-${g}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with dynamic direction"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Ct(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.direction=Xe(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note dynamic vertical correction"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=ye(u);c.yCorrection=rt(n);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.articulationParams.length;if(i.applyHighlighting){let b=o.replace(P.verticalCorrectionHighlight,O=>`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${g}-${d}-${f}-${p}-${T}">${b}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with lyrics"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withLyrics.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.relatedLyrics=u.relatedLyrics||[],u.relatedLyrics.push({});let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne,p=u.relatedLyrics.length;if(i.applyHighlighting){let T=o.replace(P.lyricsHighlight,b=>`<span class="eh" ref-id="lyrics-${c}-${g}-${d}-${f}-${p}">${b}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-${c}-${g}-${d}-${f}-${p}">${T}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.lyricsHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with lyrics text value"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>P.textValue.test(n,!1,!0),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Oi(u),g=P.textValue.match(n)[0];c.textValue=g;let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=i.numberOfUnitsBeforeFinishingDeclaringNewOne,b=u.relatedLyrics.length;if(i.applyHighlighting){let O=o.replace(P.stringHighlight,$=>`<span class="sth" ref-id="lyrics-text-${d}-${f}-${p}-${T}-${b}">${$}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-text-${d}-${f}-${p}-${T}-${b}">${O}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["note with lyrics followed by dash"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.followedByDash.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Oi(u);c.dashAfter=!0;let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.relatedLyrics.length;if(i.applyHighlighting){let b=o.replace(P.dashHighlight,O=>`<span class="eh" ref-id="lyrics-dash-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-dash-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.dashHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["note with lyrics where underscore starts"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.underscoreStarts.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Oi(u);c.underscoreStarts=!0;let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.relatedLyrics.length;if(i.applyHighlighting){let b=o.replace(P.underscoreHighlight,O=>`<span class="eh" ref-id="lyrics-underscore-starts-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-underscore-starts-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.underscoreHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["note with lyrics where underscore finishes"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.underscoreFinishes.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Oi(u);c.underscoreFinishes=!0;let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.relatedLyrics.length;if(i.applyHighlighting){let b=o.replace(P.underscoreHighlight,O=>`<span class="eh" ref-id="lyrics-underscore-finishes-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-underscore-finishes-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.underscoreHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["note with lyrics with vertical correction"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=Oi(u);c.yCorrection=rt(n);let g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=i.numberOfUnitsBeforeFinishingDeclaringNewOne,T=u.relatedLyrics.length;if(i.applyHighlighting){let b=o.replace(P.verticalCorrectionHighlight,O=>`<span class="th" ref-id="lyrics-${g}-${d}-${f}-${p}-${T}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="lyrics-${g}-${d}-${f}-${p}-${T}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["note with pedal"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withPedal.test(n)&&!P.release.test([qt(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.numberOfPedalMarks+=1;let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.pedalMark={key:`pedal-${i.numberOfPedalMarks}`,textValue:"Ped.",start:!0,finish:!0},i[`lastStartPedalMark-${i.numberOfPedalMarks}`]=u.pedalMark,P.withSustain.test(n)&&(u.pedalMark.withBrackets=!0,u.pedalMark.finish=!1),i.applyHighlighting){let c=o.replace(P.withPedalHighlight,g=>`<span class="eh" ref-id="pedal-${i.numberOfPedalMarks}">${g}</span>`).replace(P.withSustainHighlight,g=>`<span class="eh" ref-id="pedal-line-${i.numberOfPedalMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="pedal-${i.numberOfPedalMarks}">${c}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withPedalHighlight,o=>`<span class="eh">${o}</span>`).replace(P.withSustainHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with pedal under"]={requiredCommandProgression:"note with pedal",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.belowUnder.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with pedal under stave index"]={requiredCommandProgression:"note with pedal under",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>vT(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=WT(n,!0);u.pedalMark.underStaveIndex=c;let g=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let d=o.replace(P.staveIndexHighlight,f=>`<span class="csph" ref-id="stave-${g}-${c+1}">${f}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${g}-${c+1}">${d}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.staveIndexHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:3},e["note with pedal vertical correction"]={requiredCommandProgression:"note with pedal",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ot(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.pedalMark.yCorrection=rt(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.verticalCorrectionHighlight,T=>`<span class="th" ref-id="pedal-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="pedal-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with pedal text"]={requiredCommandProgression:"note with pedal",prohibitedCommandProgressions:["note with pedal opens with bracket","note with pedal before|after"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.text.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.pedalMark.textValue=P.text.match(n)[0],i.applyHighlighting){let c=o.replace(P.stringHighlight,g=>`<span class="sth" ref-id="pedal-text-${i.numberOfPedalMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="pedal-text-${i.numberOfPedalMarks}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with pedal opens with bracket"]={requiredCommandProgression:"note with pedal",prohibitedCommandProgressions:["note with pedal text","note with pedal before|after"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.opensWithBracket.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.pedalMark.textValue=void 0,u.pedalMark.withBrackets=!0,u.pedalMark.finish=!1,i.applyHighlighting){let c=o.replace(P.bracketHighlight,g=>`<span class="eh" ref-id="pedal-line-${i.numberOfPedalMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="pedal-line-${i.numberOfPedalMarks}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.bracketHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with pedal before|after"]={requiredCommandProgression:"note with pedal",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.afterBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.afterBefore.match(n)[0];c==="after"?u.pedalMark.afterUnit=!0:c==="before"&&(u.pedalMark.beforeUnit=!0),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with variable peak"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withVariablePeak.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);i[`lastStartPedalMark-${i.numberOfPedalMarks}`]&&(i[`lastStartPedalMark-${i.numberOfPedalMarks}`].finish=!1,i[`lastStartPedalMark-${i.numberOfPedalMarks}`].withBrackets=!0),u.pedalMark={key:`pedal-${i.numberOfPedalMarks}`,variablePeak:!0};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.withVariablePeakHighlight,T=>`<span class="eh" ref-id="variable-peak-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="variable-peak-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withVariablePeakHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with variable peak before|after"]={requiredCommandProgression:"note with variable peak",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.afterBefore.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.afterBefore.match(n)[0];c==="after"?u.pedalMark.afterUnit=!0:c==="before"&&(u.pedalMark.beforeUnit=!0),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with variable peak text"]={requiredCommandProgression:"note with variable peak",prohibitedCommandProgressions:["note with variable peak before|after"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.text.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.pedalMark.textValue=P.text.match(n)[0];let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.stringHighlight,T=>`<span class="sth" ref-id="variable-peak-text-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="variable-peak-text-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with release"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.withRelease.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(i[`lastStartPedalMark-${i.numberOfPedalMarks}`]&&(i[`lastStartPedalMark-${i.numberOfPedalMarks}`].finish=!1),u.pedalMark={key:`pedal-${i.numberOfPedalMarks}`,release:!0,finish:!0},i.applyHighlighting){let c=o.replace(P.withReleaseHighlight,g=>`<span class="eh" ref-id="release-${i.numberOfPedalMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="release-${i.numberOfPedalMarks}">${c}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.withReleaseHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["note with release before|after"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.afterBefore.test(n)&&!P.afterMeasure.test([r.value,qt(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m),c=P.afterBefore.match(n)[0];c==="after"?u.pedalMark.afterUnit=!0:c==="before"&&(u.pedalMark.beforeUnit=!0),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["note with release bracket"]={requiredCommandProgression:"note with release",prohibitedCommandProgressions:["note with release before|after"],onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.bracket.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);if(u.pedalMark.withBrackets=!0,u.pedalMark.withBracketClosure=!0,u.pedalMark.release=!1,u.pedalMark.finish=!0,i.applyHighlighting){let c=o.replace(P.bracketHighlight,g=>`<span class="eh" ref-id="pedal-line-${i.numberOfPedalMarks}">${g}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="pedal-line-${i.numberOfPedalMarks}">${c}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.bracketHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with release at the end of measure"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.atTheEndOfTheMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.pedalMark.atEndOfMeasure=!0,u.pedalMark.finish=!0,u.pedalMark.withBrackets&&(u.pedalMark.withBracketClosure=!0,u.pedalMark.tillEndOfMeasure=!0);let c=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let g=o.replace(P.measureHighlight,d=>`<span class="cmph" ref-id="measure-${c}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${c}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with release after measure"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>P.afterMeasure.test(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.pedalMark.atEndOfMeasure=!0,u.pedalMark.tillEndOfMeasure=!0,u.pedalMark.release=!1,u.pedalMark.withBrackets=!0,u.pedalMark.withBracketClosure=!1,u.pedalMark.finish=!1;let c=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let g=o.replace(P.measureHighlight,d=>`<span class="cmph" ref-id="measure-${c}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="measure-${c}">${g}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.measureHighlight,o=>`<span class="cmph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["note with horizontal correction"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>OT(n),action:(t,s,r,n,o,a,i)=>{let l=k(i.pageSchema),h=N(l),m=I(h),u=w(m);u.relatedXCorrection=HT(n);let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=i.numberOfUnitsBeforeFinishingDeclaringNewOne;if(i.applyHighlighting){let p=o.replace(P.horizontalCorrectionHighlight,T=>`<span class="th" ref-id="unit-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="articulation-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(P.horizontalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1}}});var gu=C((gW,du)=>{"use strict";du.exports=e=>e.parentheses[e.parentheses.length-1]});var Pu=C((fW,pu)=>{"use strict";var ET=ee(),fu=y();pu.exports=(e,t)=>{let s=ET(e);return fu.noteIndex.test(s)||fu.indexOfNote.test(s)}});var bu=C((pW,Cu)=>{"use strict";var qT=ee(),Tu=y();Cu.exports=(e,t)=>{let s=qT(e),r=Tu.noteIndex.match(s);if(r&&r[0])return r[0]*1-(t?1:0);let n=Tu.indexOfNote.match(s);return n&&n[0]?n[0]*1-(t?1:0):0}});var ku=C((PW,Wu)=>{"use strict";var W=Rt(),UT=de(),_T=Ci(),JT=Vs(),Ne=re(),we=wt(),je=Rs(),Ze=mn(),Ou=gu(),j=y(),KT=Si(),Hu=Pu(),vu=bu(),GT=be(),zT=pt(),YT=Pt(),QT=ji(),XT=1/4;Wu.exports=e=>{e.chord={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>j.chordWithDuration.test(n)&&!j.letters.test([GT(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{UT(i.pageSchema,"stavesParams",i);let l=Ne(i.pageSchema);_T(l,"voicesParams",i);let h=we(l);JT(h,"notes");let m=je(h),u=QT[j.chordWithDuration.match(n)[0]];m.push({notes:[]});let c=Ze(m),g=i.pageSchema.measuresParams.length,d=l.stavesParams.length,f=h.voicesParams.length,p=m.length;if(i.numberOfUnitsBeforeFinishingDeclaringNewOne=p,u?(c.unitDuration=u,i.lastChordDuration[d-1]||(i.lastChordDuration[d-1]={}),i.lastChordDuration[d-1][f-1]=u):i.lastChordDuration[d-1]&&i.lastChordDuration[d-1][f-1]?c.unitDuration=i.lastChordDuration[d-1][f-1]:c.unitDuration=XT,i.chordScopeIsActive=!0,i.applyHighlighting){let T=o.replace(j.withChordWithDurationHighlight,b=>`<span class="cuph" ref-id="unit-${g}-${d}-${f}-${p}">${b}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="unit-${g}-${d}-${f}-${p}">${T}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.withChordWithDurationHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{s!=="note"&&(t.chordScopeIsActive=!1);let o=Ne(t.pageSchema),a=we(o),i=je(a),l=Ze(i),h=o.stavesParams.length,m=a.voicesParams.length;t.lastBeamStatus[h-1]||(t.lastBeamStatus[h-1]={}),t.lastBeamStatus[h-1][m-1]||(t.lastBeamStatus[h-1][m-1]={plain:!1,grace:!1}),l.unitDuration>=1/4&&(l.beamedWithNext=!1),l.beamedWithNext===!1&&t.lastBeamStatus[h-1]&&t.lastBeamStatus[h-1][m-1]&&t.lastBeamStatus[h-1][m-1].plain&&!l.isGrace&&(t.lastBeamStatus[h-1][m-1].plain=!1),l.beamedWithNext===!1&&t.lastBeamStatus[h-1]&&t.lastBeamStatus[h-1][m-1]&&t.lastBeamStatus[h-1][m-1].grace&&l.isGrace&&(t.lastBeamStatus[h-1][m-1].grace=!1),t.lastBeamStatus[h-1]&&t.lastBeamStatus[h-1][m-1]&&t.lastBeamStatus[h-1][m-1].grace&&!l.isGrace&&(t.lastBeamStatus[h-1][m-1].grace=!1),t.lastBeamStatus[h-1]&&t.lastBeamStatus[h-1][m-1]&&t.lastBeamStatus[h-1][m-1].plain&&!l.isGrace&&(l.beamedWithNext=!0),t.lastBeamStatus[h-1]&&t.lastBeamStatus[h-1][m-1]&&t.lastBeamStatus[h-1][m-1].grace&&l.isGrace&&(l.beamedWithNext=!0),l.beamedWithNext===!0&&!l.isGrace&&(t.lastBeamStatus[h-1][m-1].plain=!0),l.beamedWithNext===!0&&l.isGrace&&(t.lastBeamStatus[h-1][m-1].grace=!0),t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord stave position"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.stavePosition.test(n),action:(t,s,r,n,o,a,i)=>{let l=j.stavePosition.match(n)[0],h=KT[l],m=Ne(i.pageSchema),u=we(m),c=i.pageSchema.measuresParams.length,g=m.stavesParams.length,d=u.voicesParams.length;i.lastStavePosition[g-1]||(i.lastStavePosition[g-1]={}),i.lastStavePosition[g-1][d-1]=h;let f=g;if(i.applyHighlighting){let p=o.replace(j.stavePositionHighlight,T=>(l==="next"?f=g+1:l==="prev"&&(f=g-1),`<span class="csph" ref-id="stave-${c}-${f}">${T}</span>`));i.highlightsHtmlBuffer.push(`<span class="th" ref-id="stave-${c}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.stavePositionHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["chord with parentheses"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.withParentheses.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m);u.parentheses=u.parentheses||[],u.parentheses.push({appliedToWholeUnit:!0});let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=m.length,p=u.parentheses.length;if(i.applyHighlighting){let T=o.replace(j.withParenthesesHighlight,b=>`<span class="eh" ref-id="unit-parentheses-${c}-${g}-${d}-${f}-${p}">${b}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="unit-parentheses-${c}-${g}-${d}-${f}-${p}">${T}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.withParenthesesHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord with parentheses from"]={requiredCommandProgression:"chord with parentheses",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.from.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=Ne(t.pageSchema),a=we(o),i=je(a),l=t.pageSchema.measuresParams.length,h=o.stavesParams.length,m=a.voicesParams.length,u=i.length;t.applyHighlighting&&(t.lastMentionedNoteIndex!==void 0&&(t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2].replace('ref-id=""',`ref-id="note-with-index-${l}-${h}-${m}-${u}-${t.lastMentionedNoteIndex+1}"`)),t.highlightsHtmlBuffer.push("</span>"))},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord with parentheses from note index"]={requiredCommandProgression:"chord with parentheses from",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Hu(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m),c=Ou(u),g=vu(n,!0);g!==void 0&&(c.appliedToWholeUnit=!1,c.fromNoteIndex=g,i.lastMentionedNoteIndex=g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=m.length;if(i.applyHighlighting){let b=o.replace(j.noteIndexHighlight,O=>`<span class="cuph" ref-id="note-with-index-${d}-${f}-${p}-${T}-${i.lastMentionedNoteIndex+1}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-with-index-${d}-${f}-${p}-${T}-${i.lastMentionedNoteIndex+1}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.noteIndexHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:3},e["chord with parentheses to"]={requiredCommandProgression:"chord with parentheses",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.to.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{let o=Ne(t.pageSchema),a=we(o),i=je(a),l=t.pageSchema.measuresParams.length,h=o.stavesParams.length,m=a.voicesParams.length,u=i.length;t.applyHighlighting&&(t.lastMentionedNoteIndex!==void 0&&(t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-2].replace('ref-id=""',`ref-id="note-with-index-${l}-${h}-${m}-${u}-${t.lastMentionedNoteIndex+1}"`)),t.highlightsHtmlBuffer.push("</span>"))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord with parentheses to note index"]={requiredCommandProgression:"chord with parentheses to",onTheSameLineAsPrevScenario:!0,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Hu(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m),c=Ou(u),g=vu(n,!0);g!==void 0&&(c.appliedToWholeUnit=!1,c.toNoteIndex=g,i.lastMentionedNoteIndex=g);let d=i.pageSchema.measuresParams.length,f=l.stavesParams.length,p=h.voicesParams.length,T=m.length;if(i.applyHighlighting){let b=o.replace(j.noteIndexHighlight,O=>`<span class="cuph" ref-id="note-with-index-${d}-${f}-${p}-${T}-${i.lastMentionedNoteIndex+1}">${O}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="note-with-index-${d}-${f}-${p}-${T}-${i.lastMentionedNoteIndex+1}">${b}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.noteIndexHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:3},e["chord is ghost"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.isGhost.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=l.stavesParams.length,u=h.voicesParams.length;i.lastGhostStatus[m-1]||(i.lastGhostStatus[m-1]={}),i.lastGhostStatus[m-1][u-1]=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["chord is not ghost"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.isNotGhost.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=l.stavesParams.length,u=h.voicesParams.length;i.lastGhostStatus[m-1]||(i.lastGhostStatus[m-1]={}),i.lastGhostStatus[m-1][u-1]=!1,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["chord is arpeggiated"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.arpeggiated.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m);u.arpeggiated={};let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=m.length;if(i.applyHighlighting){let p=o.replace(j.arpeggiatedHighlight,T=>`<span class="eh" ref-id="arpeggiated-wave-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="arpeggiated-wave-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.arpeggiatedHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord is arpeggiated with chord below"]={requiredCommandProgression:"chord is arpeggiated",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.withChordBelow.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m);u.arpeggiated.isConnectedWithNextChord=!0;let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=m.length;if(i.applyHighlighting){let p=o.replace(j.chordHighlight,T=>`<span class="cuph" ref-id="unit-arpeggiated-below-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="unit-arpeggiated-below-${c}-${g}-${d}-${f}">${p}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.chordHighlight,o=>`<span class="cuph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["chord is arpeggiated with arrow"]={requiredCommandProgression:"chord is arpeggiated",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.withArrow.test(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m);u.arpeggiated.arrow="up";let c=i.pageSchema.measuresParams.length,g=l.stavesParams.length,d=h.voicesParams.length,f=m.length;if(i.applyHighlighting){let p=o.replace(j.arrowHighlight,T=>`<span class="eh" ref-id="arpeggiated-arrow-${c}-${g}-${d}-${f}">${T}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="arpeggiated-arrow-${c}-${g}-${d}-${f}">${p}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(j.arrowHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["chord is arpeggiated with arrow direction"]={requiredCommandProgression:"chord is arpeggiated with arrow",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>zT(n),action:(t,s,r,n,o,a,i)=>{let l=Ne(i.pageSchema),h=we(l),m=je(h),u=Ze(m);u.arpeggiated.arrow=YT(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:3},e["chord with text"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>j.withText.test(n),action:(t,s,r,n,o,a,i)=>{let l=j.withText.match(n)[0];if(i.lastNoteTextValue=l,i.applyHighlighting){let m=o.replace(j.stringHighlight,u=>`<span class="sth" ref-id="">${u}</span>`).replace(j.withTextHighlight,u=>`<span class="eh" ref-id="">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${m}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let o=s.replace(j.stringHighlight,a=>`<span class="sth">${a}</span>`).replace(j.withTextHighlight,a=>`<span class="eh">${a}</span>`);t.highlightsHtmlBuffer.push(o)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastNoteTextPositionApplicationToNote===void 0){t.lastNoteTextPositionApplicationToNote=!0;let o=Ne(t.pageSchema),a=we(o),i=je(a),l=Ze(i);l.articulationParams=l.articulationParams||[];let h={name:"noteLetter",direction:"up",textValue:t.lastNoteTextValue};l.articulationParams.push(h);let m=t.pageSchema.measuresParams.length,u=o.stavesParams.length,c=a.voicesParams.length,g=t.numberOfUnitsBeforeFinishingDeclaringNewOne,d=l.articulationParams.length;t.applyHighlighting&&(t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1]=t.highlightsHtmlBuffer[t.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""',`ref-id="articulation-${m}-${u}-${c}-${g}-${d}"`)),t.lastNoteTextPositionApplicationToNote=void 0}t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["chord with text up or down"]=W(e["note with text up or down"],"chord with text"),e["chord with text above or below"]=W(e["note with text above or below"],"chord with text"),e["chord with text above or below stave"]=W(e["note with text above or below stave"],"chord with text"),e["chord with text up or down vertical correction"]=W(e["note with text up or down vertical correction"],"chord with text up or down"),e["chord with text above or below vertical correction"]=W(e["note with text above or below vertical correction"],"chord with text above or below"),e["chord with text above or below stave vertical correction"]=W(e["note with text above or below stave vertical correction"],"chord with text above or below stave"),e["chord with number of dots"]=W(e["note with number of dots"],"chord"),e["dotted chord"]=W(e["dotted note"],"chord"),e["chord stem direction"]=W(e["note stem direction"],"chord"),e["chord beamed"]=W(e["note beamed"],"chord"),e["chord not beamed"]=W(e["note not beamed"],"chord"),e["chord beamed with next"]=W(e["note beamed with next"],"chord beamed"),e["chord not beamed with next"]=W(e["note not beamed with next"],"chord not beamed"),e["chord beamed with only primary line"]=W(e["note beamed with only primary line"],"chord beamed"),e["chord is tied with next"]=W(e["note is tied with next"],"chord"),e["chord is tied before"]=W(e["note is tied before"],"chord"),e["chord is tied before measure number"]=W(e["note is tied before measure number"],"chord is tied before"),e["chord is tied after"]=W(e["note is tied after"],"chord"),e["chord is tied after measure number"]=W(e["note is tied after measure number"],"chord is tied after"),e["chord tied with next direction"]=W(e["note tied with next direction"],"chord is tied with next"),e["chord tied with next above or below"]=W(e["note tied with next above or below"],"chord is tied with next"),e["chord tied before direction"]=W(e["note tied before direction"],"chord is tied before"),e["chord tied before above or below"]=W(e["note tied before above or below"],"chord is tied before"),e["chord tied after direction"]=W(e["note tied after direction"],"chord is tied after"),e["chord tied after above or below"]=W(e["note tied after above or below"],"chord is tied after"),e["chord tied with next roundness"]=W(e["note tied with next roundness"],"chord is tied with next"),e["chord tied before roundness"]=W(e["note tied before roundness"],"chord is tied before"),e["chord tied after roundness"]=W(e["note tied after roundness"],"chord is tied after"),e["chord with glissando"]=W(e["note with glissando"],"chord"),e["chord with glissando direction"]=W(e["note with glissando direction"],"chord with glissando"),e["chord with glissando after"]=W(e["note with glissando after"],"chord with glissando"),e["chord with glissando before"]=W(e["note with glissando before"],"chord with glissando"),e["chord with glissando after measure number"]=W(e["note with glissando after measure number"],"chord with glissando after"),e["chord with glissando before measure number"]=W(e["note with glissando after measure number"],"chord with glissando before"),e["chord is grace"]=W(e["note is grace"],"chord"),e["chord with crushed grace"]=W(e["note with crushed grace"],"chord is grace"),e["chord is rest"]=W(e["note is rest"],"chord"),e["chord is centralized"]=W(e["note is centralized"],"chord"),e["chord with breath mark before"]=W(e["note with breath mark before"],"chord"),e["chord with breath mark before vertical correction"]=W(e["note with breath mark before vertical correction"],"chord with breath mark before"),e["chord with key signature before"]=W(e["note with key signature before"],"chord"),e["chord with clef before"]=W(e["note with clef before"],"chord"),e["chord with clef and key signature before"]=W(e["note with clef before"],"chord"),e["chord with articulation"]=W(e["note with articulation"],"chord"),e["chord with turn"]=W(e["note with turn"],"chord"),e["chord with mordent"]=W(e["note with mordent"],"chord"),e["chord with trill"]=W(e["note with trill"],"chord"),e["chord with articulation direction"]=W(e["note with articulation direction"],"chord with articulation"),e["chord with turn direction"]=W(e["note with turn direction"],"chord with turn"),e["chord with mordent direction"]=W(e["note with mordent direction"],"chord with mordent"),e["chord with trill direction"]=W(e["note with trill direction"],"chord with trill"),e["chord with articulation above or below"]=W(e["note with articulation above or below"],"chord with articulation"),e["chord with turn above or below"]=W(e["note with turn above or below"],"chord with turn"),e["chord with mordent above or below"]=W(e["note with mordent above or below"],"chord with mordent"),e["chord with trill above or below"]=W(e["note with trill above or below"],"chord with trill"),e["chord with articulation above or below stave"]=W(e["note with articulation above or below stave"],"chord with articulation"),e["chord with turn above or below stave"]=W(e["note with turn above or below stave"],"chord with turn"),e["chord with mordent above or below stave"]=W(e["note with mordent above or below stave"],"chord with mordent"),e["chord with trill above or below stave"]=W(e["note with trill above or below stave"],"chord with trill"),e["chord with turn key above or below"]=W(e["note with turn key above or below"],"chord with turn"),e["chord with mordent key above or below"]=W(e["note with mordent key above or below"],"chord with mordent"),e["chord with trill key above or below"]=W(e["note with trill key above or below"],"chord with trill"),e["chord with turn after"]=W(e["note with turn after"],"chord with turn"),e["chord with turn inverted"]=W(e["note with turn inverted"],"chord with turn"),e["chord with trill with wave after"]=W(e["note with trill with wave after"],"chord with trill"),e["chord with articulation vertical correction"]=W(e["note with articulation vertical correction"],"chord with articulation"),e["chord with turn vertical correction"]=W(e["note with turn vertical correction"],"chord with turn"),e["chord with mordent vertical correction"]=W(e["note with mordent vertical correction"],"chord with mordent"),e["chord with trill vertical correction"]=W(e["note with trill vertical correction"],"chord with trill"),e["chord with chord letter"]=W(e["note with chord letter"],"chord"),e["chord with chord letter direction"]=W(e["note with chord letter direction"],"chord with chord letter"),e["chord with chord letter above or below"]=W(e["note with chord letter above or below"],"chord with chord letter"),e["chord with chord letter above or below measure"]=W(e["note with chord letter above or below measure"],"chord with chord letter above or below"),e["chord with chord letter vertical correction"]=W(e["note with chord letter vertical correction"],"chord with chord letter"),e["chord with octave sign"]=W(e["note with octave sign"],"chord"),e["chord with octave sign vertical correction"]=W(e["note with octave sign vertical correction"],"chord with octave sign"),e["chord with tremolo"]=W(e["note with tremolo"],"chord"),e["chord with tremolo with next"]=W(e["note with tremolo with next"],"chord with tremolo"),e["chord with tremolo number of strokes"]=W(e["note with tremolo number of strokes"],"chord with tremolo"),e["repeat chord"]=W(e["repeat note"],"chord"),e["repeat chord via simile"]=W(e["repeat note via simile"],"repeat chord"),e["repeat chord number of times"]=W(e["repeat note number of times"],"repeat chord"),e["repeat chord vertical correction"]=W(e["repeat note vertical correction"],"repeat chord"),e["chord with dynamic"]=W(e["note with dynamic"],"chord"),e["chord with dynamic direction"]=W(e["note with dynamic direction"],"chord with dynamic"),e["chord with dynamic above or below"]=W(e["note with dynamic above or below"],"chord with dynamic"),e["chord with dynamic above or below stave"]=W(e["note with dynamic above or below stave"],"chord with dynamic"),e["chord dynamic vertical correction"]=W(e["note dynamic vertical correction"],"chord with dynamic"),e["chord with lyrics"]=W(e["note with lyrics"],"chord"),e["chord with lyrics text value"]=W(e["note with lyrics text value"],"chord with lyrics"),e["chord with lyrics followed by dash"]=W(e["note with lyrics followed by dash"],"chord with lyrics"),e["chord with lyrics where underscore starts"]=W(e["note with lyrics where underscore starts"],"chord with lyrics"),e["chord with lyrics where underscore finishes"]=W(e["note with lyrics where underscore finishes"],"chord with lyrics"),e["chord with lyrics with vertical correction"]=W(e["note with lyrics with vertical correction"],"chord with lyrics"),e["chord with pedal"]=W(e["note with pedal"],"chord"),e["chord with pedal under"]=W(e["note with pedal under"],"chord with pedal"),e["chord with pedal under stave index"]=W(e["note with pedal under stave index"],"chord with pedal under"),e["chord with pedal vertical correction"]=W(e["note with pedal vertical correction"],"chord with pedal"),e["chord with pedal text"]=W(e["note with pedal text"],"chord with pedal"),e["chord with pedal opens with bracket"]=W(e["note with pedal opens with bracket"],"chord with pedal"),e["chord with pedal before|after"]=W(e["note with pedal before|after"],"chord with pedal"),e["chord with variable peak"]=W(e["note with variable peak"],"chord"),e["chord with variable peak before|after"]=W(e["note with variable peak before|after"],"chord with variable peak"),e["chord with variable peak text"]=W(e["note with variable peak text"],"chord with variable peak"),e["chord with release"]=W(e["note with release"],"chord"),e["chord with release before|after"]=W(e["note with release before|after"],"chord with release"),e["chord with release bracket"]=W(e["note with release bracket"],"chord with release"),e["chord with release at the end of measure"]=W(e["note with release at the end of measure"],"chord with release"),e["chord with release after measure"]=W(e["note with release after measure"],"chord with release"),e["chord with horizontal correction"]=W(e["note with horizontal correction"],"chord")}});var gn=C((TW,Nu)=>{"use strict";Nu.exports=e=>{let t;return e.pageSchema.measuresParams&&(t=e.numberOfPageLines-1),t}});var Bt=C((CW,wu)=>{"use strict";var ZT=gn();wu.exports=e=>{let t=e.pageSchema,s=e.lastMentionedUnitPosition,r=e.lastMentionedPageLinePosition,n=e.lastMentionedMeasurePosition,o=e.lastMentionedStavePosition,a=e.lastMentionedVoicePosition,i=s===void 0,l=r===void 0,h=n===void 0,m=o===void 0,u=a===void 0;if(l&&(r=ZT(e),l=r===void 0),e.calculatedUnitPageLineIndexByLastMentionedPositions=r,i)return null;if(h||(e.calculatedUnitMeasureIndexByLastMentionedPositions=void 0),m||(e.calculatedUnitStaveIndexByLastMentionedPositions=void 0),u||(e.calculatedUnitVoiceIndexByLastMentionedPositions=void 0),t.measuresParams)if(l)if(h)if(m)if(u){let c=0;for(let g=0;g<t.measuresParams.length;g++)if(t.measuresParams[g].stavesParams){for(let d=0;d<t.measuresParams[g].stavesParams.length;d++)if(t.measuresParams[g].stavesParams[d]&&t.measuresParams[g].stavesParams[d].voicesParams){for(let f=0;f<t.measuresParams[g].stavesParams[d].voicesParams.length;f++)if(t.measuresParams[g].stavesParams[d].voicesParams[f])for(let p=0;p<t.measuresParams[g].stavesParams[d].voicesParams[f].length;p++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=g,e.calculatedUnitStaveIndexByLastMentionedPositions=d,e.calculatedUnitVoiceIndexByLastMentionedPositions=f,e.calculatedUnitIndexByLastMentionedPositions=p,t.measuresParams[g].stavesParams[d].voicesParams[f][p];c+=1}}}}else{let c=0;for(let g=0;g<t.measuresParams.length;g++)if(t.measuresParams[g].stavesParams){for(let d=0;d<t.measuresParams[g].stavesParams.length;d++)if(t.measuresParams[g].stavesParams[d]&&t.measuresParams[g].stavesParams[d].voicesParams&&t.measuresParams[g].stavesParams[d].voicesParams[a])for(let f=0;f<t.measuresParams[g].stavesParams[d].voicesParams[a].length;f++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=g,e.calculatedUnitStaveIndexByLastMentionedPositions=d,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=f,t.measuresParams[g].stavesParams[d].voicesParams[a][f];c+=1}}}else if(u){let c=0;for(let g=0;g<t.measuresParams.length;g++)if(t.measuresParams[g].stavesParams&&t.measuresParams[g].stavesParams[o]&&t.measuresParams[g].stavesParams[o].voicesParams){for(let d=0;d<t.measuresParams[g].stavesParams[o].voicesParams.length;d++)if(t.measuresParams[g].stavesParams[o].voicesParams[d])for(let f=0;f<t.measuresParams[g].stavesParams[o].voicesParams[d].length;f++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=g,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=d,e.calculatedUnitIndexByLastMentionedPositions=f,t.measuresParams[g].stavesParams[o].voicesParams[d][f];c+=1}}}else{let c=0;for(let g=0;g<t.measuresParams.length;g++)if(t.measuresParams[g].stavesParams&&t.measuresParams[g].stavesParams[o]&&t.measuresParams[g].stavesParams[o].voicesParams&&t.measuresParams[g].stavesParams[o].voicesParams[a]&&t.measuresParams[g].stavesParams[o].voicesParams[a])for(let d=0;d<t.measuresParams[g].stavesParams[o].voicesParams[a].length;d++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=g,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=d,t.measuresParams[g].stavesParams[o].voicesParams[a][d];c+=1}}else if(m)if(u){let c=0;if(t.measuresParams[n]&&t.measuresParams[n].stavesParams){for(let g=0;g<t.measuresParams[n].stavesParams.length;g++)if(t.measuresParams[n].stavesParams[g]&&t.measuresParams[n].stavesParams[g].voicesParams){for(let d=0;d<t.measuresParams[n].stavesParams[g].voicesParams.length;d++)if(t.measuresParams[n].stavesParams[g].voicesParams[d])for(let f=0;f<t.measuresParams[n].stavesParams[g].voicesParams[d].length;f++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=n,e.calculatedUnitStaveIndexByLastMentionedPositions=g,e.calculatedUnitVoiceIndexByLastMentionedPositions=d,e.calculatedUnitIndexByLastMentionedPositions=f,t.measuresParams[n].stavesParams[g].voicesParams[d][f];c+=1}}}}else{let c=0;if(t.measuresParams[n]&&t.measuresParams[n].stavesParams){for(let g=0;g<t.measuresParams[n].stavesParams.length;g++)if(t.measuresParams[n].stavesParams[g].voicesParams&&t.measuresParams[n].stavesParams[g].voicesParams[a])for(let d=0;d<t.measuresParams[n].stavesParams[g].voicesParams[a].length;d++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=n,e.calculatedUnitStaveIndexByLastMentionedPositions=g,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=d,t.measuresParams[n].stavesParams[g].voicesParams[a][d];c+=1}}}else if(u){let c=0;if(t.measuresParams[n]&&t.measuresParams[n].stavesParams&&t.measuresParams[n].stavesParams[o]&&t.measuresParams[n].stavesParams[o].voicesParams){for(let g=0;g<t.measuresParams[n].stavesParams[o].voicesParams.length;g++)if(t.measuresParams[n].stavesParams[o].voicesParams[g])for(let d=0;d<t.measuresParams[n].stavesParams[o].voicesParams[g].length;d++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=n,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=g,e.calculatedUnitIndexByLastMentionedPositions=d,t.measuresParams[n].stavesParams[o].voicesParams[g][d];c+=1}}}else{let c=0;if(t.measuresParams[n]&&t.measuresParams[n].stavesParams&&t.measuresParams[n].stavesParams[o]&&t.measuresParams[n].stavesParams[o].voicesParams&&t.measuresParams[n].stavesParams[o].voicesParams[a])for(let g=0;g<t.measuresParams[n].stavesParams[o].voicesParams[a].length;g++){if(c===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=n,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=g,t.measuresParams[n].stavesParams[o].voicesParams[a][g];c+=1}}else if(h)if(m)if(u){let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams){for(let p=0;p<t.measuresParams[d].stavesParams.length;p++)if(t.measuresParams[d].stavesParams[p]&&t.measuresParams[d].stavesParams[p].voicesParams){for(let T=0;T<t.measuresParams[d].stavesParams[p].voicesParams.length;T++)if(t.measuresParams[d].stavesParams[p].voicesParams[T])for(let b=0;b<t.measuresParams[d].stavesParams[p].voicesParams[T].length;b++){if(c===r&&g===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=p,e.calculatedUnitVoiceIndexByLastMentionedPositions=T,e.calculatedUnitIndexByLastMentionedPositions=b,t.measuresParams[d].stavesParams[p].voicesParams[T][b];g+=1}}}f&&(g=0,c+=1)}}else{let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams){for(let p=0;p<t.measuresParams[d].stavesParams.length;p++)if(t.measuresParams[d].stavesParams[p]&&t.measuresParams[d].stavesParams[p].voicesParams&&t.measuresParams[d].stavesParams[p].voicesParams[a])for(let T=0;T<t.measuresParams[d].stavesParams[p].voicesParams[a].length;T++){if(c===r&&g===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=p,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=T,t.measuresParams[d].stavesParams[p].voicesParams[a][T];g+=1}}f&&(g=0,c+=1)}}else if(u){let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams&&t.measuresParams[d].stavesParams[o]&&t.measuresParams[d].stavesParams[o].voicesParams){for(let p=0;p<t.measuresParams[d].stavesParams[o].voicesParams.length;p++)if(t.measuresParams[d].stavesParams[o].voicesParams[p])for(let T=0;T<t.measuresParams[d].stavesParams[o].voicesParams[p].length;T++){if(c===r&&g===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=p,e.calculatedUnitIndexByLastMentionedPositions=T,t.measuresParams[d].stavesParams[o].voicesParams[p][T];g+=1}}f&&(g=0,c+=1)}}else{let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams&&t.measuresParams[d].stavesParams[o]&&t.measuresParams[d].stavesParams[o].voicesParams&&t.measuresParams[d].stavesParams[o].voicesParams[a])for(let p=0;p<t.measuresParams[d].stavesParams[o].voicesParams[a].length;p++){if(c===r&&g===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=p,t.measuresParams[d].stavesParams[o].voicesParams[a][p];g+=1}f&&(g=0,c+=1)}}else if(m)if(u){let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams){for(let p=0;p<t.measuresParams[d].stavesParams.length;p++)if(t.measuresParams[d].stavesParams[p]&&t.measuresParams[d].stavesParams[p].voicesParams){for(let T=0;T<t.measuresParams[d].stavesParams[p].voicesParams.length;T++)if(t.measuresParams[d].stavesParams[p].voicesParams[T]){for(let b=0;b<t.measuresParams[d].stavesParams[p].voicesParams[T].length;b++)if(c===r&&g===n&&b===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=p,e.calculatedUnitVoiceIndexByLastMentionedPositions=T,e.calculatedUnitIndexByLastMentionedPositions=b,t.measuresParams[d].stavesParams[p].voicesParams[T][b]}}}f?(c+=1,g=0):g+=1}}else{let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams){for(let p=0;p<t.measuresParams[d].stavesParams.length;p++)if(t.measuresParams[d].stavesParams[p]&&t.measuresParams[d].stavesParams[p].voicesParams&&t.measuresParams[d].stavesParams[p].voicesParams[a]){for(let T=0;T<t.measuresParams[d].stavesParams[p].voicesParams[a].length;T++)if(c===r&&g===n&&T===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=p,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=T,t.measuresParams[d].stavesParams[p].voicesParams[a][T]}}f?(c+=1,g=0):g+=1}}else if(u){let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams&&t.measuresParams[d].stavesParams[o]&&t.measuresParams[d].stavesParams[o].voicesParams){for(let p=0;p<t.measuresParams[d].stavesParams[o].voicesParams.length;p++)if(t.measuresParams[d].stavesParams[o].voicesParams[p]){for(let T=0;T<t.measuresParams[d].stavesParams[o].voicesParams[p].length;T++)if(c===r&&g===n&&T===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=p,e.calculatedUnitIndexByLastMentionedPositions=T,t.measuresParams[d].stavesParams[o].voicesParams[p][T]}}f?(c+=1,g=0):g+=1}}else{let c=0,g=0;for(let d=0;d<t.measuresParams.length;d++){let f=t.measuresParams[d].isLastMeasureOnPageLine||d===t.measuresParams.length-1;if(t.measuresParams[d].stavesParams&&t.measuresParams[d].stavesParams[o]&&t.measuresParams[d].stavesParams[o].voicesParams&&t.measuresParams[d].stavesParams[o].voicesParams[a]){for(let p=0;p<t.measuresParams[d].stavesParams[o].voicesParams[a].length;p++)if(c===r&&g===n&&p===s)return e.calculatedUnitMeasureIndexByLastMentionedPositions=d,e.calculatedUnitStaveIndexByLastMentionedPositions=o,e.calculatedUnitVoiceIndexByLastMentionedPositions=a,e.calculatedUnitIndexByLastMentionedPositions=p,t.measuresParams[d].stavesParams[o].voicesParams[a][p]}f?(c+=1,g=0):g+=1}}return null}});var $u=C((bW,Iu)=>{"use strict";Iu.exports=(e,t,s)=>{e.slurMarkChords[t]&&e.slurMarkChords[t].forEach((r,n)=>{let o=r.slurMarks.findIndex(a=>a.key===t&&a.finish);o!==-1&&r.slurMarks.splice(o,1)}),s.slurMarks.forEach((r,n)=>{r.key===t&&!r.finish&&s.slurMarks.splice(n,1)})}});var yt=C((OW,Bu)=>{"use strict";Bu.exports=(e,t)=>{if(e.slurMarkChords[t]&&e.slurMarkChords[t][0]&&e.slurMarkChords[t][0].slurMarks){let s=e.slurMarkChords[t][0].slurMarks.find(r=>r.key===t);if(s)return s}}});var Au=C((HW,yu)=>{"use strict";var eC=yt();yu.exports=(e,t,s)=>{let r=eC(e,t);r&&(r.direction=s)}});var Fu=C((vW,xu)=>{"use strict";var tC=yt();xu.exports=(e,t,s)=>{let r=tC(e,t);r&&(r.roundCoefficientFactor=s)}});var Mu=C((WW,Du)=>{"use strict";var iC=yt();Du.exports=(e,t)=>{let s=iC(e,t);s&&(s.sShape=!0)}});var Vu=C((kW,Lu)=>{"use strict";var nC=yt();Lu.exports=(e,t,s)=>{let r=nC(e,t);r&&(r.leftYCorrection=s)}});var ju=C((NW,Ru)=>{"use strict";var sC=yt();Ru.exports=(e,t,s)=>{let r=sC(e,t);r&&(r.rightYCorrection=s)}});var Eu=C((wW,Su)=>{"use strict";var oC=yt();Su.exports=(e,t,s)=>{let r=oC(e,t);r&&(r.rightPlacement=s)}});var bt=C((IW,qu)=>{"use strict";qu.exports=e=>{e.lastMentionedPageLinePosition=void 0,e.lastMentionedMeasurePosition=void 0,e.lastMentionedStavePosition=void 0,e.lastMentionedVoicePosition=void 0,e.lastMentionedUnitPosition=void 0,e.calculatedUnitMeasureIndexByLastMentionedPositions=void 0,e.calculatedUnitStaveIndexByLastMentionedPositions=void 0,e.calculatedUnitVoiceIndexByLastMentionedPositions=void 0,e.calculatedUnitIndexByLastMentionedPositions=void 0,e.lastMentionedConnectionPageLinePosition=void 0,e.lastMentionedConnectionMeasurePosition=void 0,e.lastMentionedConnectionStavePosition=void 0,e.lastMentionedConnectionVoicePosition=void 0}});var At=C(($W,Uu)=>{"use strict";Uu.exports=e=>{e.lastMentionedUnitPosition=void 0,e.calculatedUnitIndexByLastMentionedPositions=void 0}});var Ot=C((BW,_u)=>{"use strict";var rC=gn();_u.exports=(e,t)=>{let s=t?e.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection:e.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders;if(e.calculatedUnitPageLineIndexByLastMentionedPositions!==void 0&&e.calculatedUnitMeasureIndexByLastMentionedPositions!==void 0&&e.calculatedUnitStaveIndexByLastMentionedPositions!==void 0&&e.calculatedUnitVoiceIndexByLastMentionedPositions!==void 0&&e.calculatedUnitIndexByLastMentionedPositions!==void 0&&!t)for(let r=0;r<s.length;r++)e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="clph" ref-id=""',`class="clph" ref-id="line-${e.calculatedUnitPageLineIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="clpph" ref-id=""',`class="clpph" ref-id="line-${e.calculatedUnitPageLineIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cmph" ref-id=""',`class="cmph" ref-id="measure-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cmpph" ref-id=""',`class="cmpph" ref-id="measure-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="csph" ref-id=""',`class="csph" ref-id="stave-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cspph" ref-id=""',`class="cspph" ref-id="stave-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cvph" ref-id=""',`class="cvph" ref-id="voice-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}-${e.calculatedUnitVoiceIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cvpph" ref-id=""',`class="cvpph" ref-id="voice-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}-${e.calculatedUnitVoiceIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cuph" ref-id=""',`class="cuph" ref-id="unit-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}-${e.calculatedUnitVoiceIndexByLastMentionedPositions+1}-${e.calculatedUnitIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="cupph" ref-id=""',`class="cupph" ref-id="unit-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}-${e.calculatedUnitVoiceIndexByLastMentionedPositions+1}-${e.calculatedUnitIndexByLastMentionedPositions+1}"`),e.highlightsHtmlBuffer[s[r]]=e.highlightsHtmlBuffer[s[r]].replace('class="th" ref-id=""',`class="th" ref-id="unit-${e.calculatedUnitMeasureIndexByLastMentionedPositions+1}-${e.calculatedUnitStaveIndexByLastMentionedPositions+1}-${e.calculatedUnitVoiceIndexByLastMentionedPositions+1}-${e.calculatedUnitIndexByLastMentionedPositions+1}"`);else{let r=t?e.lastMentionedConnectionPageLinePosition:e.lastMentionedPageLinePosition,n=t?e.lastMentionedConnectionMeasurePosition:e.lastMentionedMeasurePosition,o=t?e.lastMentionedConnectionStavePosition:e.lastMentionedStavePosition,a=t?e.lastMentionedConnectionVoicePosition:e.lastMentionedVoicePosition,i=r===void 0,l=n!==void 0,h=o!==void 0,m=a!==void 0;if(i&&(r=rC(e),i=r===void 0),!i)for(let u=0;u<s.length;u++)e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="clph" ref-id=""',`class="clph" ref-id="line-${r+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="clpph" ref-id=""',`class="clpph" ref-id="line-${r+1}"`),l?(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cmph" ref-id=""',`class="cmph" ref-id="measure-${r+1}-${n+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cmpph" ref-id=""',`class="cmpph" ref-id="measure-${r+1}-${n+1}"`),h?(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="csph" ref-id=""',`class="csph" ref-id="stave-${r+1}-${n+1}-${o+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cspph" ref-id=""',`class="cspph" ref-id="stave-${r+1}-${n+1}-${o+1}"`),m&&(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvph" ref-id=""',`class="cvph" ref-id="voice-${r+1}-${n+1}-${o+1}-${a+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvpph" ref-id=""',`class="cvpph" ref-id="voice-${r+1}-${n+1}-${o+1}-${a+1}"`))):m&&(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvph" ref-id=""',`class="cvph" ref-id="voice-in-measure-on-all-staves-${r+1}-${n+1}-${a+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvpph" ref-id=""',`class="cvpph" ref-id="voice-in-measure-on-all-staves-${r+1}-${n+1}-${a+1}"`))):h?(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="csph" ref-id=""',`class="csph" ref-id="stave-in-all-measures-on-line-${r+1}-${o+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cspph" ref-id=""',`class="cspph" ref-id="stave-in-all-measures-on-line-${r+1}-${o+1}"`),m&&(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvph" ref-id=""',`class="cvph" ref-id="voice-${o+1}-${a+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvpph" ref-id=""',`class="cvpph" ref-id="voice-${o+1}-${a+1}"`))):m&&(e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvph" ref-id=""',`class="cvph" ref-id="voice-in-all-measures-and-on-all-staves-on-line-${r+1}-${a+1}"`),e.highlightsHtmlBuffer[s[u]]=e.highlightsHtmlBuffer[s[u]].replace('class="cvpph" ref-id=""',`class="cvpph" ref-id="voice-in-all-measures-and-on-all-staves-on-line-${r+1}-${a+1}"`))}s.length=0}});var lt=C((yW,Ju)=>{"use strict";var q=y(),ve=ee();Ju.exports=(e,t,s=[],r=2,n=!1,o={line:!0,measure:!0,stave:!0,voice:!0})=>{o.line&&(e[`line position (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.unitLinePosition.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.unitLinePosition.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionPageLinePosition=d),c.lastMentionedPageLinePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="clph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="clph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r},e[`position of line (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.linePositionOfUnit.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.linePositionOfUnit.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionPageLinePosition=d),c.lastMentionedPageLinePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="clph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="clpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="clph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r}),o.measure&&(e[`measure position (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.unitMeasurePosition.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.unitMeasurePosition.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionMeasurePosition=d),c.lastMentionedMeasurePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="cmph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cmpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="cmph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r},e[`position of measure (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.measurePositionOfUnit.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.measurePositionOfUnit.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionMeasurePosition=d),c.lastMentionedMeasurePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="cmph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cmpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="cmph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r}),o.stave&&(e[`stave position (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.unitStavePosition.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.unitStavePosition.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionStavePosition=d),c.lastMentionedStavePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="csph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cspph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="csph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r},e[`position of stave (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.stavePositionOfUnit.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.stavePositionOfUnit.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionStavePosition=d),c.lastMentionedStavePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="csph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cspph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="csph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r}),o.voice&&(e[`voice position (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.unitVoicePosition.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.unitVoicePosition.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionVoicePosition=d),c.lastMentionedVoicePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="cvph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cvpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="cvph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r},e[`position of voice (${t})`]={requiredCommandProgression:t,prohibitedCommandProgressions:s,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(a,i,l,h,m,u,c)=>{if(n&&c.lastMentionedUnitPosition!==void 0)return!1;let g=ve(h);return q.voicePositionOfUnit.test(g)},action:(a,i,l,h,m,u,c)=>{let g=ve(h),d=q.voicePositionOfUnit.match(g)[0]*1-1;if(n&&(c.lastMentionedConnectionVoicePosition=d),c.lastMentionedVoicePosition=d,c.applyHighlighting){let f=m.trimEnd(),p=f.replace(q.positionPreposition,(T,b,O,$,F)=>`${b||""}<span class="cvph" ref-id="">${F}</span>`);c.highlightsHtmlBuffer.push(`<span class="cvpph" ref-id="">${p}</span>${m.slice(f.length)}`),n?c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(c.highlightsHtmlBuffer.length-1):c.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(c.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(a,i,l)=>{let h=i.trimEnd(),m=h.replace(q.positionPreposition,(u,c,g,d,f)=>`${c||""}<span class="cvph">${f}</span>`);a.highlightsHtmlBuffer.push(`${m}${i.slice(h.length)}`)},itIsNewCommandProgressionFromLevel:r})}});var xt=C((AW,Ku)=>{"use strict";var Ht=y(),fn=ee(),aC=lt();Ku.exports=(e,t,s=2,r)=>{e[`unit position (${t})`]={requiredCommandProgression:t,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(n,o,a,i,l,h,m)=>{let u=fn(i);return Ht.unitPosition.test(u)},action:(n,o,a,i,l,h,m)=>{let u=fn(i),c=Ht.unitPosition.match(u)[0]*1-1;if(m.lastMentionedUnitPosition=c,m.applyHighlighting){let g=l.trimEnd(),d=g.replace(Ht.positionPreposition,(f,p,T,b,O)=>`${p||""}<span class="cuph" ref-id="">${O}</span>`);m.highlightsHtmlBuffer.push(`<span class="cupph" ref-id="">${d}</span>${l.slice(g.length)}`),m.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(m.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(n,o,a)=>{let i=o.trimEnd(),l=i.replace(Ht.positionPreposition,(h,m,u,c,g)=>`${m||""}<span class="cuph">${g}</span>`);n.highlightsHtmlBuffer.push(`${l}${o.slice(i.length)}`)},itIsNewCommandProgressionFromLevel:s},e[`position of unit (${t})`]={requiredCommandProgression:t,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(n,o,a,i,l,h,m)=>{let u=fn(i);return Ht.positionOfUnit.test(u)},action:(n,o,a,i,l,h,m)=>{let u=fn(i),c=Ht.positionOfUnit.match(u)[0]*1-1;if(m.lastMentionedUnitPosition=c,m.applyHighlighting){let g=l.trimEnd(),d=g.replace(Ht.positionPreposition,(f,p,T,b,O)=>`${p||""}<span class="cuph" ref-id="">${O}</span>`);m.highlightsHtmlBuffer.push(`<span class="cupph" ref-id="">${d}</span>${l.slice(g.length)}`),m.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(m.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:(n,o,a)=>{let i=o.trimEnd(),l=i.replace(Ht.positionPreposition,(h,m,u,c,g)=>`${m||""}<span class="cuph">${g}</span>`);n.highlightsHtmlBuffer.push(`${l}${o.slice(i.length)}`)},itIsNewCommandProgressionFromLevel:s},aC(e,t,[],s,!1,r)}});var im=C((xW,tm)=>{"use strict";var G=y(),qs=be(),lC=pt(),hC=Pt(),uC=Ds(),mC=Ms(),_t=mi(),Jt=ci(),Gu=Ve(),zu=Re(),Hi=Bt(),Yu=$u(),pn=Au(),Qu=Fu(),Xu=Mu(),Zu=Vu(),em=ju(),Us=Eu(),cC=bt(),Kt=At(),Gt=Ot(),vi=xt(),dC=lt(),Wi=(e,t)=>{e.lastSlurDirection&&(pn(e,t,e.lastSlurDirection),e.lastSlurDirection=void 0),e.lastSlurRoundness&&(Qu(e,t,e.lastSlurRoundness),e.lastSlurRoundness=void 0),e.lastSlurLeftYCorrection&&(Zu(e,t,e.lastSlurLeftYCorrection),e.lastSlurLeftYCorrection=void 0),e.lastSlurRightYCorrection&&(em(e,t,e.lastSlurRightYCorrection),e.lastSlurRightYCorrection=void 0),e.lastSlurRightPointPlacement&&(Us(e,t,e.lastSlurRightPointPlacement),e.lastSlurRightPointPlacement=void 0),e.lastSlurWithSShape&&(Xu(e,t),e.lastSlurWithSShape=void 0)};tm.exports=e=>{e.slur={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>G.slur.test(n),action:(t,s,r,n,o,a,i)=>{if(cC(i),i.lastSlurDirection=void 0,i.lastSShapeSlurPartDirection=void 0,i.lastSlurRoundness=void 0,i.lastSlurLeftYCorrection=void 0,i.lastSlurRightYCorrection=void 0,i.lastSlurRightPointPlacement=void 0,i.lastSlurWithSShape=void 0,i.numberOfSlurs+=1,i.applyHighlighting){let l=o.replace(G.slurHighlight,h=>`<span class="eh" ref-id="slur-${i.numberOfSlurs}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="eh" ref-id="slur-${i.numberOfSlurs}">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(G.slurHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Gt(t,!0),t.highlightsHtmlBuffer.push("</span>")),Kt(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["slur starts before unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit","slur finishes after unit","slur starts at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.startsBefore.test(n)||G.before.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Hi(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.slurMarks=o.slurMarks||[];let a=`slur-${t.numberOfSlurs}`;o.slurMarks.push({key:a,before:!0}),o.slurMarks.push({key:a,finish:!0}),t.slurMarkChords[a]=t.slurMarkChords[a]||[],t.slurMarkChords[a].push(o),Wi(t,a)}}t.applyHighlighting&&(Gt(t),t.highlightsHtmlBuffer.push("</span>")),Kt(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},vi(e,"slur starts before unit",2,{measure:!0,stave:!0}),e["slur starts before above|below unit"]={requiredCommandProgression:"slur starts before unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{i.lastSlurDirection=Jt(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["slur finishes after unit"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.finishesAfter.test(n)||G.after.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line ${n.lineNumber}`);else{let o=Hi(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.slurMarks=o.slurMarks||[];let a=`slur-${t.numberOfSlurs}`;Yu(t,a,o),t.slurMarkChords[a]=t.slurMarkChords[a]||[],t.slurMarkChords[a].length===0&&(o.slurMarks.push({key:a}),t.slurMarkChords[a].push(o));let i={key:a,finish:!0,after:!0};t.lastSShapeSlurPartDirection&&(i.direction=t.lastSShapeSlurPartDirection,t.lastSShapeSlurPartDirection=void 0),o.slurMarks.push(i),t.slurMarkChords[a].push(o),Wi(t,a)}}t.applyHighlighting&&(Gt(t),t.highlightsHtmlBuffer.push("</span>"),Kt(t))},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},vi(e,"slur finishes after unit",2,{measure:!0,stave:!0}),e["slur finishes after above|below unit"]={requiredCommandProgression:"slur finishes after unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=Jt(n);pn(i,l,h),i.lastSShapeSlurPartDirection=h,i.lastSlurDirection=h,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["slur starts at unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit","slur finishes after unit","slur starts after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(G.starts.test(n)&&!G.from.test([qs(t,r.firstCharIndexOfNextToken)])||G.from.test(n)||G.startsFrom.test(n))&&!G.before.test([qs(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Hi(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.slurMarks=o.slurMarks||[];let a=`slur-${t.numberOfSlurs}`,i={key:a};o.slurMarks.push(i),t.slurMarkChords[a]=t.slurMarkChords[a]||[],t.slurMarkChords[a].push(o),Wi(t,a)}}t.applyHighlighting&&(Gt(t),t.highlightsHtmlBuffer.push("</span>")),Kt(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},vi(e,"slur starts at unit",2,{measure:!0,stave:!0}),e["slur starts above|below unit"]={requiredCommandProgression:"slur starts at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{i.lastSlurDirection=Jt(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["slur finishes at unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(G.finishes.test(n)||G.to.test(n))&&!G.after.test([qs(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Hi(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.slurMarks=o.slurMarks||[];let a=`slur-${t.numberOfSlurs}`;if(Yu(t,a,o),t.slurMarkChords[a]=t.slurMarkChords[a]||[],t.slurMarkChords[a].length>0){let i={key:a,finish:!0};t.lastSShapeSlurPartDirection&&(i.direction=t.lastSShapeSlurPartDirection,t.lastSShapeSlurPartDirection=void 0),o.slurMarks.push(i),t.slurMarkChords[a].push(o),Wi(t,a)}}}t.applyHighlighting&&(Gt(t),t.highlightsHtmlBuffer.push("</span>")),Kt(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},vi(e,"slur finishes at unit",2,{measure:!0,stave:!0}),e["slur finishes above|below unit"]={requiredCommandProgression:"slur finishes at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{i.lastSShapeSlurPartDirection=Jt(n),i.lastSlurDirection=i.lastSShapeSlurPartDirection,i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["slur direction"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>lC(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=hC(n);pn(i,l,h),i.lastSlurDirection=h,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["slur above or below"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur starts before unit","slur finishes after unit","slur starts at unit","slur finishes at unit","slur goes through unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=Jt(n);pn(i,l,h),i.lastSlurDirection=h,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["slur roundness"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>uC(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=mC(n);if(Qu(i,l,h),i.lastSlurRoundness=h,i.applyHighlighting){let m=o.replace(G.roundnessHighlight,u=>`<span class="th" ref-id="${l}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(G.roundnessHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["slur goes through unit"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.changesStaveOrGoesThrough.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Hi(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.slurMarks=o.slurMarks||[];let a=`slur-${t.numberOfSlurs}`;t.slurMarkChords[a]=t.slurMarkChords[a]||[];let i={key:a};t.lastSShapeSlurPartDirection&&(i.direction=t.lastSShapeSlurPartDirection,t.lastSShapeSlurPartDirection=void 0),o.slurMarks.push(i),t.slurMarkChords[a].push(o),Wi(t,a)}}t.applyHighlighting&&(Gt(t),t.highlightsHtmlBuffer.push("</span>")),Kt(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["slur goes through above|below unit"]={requiredCommandProgression:"slur goes through unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>_t(n),action:(t,s,r,n,o,a,i)=>{i.lastSShapeSlurPartDirection=Jt(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},vi(e,"slur goes through unit",2,{measure:!0,stave:!0}),e["slur left point"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.leftPoint.test(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`;i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}`)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["slur left point vertical correction"]={requiredCommandProgression:"slur left point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>Gu(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=zu(n);if(Zu(i,l,h),i.lastSlurLeftYCorrection=h,i.applyHighlighting){let m=o.replace(G.verticalCorrectionHighlight,u=>`<span class="th" ref-id="${l}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(G.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["slur right point"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.rightPoint.test(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`;i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&t.highlightsHtmlBuffer.push("</span>")},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["slur right point vertical correction"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>Gu(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h=zu(n);if(em(i,l,h),i.lastSlurRightYCorrection=h,i.applyHighlighting){let m=o.replace(G.verticalCorrectionHighlight,u=>`<span class="th" ref-id="${l}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${m}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(G.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:2},e["slur right point attached to middle of stem"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>G.attachedToMiddleOfStem.test(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h="middleStem";Us(i,l,h),i.lastSlurRightPointPlacement=h,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["slur right point attached to note body"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,onTheSameLineAsPrevScenario:!0,condition:(t,s,r,n,o,a,i)=>G.attachedToNoteBody.test(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`,h="noteBody";Us(i,l,h),i.lastSlurRightPointPlacement=h,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:2},e["slur with s shape"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>G.withSShape.test(n),action:(t,s,r,n,o,a,i)=>{let l=`slur-${i.numberOfSlurs}`;Xu(i,l),i.lastSlurWithSShape=!0,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="${l}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},dC(e,"slur",["slur starts before unit","slur finishes after unit","slur starts at unit","slur finishes at unit","slur goes through unit","slur left point","slur right point"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var sm=C((FW,nm)=>{"use strict";var fe=y(),gC=pt(),fC=Pt(),_s=be(),Pn=Bt(),pC=bt(),ki=At(),Ni=Ot(),Tn=xt(),PC=lt();nm.exports=e=>{e.glissando={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>fe.glissando.test(n),action:(t,s,r,n,o,a,i)=>{if(pC(i),i.numberOfGlissandos+=1,i.lastDeclaredGlissando=void 0,i.lastGlissandoDirection=void 0,i.applyHighlighting){let l=o.replace(fe.glissandoHighlight,h=>`<span class="eh" ref-id="glissando-${i.numberOfGlissandos}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${l}`)}},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Ni(t,!0),t.highlightsHtmlBuffer.push("</span>")),ki(t)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(fe.glissandoHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["glissando starts before unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando starts before unit","glissando starts at unit","glissando finishes at unit","glissando finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>fe.startsBefore.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${e["glissando starts before unit"].lineNumber}`);else{let o=Pn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${e["glissando starts before unit"].lineNumber}`);else{t.lastDeclaredGlissando!==void 0&&(t.numberOfGlissandos+=1,t.lastDeclaredGlissando=void 0,t.lastGlissandoDirection=void 0,t.lastGlissandoForm=void 0);let a=`glissando-${t.numberOfGlissandos}`;o.glissandoMarks=o.glissandoMarks||[];let i={key:a,before:!0};t.lastGlissandoDirection&&(i.direction=t.lastGlissandoDirection),t.lastGlissandoForm&&(i.form=t.lastGlissandoForm),o.glissandoMarks.push(i),t.lastDeclaredGlissando=i}}t.applyHighlighting&&(Ni(t),t.highlightsHtmlBuffer.push("</span>")),ki(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tn(e,"glissando starts before unit",2,{measure:!0,stave:!0}),e["glissando finishes after unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando finishes after unit","glissando finishes at unit","glissando starts at unit","glissando starts before unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>fe.finishesAfter.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Pn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.glissandoMarks=o.glissandoMarks||[];let i={key:`glissando-${t.numberOfGlissandos}`,after:!0};t.lastGlissandoDirection&&(i.direction=t.lastGlissandoDirection),t.lastGlissandoForm&&(i.form=t.lastGlissandoForm),o.glissandoMarks.push(i),t.lastDeclaredGlissando=i}}t.applyHighlighting&&(Ni(t),t.highlightsHtmlBuffer.push("</span>")),ki(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tn(e,"glissando finishes after unit",2,{measure:!0,stave:!0}),e["glissando starts at unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando starts at unit","glissando before at unit","glissando finishes at unit","glissando finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(fe.starts.test(n)&&!fe.from.test([_s(t,r.firstCharIndexOfNextToken)])||fe.from.test(n)||fe.startsFrom.test(n))&&!fe.startsBefore.test(n)&&!fe.before.test([_s(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Pn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.glissandoMarks=o.glissandoMarks||[];let i={key:`glissando-${t.numberOfGlissandos}`};t.lastGlissandoDirection&&(i.direction=t.lastGlissandoDirection),t.lastGlissandoForm&&(i.form=t.lastGlissandoForm),o.glissandoMarks.push(i),t.lastDeclaredGlissando=i}}t.applyHighlighting&&(Ni(t),t.highlightsHtmlBuffer.push("</span>")),ki(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tn(e,"glissando starts at unit",2,{measure:!0,stave:!0}),e["glissando finishes at unit"]={requiredCommandProgression:"glissando starts at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(fe.finishes.test(n)||fe.to.test(n))&&!fe.finishesAfter.test(n)&&!fe.after.test([_s(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Pn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.glissandoMarks=o.glissandoMarks||[];let i={key:`glissando-${t.numberOfGlissandos}`};t.lastGlissandoDirection&&(i.direction=t.lastGlissandoDirection),t.lastGlissandoForm&&(i.form=t.lastGlissandoForm),o.glissandoMarks.push(i),t.lastDeclaredGlissando=i}}t.applyHighlighting&&(Ni(t),t.highlightsHtmlBuffer.push("</span>")),ki(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tn(e,"glissando finishes at unit",2,{measure:!0,stave:!0}),e["glissando direction"]={requiredCommandProgression:"glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>gC(n),action:(t,s,r,n,o,a,i)=>{let l=fC(n);i.lastDeclaredGlissando&&(i.lastDeclaredGlissando.direction=l),i.lastGlissandoDirection=l,i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["glissando form"]={requiredCommandProgression:"glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>fe.asWaveLine.test(n),action:(t,s,r,n,o,a,i)=>{let l=fe.asWaveLine.match(n)[0];if(i.lastDeclaredGlissando&&(i.lastDeclaredGlissando.form=l),i.lastGlissandoForm=l,i.applyHighlighting){let h=o.replace(fe.asWaveLineHighlight,m=>`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="glissando-${i.numberOfGlissandos}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(fe.asWaveLineHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},PC(e,"glissando",["glissando starts before unit","glissando finishes after unit","glissando starts at unit","glissando finishes at unit"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var rm=C((DW,om)=>{"use strict";var Y=y(),TC=pt(),CC=Pt(),bC=mi(),OC=ci(),HC=hn(),vC=un(),WC=Ve(),kC=Re(),Cn=be(),bn=Bt(),NC=bt(),wi=At(),Ii=Ot(),On=xt(),wC=lt();om.exports=e=>{e.tuplet={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>Y.tupletWithValue.test(n),action:(t,s,r,n,o,a,i)=>{if(NC(i),i.lastChordParamsWithFinishedTupletMarkThatStarted=void 0,i.lastChordParamsWithStartedTupletMark=void 0,i.lastTupletDirection=void 0,i.lastTupletIsAboveOrBelowStaveLines=void 0,i.lastTupletWithBrackets=void 0,i.lastTupletVerticalCorrection=void 0,i.numberOfTuplets+=1,i.lastTupletValue=Y.tupletWithValue.match(n)[0],i.applyHighlighting){let l=o.split(Y.tupletHighlight),h=l[0],m=l[1],u=`${h}<span class="eh" ref-id="tuplet-${i.numberOfTuplets}">tuplet</span>`,c=m.replace(Y.tupletValueHighlight,d=>`<span class="cnh" ref-id="tuplet-value-${i.numberOfTuplets}">${d}</span>`),g=`${u}${c}`;i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tuplet-${i.numberOfTuplets}">${g}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.split(Y.tupletHighlight),o=n[0],a=n[1],i=`${o}<span class="eh">tuplet</span>`,l=a.replace(Y.tupletValueHighlight,m=>`<span class="cnh">${m}</span>`),h=`${i}${l}`;t.highlightsHtmlBuffer.push(h)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Ii(t,!0),t.highlightsHtmlBuffer.push("</span>")),wi(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["tuplet starts before unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet starts before unit","tuplet starts at unit","tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Y.startsBefore.test(n)||Y.before.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=bn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.tupletMarks=o.tupletMarks||[];let a=t.pageSchema.measuresParams[t.calculatedUnitMeasureIndexByLastMentionedPositions].stavesParams[t.calculatedUnitStaveIndexByLastMentionedPositions].voicesParams[t.calculatedUnitVoiceIndexByLastMentionedPositions][0];a.tupletMarks=a.tupletMarks||[];let i=`tuplet-${t.numberOfTuplets}`,l={key:i,value:t.lastTupletValue,before:!0};t.lastTupletDirection&&(l.direction=t.lastTupletDirection),t.lastTupletIsAboveOrBelowStaveLines&&(l.direction=t.lastTupletDirection,l.aboveBelowOverUnderStaveLines=!0),t.lastTupletWithBrackets&&(l.withBrackets=!0),t.lastTupletVerticalCorrection!==void 0&&(l.yCorrection=t.lastTupletVerticalCorrection),a.tupletMarks.push(l),t.lastChordParamsWithStartedTupletMark={chordParams:a,tupletMarkIndex:a.tupletMarks.length-1},o.tupletMarks.push({key:i,finish:!0}),t.lastChordParamsWithFinishedTupletMarkThatStarted={chordParams:o,tupletMarkIndex:o.tupletMarks.length-1}}}t.applyHighlighting&&(Ii(t),t.highlightsHtmlBuffer.push("</span>")),wi(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},On(e,"tuplet starts before unit",2,{measure:!0}),e["tuplet finishes after unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Y.finishesAfter.test(n)||Y.after.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line ${n.lineNumber}`);else{let o=bn(t);if(!o)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{o.tupletMarks=o.tupletMarks||[];let a=`tuplet-${t.numberOfTuplets}`;if(t.lastChordParamsWithFinishedTupletMarkThatStarted!==void 0)t.lastChordParamsWithFinishedTupletMarkThatStarted.chordParams.tupletMarks.splice(t.lastChordParamsWithFinishedTupletMarkThatStarted.tupletMarkIndex,1),t.lastChordParamsWithFinishedTupletMarkThatStarted=void 0;else if(t.lastChordParamsWithStartedTupletMark===void 0){let l={key:a,value:t.lastTupletValue};t.lastTupletDirection&&(l.direction=t.lastTupletDirection),o.tupletMarks.push(l),t.lastChordParamsWithStartedTupletMark={chordParams:o,tupletMarkIndex:o.tupletMarks.length-1}}let i={value:t.lastTupletValue,key:a,finish:!0,after:!0};o.tupletMarks.push(i)}}t.applyHighlighting&&(Ii(t),t.highlightsHtmlBuffer.push("</span>")),wi(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},On(e,"tuplet finishes after unit",2,{measure:!0}),e["tuplet starts at unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet starts at unit","tuplet starts before unit","tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(Y.starts.test(n)&&!Y.from.test([Cn(t,r.firstCharIndexOfNextToken)])||Y.from.test(n)||Y.startsFrom.test(n))&&!Y.before.test([Cn(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=`tuplet-${t.numberOfTuplets}`,a=bn(t);if(!a)t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`);else{a.tupletMarks=a.tupletMarks||[];let i={key:o,value:t.lastTupletValue};t.lastTupletDirection&&(i.direction=t.lastTupletDirection),t.lastTupletIsAboveOrBelowStaveLines&&(i.direction=t.lastTupletDirection,i.aboveBelowOverUnderStaveLines=!0),t.lastTupletWithBrackets&&(i.withBrackets=!0),t.lastTupletVerticalCorrection!==void 0&&(i.yCorrection=t.lastTupletVerticalCorrection),a.tupletMarks.push(i),t.lastChordParamsWithStartedTupletMark={chordParams:a,tupletMarkIndex:a.tupletMarks.length-1},a.tupletMarks.push({key:o,finish:!0,after:!0}),t.lastChordParamsWithFinishedTupletMarkThatStarted={chordParams:a,tupletMarkIndex:a.tupletMarks.length-1}}}t.applyHighlighting&&(Ii(t),t.highlightsHtmlBuffer.push("</span>")),wi(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},On(e,"tuplet starts at unit",2,{measure:!0}),e["tuplet finishes at unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet finishes at unit","tuplet finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(Y.finishes.test(n)||Y.to.test(n))&&!Y.after.test([Cn(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=bn(t),a=`tuplet-${t.numberOfTuplets}`;o?(o.tupletMarks=o.tupletMarks||[],t.lastChordParamsWithFinishedTupletMarkThatStarted!==void 0&&(t.lastChordParamsWithFinishedTupletMarkThatStarted.chordParams.tupletMarks.splice(t.lastChordParamsWithFinishedTupletMarkThatStarted.tupletMarkIndex,1),t.lastChordParamsWithFinishedTupletMarkThatStarted=void 0),o.tupletMarks.push({key:a,finish:!0}),t.lastChordParamsWithStartedTupletMark=void 0):t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Ii(t),t.highlightsHtmlBuffer.push("</span>")),wi(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},On(e,"tuplet finishes at unit",2,{measure:!0}),e["tuplet with direction"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>TC(n),action:(t,s,r,n,o,a,i)=>{i.lastTupletDirection=CC(n),i.lastChordParamsWithStartedTupletMark&&(i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=i.lastTupletDirection),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["tuplet above or below"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>bC(n)&&!Y.staveWithAndWithoutDelimeter.test([Cn(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.lastTupletDirection=OC(n),i.lastChordParamsWithStartedTupletMark&&(i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=i.lastTupletDirection),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}},e["tuplet is above or below stave lines"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>HC(n),action:(t,s,r,n,o,a,i)=>{i.lastTupletDirection=vC(n),i.lastTupletIsAboveOrBelowStaveLines=!0,i.lastChordParamsWithStartedTupletMark&&(i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=i.lastTupletDirection,i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].aboveBelowOverUnderStaveLines=!0);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(Y.staveHighlight,m=>`<span class="csph" ref-id="all-staves-in-measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-staves-in-measure-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Y.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["tuplet with brackets"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Y.withBrackets.test(n),action:(t,s,r,n,o,a,i)=>{if(i.lastTupletWithBrackets=!0,i.lastChordParamsWithStartedTupletMark&&(i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].withBrackets=i.lastTupletWithBrackets),i.applyHighlighting){let l=o.replace(Y.bracketsHighlight,h=>`<span class="th" ref-id="tuplet-brackets-${i.numberOfTuplets}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tuplet-brackets-${i.numberOfTuplets}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Y.bracketsHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},e["tuplet with vertical correction"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>WC(n),action:(t,s,r,n,o,a,i)=>{if(i.lastTupletVerticalCorrection=kC(n),i.lastChordParamsWithStartedTupletMark&&(i.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[i.lastChordParamsWithStartedTupletMark.tupletMarkIndex].yCorrection=i.lastTupletVerticalCorrection),i.applyHighlighting){let l=o.replace(Y.verticalCorrectionHighlight,h=>`<span class="th" ref-id="tuplet-${i.numberOfTuplets}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tuplet-${i.numberOfTuplets}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Y.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)}},wC(e,"tuplet",["tuplet starts before unit","tuplet finishes after unit","tuplet starts at unit","tuplet finishes at unit"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var um=C((MW,hm)=>{"use strict";var Se=y(),IC=Ve(),$C=Re(),BC=be(),yC=Pi(),am=Bt(),AC=bt(),Js=At(),Ks=Ot(),lm=xt(),xC=lt();hm.exports=e=>{e["octave sign"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>{let l=yC(t,r.firstCharIndexOfNextToken,2);return Se.octaveOrTwoOctavesHigherOrLower.test(n)&&l.indexOf("clef")===-1},action:(t,s,r,n,o,a,i)=>{AC(i);let l=Se.octaveOrTwoOctavesHigherOrLower.match(n),h=l[0],m=h?"15":"8",u=h?"ma":"va",c=l[1]==="up"||l[1]==="higher"?"up":"down";if(i.numberOfOctaveSignMarks+=1,i[`lastStartOctaveSignMark-${i.numberOfOctaveSignMarks}`]={key:`octave-sign-${i.numberOfOctaveSignMarks}`,octaveNumber:m,octavePostfix:u,yCorrection:0,direction:c},i.applyHighlighting){let g=o.replace(Se.isOctaveOrTwoOctavesHigherOrLowerHighlight,d=>`<span class="eh" ref-id="octave-sign-${i.numberOfOctaveSignMarks}">${d}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="octave-sign-${i.numberOfOctaveSignMarks}">${g}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Se.isOctaveOrTwoOctavesHigherOrLowerHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Ks(t,!0),t.highlightsHtmlBuffer.push("</span>")),Js(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["octave sign from unit"]={requiredCommandProgression:"octave sign",prohibitedCommandProgressions:["octave sign from unit","octave sign to unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Se.starts.test(n)&&!Se.from.test([BC(t,r.firstCharIndexOfNextToken)])||Se.from.test(n)||Se.startsFrom.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=am(t);o?o.octaveSignMark=t[`lastStartOctaveSignMark-${t.numberOfOctaveSignMarks}`]:t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Ks(t),t.highlightsHtmlBuffer.push("</span>")),Js(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},lm(e,"octave sign from unit",2,{measure:!0}),e["octave sign to unit"]={requiredCommandProgression:"octave sign",prohibitedCommandProgressions:["octave sign to unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>Se.finishes.test(n)||Se.to.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=am(t);o?o.octaveSignMark={key:`octave-sign-${t.numberOfOctaveSignMarks}`,finish:!0}:t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Ks(t),t.highlightsHtmlBuffer.push("</span>")),Js(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},lm(e,"octave sign to unit",2,{measure:!0}),e["octave sign vertical correction"]={requiredCommandProgression:"octave sign",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>IC(n),action:(t,s,r,n,o,a,i)=>{if(i[`lastStartOctaveSignMark-${i.numberOfOctaveSignMarks}`].yCorrection=$C(n),i.applyHighlighting){let l=o.replace(Se.verticalCorrectionHighlight,h=>`<span class="th" ref-id="octave-sign-${i.numberOfOctaveSignMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="tuplet-${i.numberOfOctaveSignMarks}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(Se.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},xC(e,"octave sign",["octave sign from unit","octave sign to unit"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var gm=C((LW,dm)=>{"use strict";var U=y(),FC=hn(),DC=pt(),MC=Pt(),LC=un(),VC=Ve(),RC=Re(),Gs=be(),mm=Bt(),jC=bt(),zs=At(),Ys=Ot(),cm=xt(),SC=lt();dm.exports=e=>{e["crescendo|diminuendo"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>U.crescendoOrDiminuendo.test(n),action:(t,s,r,n,o,a,i)=>{jC(i);let h=U.crescendoOrDiminuendo.match(n)[0];if(i.numberOfDynamicMarks+=1,i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`]={key:`crescendo-or-diminuendo-${i.numberOfDynamicMarks}`,type:h,direction:"up",yCorrection:0},i[`lastFinishDynamicChangeMark-${i.numberOfDynamicMarks}`]={key:`crescendo-or-diminuendo-${i.numberOfDynamicMarks}`,finish:!0},i.applyHighlighting){let m=o.replace(U.crescendoOrDiminuendoHighlight,u=>`<span class="eh" ref-id="crescendo-or-diminuendo-${i.numberOfDynamicMarks}">${u}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="crescendo-or-diminuendo-${i.numberOfDynamicMarks}">${m}`)}},itIsNewCommandProgressionFromLevel:0,actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(U.crescendoOrDiminuendoHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Ys(t,!0),t.highlightsHtmlBuffer.push("</span>")),zs(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["crescendo|diminuendo starts"]={requiredCommandProgression:"crescendo|diminuendo",prohibitedCommandProgressions:["crescendo|diminuendo starts"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>{let l=!U.from.test([Gs(t,r.firstCharIndexOfNextToken)]),h=!U.with.test([Gs(t,r.firstCharIndexOfNextToken)]);return U.startsWithTextValue.test(n)&&l||U.startsWithTextValueFrom.test(n)||(U.starts.test(n)&&l||U.from.test(n)||U.startsFrom.test(n))&&h},action:(t,s,r,n,o,a,i)=>{if(U.startsWithTextValue.test(n)){if(i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].valueBefore=U.startsWithTextValue.match(n)[0],i.applyHighlighting){let l=o.replace(U.stringHighlight,h=>`<span class="sth" ref-id="crescendo-or-diminuendo-value-before-${i.numberOfDynamicMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="crescendo-or-diminuendo-value-before-${i.numberOfDynamicMarks}">${l}</span>`)}}else if(U.startsWithTextValueFrom.test(n)){if(i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].valueBefore=U.startsWithTextValueFrom.match(n)[0],i.applyHighlighting){let l=o.replace(U.stringHighlight,h=>`<span class="sth" ref-id="crescendo-or-diminuendo-value-before-${i.numberOfDynamicMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${l}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1)}}else i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(U.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=mm(t);o?o.dynamicChangeMark=t[`lastStartDynamicChangeMark-${t.numberOfDynamicMarks}`]:t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Ys(t),t.highlightsHtmlBuffer.push("</span>")),zs(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},cm(e,"crescendo|diminuendo starts",2,{measure:!0}),e["crescendo|diminuendo finishes"]={requiredCommandProgression:"crescendo|diminuendo",prohibitedCommandProgressions:["crescendo|diminuendo finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>U.finishesWithTextValue.test(n)||U.finishes.test(n)&&!U.with.test([Gs(t,r.firstCharIndexOfNextToken)])||U.to.test(n),action:(t,s,r,n,o,a,i)=>{if(U.finishesWithTextValue.test(n)){if(i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].valueAfter=U.finishesWithTextValue.match(n)[0],i.applyHighlighting){let l=o.replace(U.stringHighlight,h=>`<span class="sth" ref-id="crescendo-or-diminuendo-value-after-${i.numberOfDynamicMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="crescendo-or-diminuendo-value-after-${i.numberOfDynamicMarks}">${l}`)}}else i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(U.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=mm(t);o?o.dynamicChangeMark=t[`lastFinishDynamicChangeMark-${t.numberOfDynamicMarks}`]:t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Ys(t),t.highlightsHtmlBuffer.push("</span>")),zs(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},cm(e,"crescendo|diminuendo finishes",2,{measure:!0}),e["crescendo|diminuendo direction"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>DC(n),action:(t,s,r,n,o,a,i)=>{i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].direction=MC(n),i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["crescendo|diminuendo above or below stave"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>FC(n),action:(t,s,r,n,o,a,i)=>{i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].direction=LC(n);let l=i.pageSchema.measuresParams.length;if(i.applyHighlighting){let h=o.replace(U.staveHighlight,m=>`<span class="csph" ref-id="all-staves-in-measure-${l}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="all-staves-in-measure-${l}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(U.staveHighlight,o=>`<span class="csph">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["crescendo|diminuendo vertical correction"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>VC(n),action:(t,s,r,n,o,a,i)=>{if(i[`lastStartDynamicChangeMark-${i.numberOfDynamicMarks}`].yCorrection=RC(n),i.applyHighlighting){let l=o.replace(U.verticalCorrectionHighlight,h=>`<span class="th" ref-id="crescendo-or-diminuendo-${i.numberOfDynamicMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="crescendo-or-diminuendo-${i.numberOfDynamicMarks}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(U.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},SC(e,"crescendo|diminuendo",["crescendo|diminuendo starts","crescendo|diminuendo finishes"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var bm=C((VW,Cm)=>{"use strict";var ne=y(),EC=Ve(),qC=Re(),Hn=ee(),Qs=be(),fm=Pi(),pm=Bt(),UC=bt(),Pm=At(),Xs=Ot(),Tm=xt(),_C=lt(),JC=(e,t,s,r,n,o)=>{e.highlightsHtmlBuffer.forEach((a,i)=>{e.highlightsHtmlBuffer[i]=a.replaceAll(/rest-(\d+)-(\d+)-(\d+)-(\d+)/g,(l,h,m,u,c)=>(h*=1,m*=1,u*=1,c*=1,h===t+1&&m===s+1&&u===r+1&&c>n+1?`rest-${h}-${m}-${u}-${c+o}`:l)).replaceAll(/unit-(\d+)-(\d+)-(\d+)-(\d+)/g,(l,h,m,u,c)=>(h*=1,m*=1,u*=1,c*=1,h===t+1&&m===s+1&&u===r+1&&c>n+1?`unit-${h}-${m}-${u}-${c+o}`:l)).replaceAll(/note-(\d+)-(\d+)-(\d+)-(\d+)-(\d+)/g,(l,h,m,u,c,g)=>(h*=1,m*=1,u*=1,c*=1,h===t+1&&m===s+1&&u===r+1&&c>n+1?`note-${h}-${m}-${u}-${c+o}-${g}`:l))})},KC=e=>{if(e.calculatedUnitMeasureIndexByLastMentionedPositions!==void 0&&e.calculatedUnitStaveIndexByLastMentionedPositions!==void 0&&e.calculatedUnitVoiceIndexByLastMentionedPositions!==void 0&&e[`lastSimileMarkUnitIndex-${e.numberOfSimileMarks}`]!==void 0){let t=e.calculatedUnitMeasureIndexByLastMentionedPositions,s=e.calculatedUnitStaveIndexByLastMentionedPositions,r=e.calculatedUnitVoiceIndexByLastMentionedPositions,n=e[`lastSimileMarkUnitIndex-${e.numberOfSimileMarks}`],o=e[`lastStartSimileMark-${e.numberOfSimileMarks}`].count,a=e[`lastStartSimileMark-${e.numberOfSimileMarks}`].yCorrection;if(!e.pageSchema.measuresParams[t].stavesParams[s].voicesParams[r][n].isSimile&&(!e.pageSchema.measuresParams[t].stavesParams[s].voicesParams[r][n+1]||e.pageSchema.measuresParams[t].stavesParams[s].voicesParams[r][n+1]&&!e.pageSchema.measuresParams[t].stavesParams[s].voicesParams[r][n+1].isSimile))for(let i=0;i<o;i++)e.pageSchema.measuresParams[t].stavesParams[s].voicesParams[r].splice(n+i+1,0,{notes:[{positionNumber:(a||0)+2}],isSimile:!0,simileRefId:`simile-mark-${e.numberOfSimileMarks}`,simileCountDown:o-i,simileYCorrection:a});JC(e,t,s,r,n,o)}};Cm.exports=e=>{e["repeat simile"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>{let l=Qs(t,r.firstCharIndexOfNextToken),h=fm(t,r.firstCharIndexOfNextToken,3),m=fm(t,r.firstCharIndexOfNextToken,4);return ne.repeatSimile.test(n)&&!ne.sign.test([l])&&!ne.simileOfPreviousMeasure.test([r.value,...h])&&!ne.simileOfTwoPreviousMeasures.test([r.value,...m])},action:(t,s,r,n,o,a,i)=>{if(i.numberOfSimileMarks+=1,i[`lastStartSimileMark-${i.numberOfSimileMarks}`]={refId:`simile-mark-${i.numberOfSimileMarks}`,count:1,numberOfBeats:1,yCorrection:0,finish:!0},i.applyHighlighting){let l=o.replace(ne.repeatSimileHighlight,h=>`<span class="eh" ref-id="simile-mark-${i.numberOfSimileMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ne.repeatSimileHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{KC(t),t.applyHighlighting&&(Xs(t,!0),t.highlightsHtmlBuffer.push("</span>")),UC(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["repeat simile previous beat"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ne.ofPreviousBeat.test(Hn(n)),action:(t,s,r,n,o,a,i)=>{i[`lastStartSimileMark-${i.numberOfSimileMarks}`].numberOfBeats=1,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["repeat simile previous beats"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ne.ofPreviousBeats.test(Hn(n)),action:(t,s,r,n,o,a,i)=>{i[`lastStartSimileMark-${i.numberOfSimileMarks}`].numberOfBeats=2,i.applyHighlighting&&i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${o}</span>`)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1},e["repeat simile count"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ne.simileCount.test(Hn(n)),action:(t,s,r,n,o,a,i)=>{let l=ne.simileCount.match(Hn(n))[0]*1;if(i[`lastStartSimileMark-${i.numberOfSimileMarks}`].count=l,i.applyHighlighting){let h=o.replace(ne.simileCountHighlight,m=>`<span class="cnh" ref-id="simile-mark-${i.numberOfSimileMarks}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ne.simileCountHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["repeat simile starts"]={requiredCommandProgression:"repeat simile",prohibitedCommandProgressions:["repeat simile starts","repeat simile finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ne.starts.test(n)&&!ne.from.test([Qs(t,r.firstCharIndexOfNextToken)])||ne.from.test(n)||ne.startsFrom.test(n)||ne.for.test(n)&&!ne.forEach.test([r.value,Qs(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=pm(t);o?(o.simileMark||(o.simileMark=t[`lastStartSimileMark-${t.numberOfSimileMarks}`]),t[`lastSimileMarkUnitIndex-${t.numberOfSimileMarks}`]=t.calculatedUnitIndexByLastMentionedPositions):t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Xs(t),t.highlightsHtmlBuffer.push("</span>")),Pm(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tm(e,"repeat simile starts",2,{}),e["repeat simile finishes"]={requiredCommandProgression:"repeat simile",prohibitedCommandProgressions:["repeat simile finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>ne.finishes.test(n)||ne.till.test(n)||ne.to.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(`<span class="th">${s}</span>`)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedUnitPosition===void 0)t.errors.push(`unit position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=pm(t);o?(o.simileMark||(o.simileMark={refId:`simile-mark-${t.numberOfSimileMarks}`,finish:!0}),t[`lastSimileMarkUnitIndex-${t.numberOfSimileMarks}`]=t.calculatedUnitIndexByLastMentionedPositions):t.errors.push(`unit after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Xs(t),t.highlightsHtmlBuffer.push("</span>")),Pm(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},Tm(e,"repeat simile finishes",2,{}),e["repeat simile vertical correction"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>EC(n),action:(t,s,r,n,o,a,i)=>{if(i[`lastStartSimileMark-${i.numberOfSimileMarks}`].yCorrection=qC(n),i.applyHighlighting){let l=o.replace(ne.verticalCorrectionHighlight,h=>`<span class="cnh" ref-id="simile-mark-${i.numberOfSimileMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="simile-mark-${i.numberOfSimileMarks}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(ne.verticalCorrectionHighlight,o=>`<span class="cnh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},_C(e,"repeat simile",["repeat simile starts","repeat simile finishes"],1,!0,{line:!0,measure:!0,stave:!0,voice:!0})}});var Hm=C((RW,Om)=>{"use strict";var GC=gn();Om.exports=e=>{let t=e.pageSchema,s=e.lastMentionedPageLinePosition,r=e.lastMentionedMeasurePosition,n=s===void 0,o=r===void 0;if(n&&(s=GC(e),n=s===void 0),!o&&!n){let a=0,i=0;for(let l=0;l<t.measuresParams.length;l++){let h=t.measuresParams[l].isLastMeasureOnPageLine||l===t.measuresParams.length-1;if(a===s&&i===r)return t.measuresParams[l];h?(i=0,a+=1):i+=1}}return null}});var Wm=C((jW,vm)=>{"use strict";vm.exports=e=>{e.lastMentionedMeasurePosition=void 0}});var Nm=C((SW,km)=>{"use strict";var se=y(),zC=Ve(),YC=Re(),vn=be(),Wn=Hm(),QC=bt(),$i=Wm(),Bi=Ot(),yi=lt();km.exports=e=>{e.volta={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,startsOnNewLine:!0,condition:(t,s,r,n,o,a,i)=>se.volta.test(n)&&!se.brackets.test([vn(t,r.firstCharIndexOfNextToken)])||se.voltaBrackets.test(n),action:(t,s,r,n,o,a,i)=>{if(QC(i),i.numberOfVoltaMarks+=1,i[`lastStartVoltaMark-${i.numberOfVoltaMarks}`]={key:`volta-mark-${i.numberOfVoltaMarks}`},i[`lastFinishVoltaMark-${i.numberOfVoltaMarks}`]={key:`volta-mark-${i.numberOfVoltaMarks}`},i.applyHighlighting){let l=o.replace(se.voltaBracketsHighlight,h=>`<span class="eh" ref-id="volta-mark-${i.numberOfVoltaMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="volta-mark-${i.numberOfVoltaMarks}">${l}`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(se.voltaBracketsHighlight,o=>`<span class="eh">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{t.applyHighlighting&&(Bi(t,!0),t.highlightsHtmlBuffer.push("</span>")),$i(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},e["volta with text"]={requiredCommandProgression:"volta",condition:(t,s,r,n,o,a,i)=>se.withText.test(n),action:(t,s,r,n,o,a,i)=>{let l=se.withText.match(n)[0];if(i[`lastStartVoltaMark-${i.numberOfVoltaMarks}`].value=l,i.applyHighlighting){let h=o.replace(se.stringHighlight,m=>`<span class="sth" ref-id="volta-mark-text-${i.numberOfVoltaMarks}">${m}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="volta-mark-text-${i.numberOfVoltaMarks}">${h}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(se.stringHighlight,o=>`<span class="sth">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},e["volta starts before"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at","volta finishes after","volta starts at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>se.startsBefore.test(n)||se.before.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedMeasurePosition===void 0)t.errors.push(`measure position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Wn(t);o?(t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].startsHere=!1,t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].startsBefore=!0,!t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`].finishesHere&&!t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`].finishesAfter&&(t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].finishesHere=!0),o.voltaMark=t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`]):t.errors.push(`measure after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Bi(t),t.highlightsHtmlBuffer.push("</span>")),$i(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},yi(e,"volta starts before",[],2,!1,{measure:!0}),e["volta finishes after"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>se.finishesAfter.test(n)||se.after.test(n),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedMeasurePosition===void 0)t.errors.push(`measure position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Wn(t);o?o.voltaMark?(o.voltaMark.finishesHere=!1,o.voltaMark.finishesAfter=!0):(t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].finishesHere=!1,t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`].finishesAfter=!0,t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].startsHere||(t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`].startsHere=!0),o.voltaMark=t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`]):t.errors.push(`measure after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Bi(t),t.highlightsHtmlBuffer.push("</span>")),$i(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},yi(e,"volta finishes after",[],2,!1,{measure:!0}),e["volta starts at"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at","volta finishes after","volta starts after"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(se.starts.test(n)&&!se.from.test([vn(t,r.firstCharIndexOfNextToken)])||se.from.test(n)||se.startsFrom.test(n))&&!se.before.test([vn(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedMeasurePosition===void 0)t.errors.push(`measure position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Wn(t);o?(t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].startsHere=!0,o.voltaMark=t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`]):t.errors.push(`measure after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Bi(t),t.highlightsHtmlBuffer.push("</span>")),$i(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},yi(e,"volta starts at",[],2,!1,{measure:!0}),e["volta finishes at"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>(se.finishes.test(n)||se.to.test(n))&&!se.after.test([vn(t,r.firstCharIndexOfNextToken)]),action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&(i.highlightsHtmlBuffer.push(`<span class="th" ref-id="">${o}`),i.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(i.highlightsHtmlBuffer.length-1))},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:(t,s,r,n)=>{if(t.lastMentionedMeasurePosition===void 0)t.errors.push(`measure position after command '${n.joinedTokenValuesWithRealDelimiters}' is not specified on the line number ${n.lineNumber}`);else{let o=Wn(t);o?o.voltaMark?o.voltaMark.finishesHere=!0:(t[`lastStartVoltaMark-${t.numberOfVoltaMarks}`].finishesHere=!1,t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`].finishesHere=!0,o.voltaMark=t[`lastFinishVoltaMark-${t.numberOfVoltaMarks}`]):t.errors.push(`measure after command '${n.joinedTokenValuesWithRealDelimiters}' is not found on the line ${n.lineNumber}`)}t.applyHighlighting&&(Bi(t),t.highlightsHtmlBuffer.push("</span>")),$i(t)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:!0},yi(e,"volta finishes at",[],2,!1,{measure:!0}),e["volta vertical correction"]={requiredCommandProgression:"volta",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,condition:(t,s,r,n,o,a,i)=>zC(n),action:(t,s,r,n,o,a,i)=>{if(i[`lastStartVoltaMark-${i.numberOfVoltaMarks}`].yCorrection=YC(n),i.applyHighlighting){let l=o.replace(se.verticalCorrectionHighlight,h=>`<span class="th" ref-id="volta-mark-${i.numberOfVoltaMarks}">${h}</span>`);i.highlightsHtmlBuffer.push(`<span class="th" ref-id="volta-mark-${i.numberOfVoltaMarks}">${l}</span>`)}},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{let n=s.replace(se.verticalCorrectionHighlight,o=>`<span class="th">${o}</span>`);t.highlightsHtmlBuffer.push(n)},itIsNewCommandProgressionFromLevel:1},yi(e,"volta",["volta with text","volta starts before","volta starts before","volta finishes after","volta starts at","volta finishes at","volta vertical correction"],1,!0,{line:!0})}});var Im=C((EW,wm)=>{"use strict";var XC=y();wm.exports=e=>{e.punctuation={condition:(t,s,r,n,o,a,i)=>r.lastOnTheLine&&XC.punctuation.test(n)&&o.length>0,action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)}}}});var Bm=C((qW,$m)=>{"use strict";$m.exports=e=>{e["empty line in general"]={prohibitedCommandProgressions:["comment starts and ends with text","comment starts with text","comment text (comment starts with text)","comment text starts","comment text (comment text starts)","note"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:!0,type:"on empty line",condition:(t,s,r,n,o,a,i)=>!0,action:(t,s,r,n,o,a,i)=>{i.applyHighlighting&&i.highlightsHtmlBuffer.push(o)},actionOnlyForHighlightingWithoutRefIds:(t,s,r)=>{t.highlightsHtmlBuffer.push(s)},itIsNewCommandProgressionFromLevel:0}}});var Am=C((UW,ym)=>{"use strict";var ZC=qo(),eb=Fa(),tb=Va(),ib=Ea(),nb=Ja(),sb=Ga(),ob=Qa(),rb=nl(),ab=hl(),lb=fl(),hb=Cl(),ub=Ol(),mb=kl(),cb=Il(),db=Bl(),gb=xl(),fb=jl(),pb=Gl(),Pb=Ql(),Tb=Zl(),Cb=nh(),bb=oh(),Ob=ah(),Hb=ch(),vb=Ph(),Wb=Oh(),kb=vh(),Nb=cu(),wb=ku(),Ib=im(),$b=sm(),Bb=rm(),yb=um(),Ab=gm(),xb=bm(),Fb=Nm(),Db=Im(),Mb=Bm(),Lb=e=>{eb(e),tb(e),ib(e),nb(e),sb(e),ob(e),rb(e),ab(e),lb(e),hb(e),ub(e),mb(e),cb(e),db(e),gb(e),fb(e),pb(e),Pb(e),Tb(e),Cb(e),bb(e),Ob(e),Hb(e),vb(e),Wb(e),kb(e),Ib(e),$b(e),Bb(e),yb(e),Ab(e),xb(e),Fb(e),Nb(e),wb(e),Db(e),Mb(e)};ym.exports=()=>{let e={};return Lb(e),ZC(e),e}});var Fm=C((_W,xm)=>{"use strict";xm.exports=e=>{let t={common:[]};for(let s in e){let r=e[s];r.requiredCommandProgression?(t[r.requiredCommandProgression]||(t[r.requiredCommandProgression]=[]),t[r.requiredCommandProgression].push(s)):t.common.push(s)}return t}});var Mm=C((JW,Dm)=>{"use strict";var Vb=y();Dm.exports=e=>Vb.globalCommandDelimiter.replaceAllWithEmptyString(e)});var Vm=C((KW,Lm)=>{"use strict";Lm.exports=e=>e.map(t=>t.value)});var jm=C((GW,Rm)=>{"use strict";Rm.exports=(e,t,s)=>{let r=[];e&&e[0]&&e[0].firstOnTheLine&&r.push(...t);for(let n=0;n<e.length;n++)r.push(e[n].value),r.push(...s[e[n].tokenNumber]);return r.join("")}});var _m=C((zW,Um)=>{"use strict";var Rb=Am(),jb=Fm(),eo=Rb(),kn=jb(eo),Sb=Mm(),Eb=Vm(),qb=jm(),Ub=/[\r\n|\r|\n]/,Sm=/[\s]/,Zs="",qm="regular",_b="on empty line",Jb="last char",Kb="last level",Em=(e,t,s,r,n,o,a,i,l,h,m,u,c,g)=>{let d=Eb(h),f=Sb(h),p=qb(h,m,u),T=[];if(r.length>0)for(let b=0;b<r.length;b++){let O=r[b];kn[O]&&kn[O].length>0&&T.push(...kn[O])}T.push(...kn.common);for(let b=0;b<T.length;b++){let O=T[b],$=e[O];if(!($.onTheSameLineAsPrevScenario?a===n.value:!0)||!($.startsOnNewLine?a>n.value||s.value===0:!0))continue;let L=!1;if($.prohibitedCommandProgressions){for(let V=0;V<$.prohibitedCommandProgressions.length;V++)if(r.indexOf($.prohibitedCommandProgressions[V])!==-1){L=!0;break}}if(L)continue;let Q=$.considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem?f:d;if($.type=$.type||qm,l&&(l.isOnNewLine=a>n.value||s.value===0),$.type===t&&$.condition(o,a,l,Q,p,r,c)){if($.itIsNewCommandProgressionFromLevel!==void 0&&($.itIsNewCommandProgressionFromLevel!==Kb&&r.splice($.itIsNewCommandProgressionFromLevel),r.push(O),!c.applyOnlyHighlightingWithoutRefIds||!c.applyHighlighting)){for(let oe=0;oe<g.length;oe++){let z=g[oe];if(r.indexOf(z.scenarioName)===-1||r.indexOf(z.scenarioName)===r.length-1){let X=O;z.action(c,X,a,z.argumentsFromMainAction),g.splice(oe,1),oe--}}$.actionWhenProgressionOfCommandsChanges&&g.unshift({scenarioName:O,scenarioType:$.type,levelOfCommandProgression:$.itIsNewCommandProgressionFromLevel,action:$.actionWhenProgressionOfCommandsChanges,activateOnLastToken:$.activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore,argumentsFromMainAction:{unitext:o,lineNumber:a,currentToken:l,tokenValues:Q,joinedTokenValuesWithRealDelimiters:p,progressionOfCommandsFromScenarios:r}})}c.applyHighlighting&&c.applyOnlyHighlightingWithoutRefIds?$.actionOnlyForHighlightingWithoutRefIds(c,p,Q):$.action(o,a,l,Q,p,r,c),h.length=0,n.value=a,s.value+=1;break}}};Um.exports=(e,t=[],s=!0,r=!0)=>{let n={},o={value:0},a=[],i={pageSchema:{},highlightsHtmlBuffer:[],applyHighlighting:s,applyOnlyHighlightingWithoutRefIds:r,indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders:[],indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection:[],indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord:[],lastMentionedStyleKey:void 0,lastMentionedMidiSettingKey:void 0,lastMentionedUnitPosition:void 0,lastMentionedPageLinePosition:void 0,lastMentionedMeasurePosition:void 0,lastMentionedStavePosition:void 0,lastMentionedVoicePosition:void 0,calculatedUnitPageLineIndexByLastMentionedPositions:void 0,calculatedUnitMeasureIndexByLastMentionedPositions:void 0,calculatedUnitStaveIndexByLastMentionedPositions:void 0,calculatedUnitVoiceIndexByLastMentionedPositions:void 0,calculatedUnitIndexByLastMentionedPositions:void 0,lastMentionedConnectionPageLinePosition:void 0,lastMentionedConnectionMeasurePosition:void 0,lastMentionedConnectionStavePosition:void 0,lastMentionedConnectionVoicePosition:void 0,lastMentionedNoteIndex:void 0,lastMentionedUnitsCompression:void 0,lastMentionedUnitsCompressionWasForSpecificLine:!1,lastMentionedUnitsStretching:void 0,lastMentionedUnitsStretchingWasForAllLines:!1,numberOfChordsBeforeFinishingDeclaringNewOne:0,newlineAlreadyIntroducedNewMeasure:!1,customStyles:{},midiSettings:{},errors:[],comments:[],emptyLineNumbers:[],numberOfPageLines:0,lastClef:{},lastChordDuration:{},lastStemDirection:{},lastStavePosition:{},lastBeamStatus:{},keysOfLastNote:[],lastNoteTextValue:void 0,lastNoteTextPositionApplicationToNote:void 0,lastGhostStatus:{},chordIsActivatedInPreviousCommand:!1,chordScopeIsActive:!1,lastCrossStaveConnectionsParamsForEachLine:void 0,lastCrossStaveConnectionsParamsForEachLineId:1,lastInstrumentTitlesParams:void 0,lastInstrumentTitlesParamsForEachLineId:1,lastKeySignatureName:void 0,lastKeySignatureNameForEachLineId:0,lastClefNames:[],lastTimeSignatureParams:void 0,lastTimeSignatureValueForEachLineId:1,numberOfGlissandos:0,numberOfSlurs:0,slurMarkChords:{},lastSlurDirection:void 0,lastSShapeSlurPartDirection:void 0,lastSlurRoundness:void 0,lastSlurLeftYCorrection:void 0,lastSlurRightYCorrection:void 0,lastSlurWithSShape:void 0,lastSlurRightPointPlacement:void 0,lastGlissandoDirection:void 0,lastGlissandoForm:void 0,lastDeclaredGlissando:void 0,lastGlissandoBeforeMeasure:void 0,lastGlissandoAfterMeasure:void 0,numberOfTuplets:0,lastTupletValue:void 0,lastChordParamsWithFinishedTupletMarkThatStartedBefore:void 0,lastChordParamsWithStartedTupletMark:void 0,lastTupletDirection:void 0,lastTupletIsAboveOrBelowStaveLines:void 0,lastTupletWithBrackets:void 0,lastTupletVerticalCorrection:void 0,lastChordLetterDirection:void 0,numberOfOctaveSignMarks:0,numberOfDynamicMarks:0,numberOfSimileMarks:0,numberOfVoltaMarks:0,numberOfPedalMarks:0},l=[],h=[],m=[],u=[],c=[],g=[],d=[],f=!1,p=1,T=0,b={value:p};for(let $=0;$<e.length;$++){let F=e[$],M=e[$+1],L=!M,Q=Ub.test(F),V=Sm.test(F),oe=M&&Sm.test(M);if(V)f||g.push(F);else if(f=!0,l.push(F),h.push(F),!L){n[$]=t.slice();continue}if(l.length>0){let z=u.length===0,X=T===0,et=u[u.length-1],pe=m[m.length-1],R=et&&et.tokenNumber===T?et:{value:l.join(Zs),tokenNumber:T};R.firstOnTheLine=X||pe&&pe.lastOnTheLine,R.lastOnTheLine=Q||L,d[T]=d[T]||[],V&&d[T].push(F),(!oe||R.lastOnTheLine)&&(R.firstCharIndexOfNextToken=$+1,c.push(R),Em(eo,qm,o,t,b,e,p,L,R,c,g,d,i,a),(z||et.tokenNumber!==T)&&(u.push(R),m.push(R)),(Q||!oe||L)&&(T+=1,l.length=0),R.lastOnTheLine&&(f=!1,g.length=0))}else i.applyHighlighting&&L&&V&&i.highlightsHtmlBuffer!==void 0&&i.highlightsHtmlBuffer.push(g.join(Zs));Q&&(h.join(Zs).length===0&&i.emptyLineNumbers!==void 0&&(i.emptyLineNumbers.push(p),Em(eo,_b,o,t,b,e,p,L,void 0,c,g,d,i,a)),p+=1,u.length=0,h.length=0,c.length=0),n[$]=t.slice()}if(!r||!s)for(let $=0;$<a.length;$++){let F=a[$];if(F.activateOnLastToken){let M=Jb;F.action(i,M,p,F.argumentsFromMainAction)}}if(!i.applyHighlighting){if(i.highlightsHtmlBuffer.length!==0)throw new Error("parserState.highlightsHtmlBuffer.length is 0, although !parserState.applyHighlighting");i.highlightsHtmlBuffer=[e]}return{pageSchema:i.pageSchema,highlightsHtmlBuffer:i.highlightsHtmlBuffer,customStyles:i.customStyles,errors:i.errors,comments:i.comments,midiSettings:i.midiSettings,mapOfCharIndexesWithProgressionOfCommandsFromScenarios:n}}});var Km=C((YW,Jm)=>{"use strict";Jm.exports=(e,t)=>{let s=e.textContainer,r=e.textContainer.cloneNode(!1);r.innerHTML=t,s.parentNode.replaceChild(r,s),e.textContainer=r}});var Nn=C((QW,Ym)=>{"use strict";var Gb=jo(),Gm=_m(),zb=Km(),Ai=`
`,zm="",Yb="command is not recognizable",to="span",Qb=(e,t,s)=>{let n=t.slice(e+1).reduce((m,u)=>m+u,0),o=s.length-n,a=e,i=!1,l=!0,h=[];for(let m=e+1;m<t.length;m++){if(a===t.length-1)return a;let u=s.slice(o,o+t[m]);for(let c=0;c<u.length;c++)if(u[c].indexOf(Yb)!==-1){if(a===t.length-1)return a;a+=1,o+=t[m],l=!1;break}else l=!0;if(l){for(let c=0;c<u.length;c++){if(a===t.length-1)return a;if(u[c].length<=1&&h[m-1]&&l){i=!0;break}u[c].length>1?h[m]=!0:h[m]=!1}if(i)break;if(a===t.length-1)return a;a+=1,o+=t[m]}}return a},Xb=e=>{for(;e.parentNode;){if(e.nodeName.toLowerCase()===to&&e.parentNode.nodeName.toLowerCase()!==to)return e;e=e.parentNode}return e},io=(e,t=[[]])=>{if(e.nodeType===Node.TEXT_NODE&&!e.isAlreadyPushedToItsLine)if(e.parentNode.nodeName.toLowerCase()===to){let s=Xb(e.parentNode);s.isAlreadyPushedToItsLine||(t[t.length-1].push(s),s.isAlreadyPushedToItsLine=!0)}else if(e.nodeValue===zm)t[t.length-1].push(e);else{let s;for(let r=0;r<e.nodeValue.length;r++)if(e.nodeValue[r]===Ai){r!==e.nodeValue.length-1&&(s=e.splitText(r+1)),t[t.length-1].push(e),e.isAlreadyPushedToItsLine=!0,t.push([]);break}else r===e.nodeValue.length-1&&(t[t.length-1].push(e),e.isAlreadyPushedToItsLine=!0);s!==void 0&&io(s,t)}else for(let s=0;s<e.childNodes.length;s++)io(e.childNodes[s],t);return t},Zb=(e,t)=>{for(;t.parentNode;){if(t.parentNode.isSameNode(e))return t.parentNode;t=t.parentNode}return e},eO=(e,t,s,r,n,o)=>{let a=document.createElement("template");a.innerHTML=o;let i=document.importNode(a.content,!0),l=s[r]?s[r][0]:null;l?Zb(t.textContainer,l).insertBefore(i,l):t.textContainer.appendChild(i);for(let h=r;h<=n;h++)for(let m=0;m<s[h].length;m++){let u=s[h][m];u.nodeType===Node.TEXT_NODE?u.remove():u.parentNode.removeChild(u)}for(let h=0;h<r;h++)for(let m=0;m<s[h].length;m++){let u=s[h][m];u.isAlreadyPushedToItsLine=!1}for(let h=n+1;h<s.length;h++)for(let m=0;m<s[h].length;m++){let u=s[h][m];u.isAlreadyPushedToItsLine=!1}t.scrollTop=e.scrollTop};Ym.exports=(e,t,s)=>{let r=Gb(t.value);if(s){let Ke=r.split(Ai).length;window.numberOfLinesInTextarea=Ke;let Ge=Gm(r);window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios=Ge.mapOfCharIndexesWithProgressionOfCommandsFromScenarios;let Ae=Ge.highlightsHtmlBuffer.join("");zb(e,Ae);return}let n=r.split(Ai).map((R,Ke,Ge)=>Ge[Ke+1]!==void 0?`${R}${Ai}`:R),o=n.length,a=o-window.numberOfLinesInTextarea,i=n.map(R=>R.length),l=t.selectionStart,h=t.value.substr(0,l).split(Ai),c=h.slice(0,h.length-1).length,g=window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios,d=Object.values(g),f=c,p=h[h.length-1]===zm;f!==0&&p&&(f-=1);let T=i.slice(0,f).reduce((R,Ke)=>R+Ke,0)-1,b=Qb(c,i,d),O=d.slice(0,T+1),$=[];if(n[b+1]!==void 0){let Ke=i.slice(b+1).reduce((Ae,An)=>Ae+An,0),Ge=d.length-Ke;$=d.slice(Ge)}let M=n.slice(f,b+1).join(""),L=(O[O.length-1]||[]).slice(),Q=Gm(M,L),V=Q.mapOfCharIndexesWithProgressionOfCommandsFromScenarios,oe=Object.values(V),z={},X=0;for(let R=0;R<O.length;R++,X++)z[X]=O[R];for(let R=0;R<oe.length;R++,X++)z[X]=oe[R];for(let R=0;R<$.length;R++,X++)z[X]=$[R];window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios=z;let et=Q.highlightsHtmlBuffer.join(""),pe=io(e.textContainer);eO(t,e,pe,f,b-a,et),window.numberOfLinesInTextarea=o}});var Xm=C((XW,Qm)=>{"use strict";var tO=Nn(),iO=`
`;Qm.exports=(e,t)=>{window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios={},t.addEventListener("beforeinput",()=>{t.textareaTextLengthBeforeNextChange===void 0&&(t.textareaTextLengthBeforeNextChange=t.value.length),t.numberOfLinesInTextareaBeforeNextChange===void 0&&(t.numberOfLinesInTextareaBeforeNextChange=t.value.split(iO).length)}),t.addEventListener("input",()=>{let s=t.value.length,r=Math.abs(t.value.length-t.textareaTextLengthBeforeNextChange)===1;tO(e,t,!r||t.isRenderedWithLatestUnilangInputText),t.isRenderedWithLatestUnilangInputText=!1,t.isModified=!0,t.textareaTextLengthBeforeNextChange=s})}});var tc=C((ZW,ec)=>{"use strict";var Zm=e=>{e.value.length===0?e.classList.add("with-visible-placeholder-in-all-browsers"):e.classList.remove("with-visible-placeholder-in-all-browsers")};ec.exports=e=>{Zm(e),e.addEventListener("input",()=>{Zm(e)})}});var no=C((ek,ic)=>{"use strict";ic.exports=(e,t,s)=>{let r=window.getComputedStyle(s),n=window.getComputedStyle(e.initialParentElement),o=r.getPropertyValue("width").split("px")[0]*1,a=r.getPropertyValue("left").split("px")[0]*1,i=n.getPropertyValue("width").split("px")[0]*1,l=12,h=o+a+l;e.style.left=`${h}px`,t.style.left=e.style.left,e.style.width=`${i-h-l}px`,t.style.width=e.style.width}});var so=C((tk,nc)=>{"use strict";var nO=no();nc.exports=(e,t,s)=>{let r=t.value.split(`
`).length,n=new Array(r).fill().map((o,a)=>`<span class="line-number-block" id="line-number-${a+1}">${a+1}</span>`).join(`
`);e.innerHTML=n,nO(t,s,e)}});var oc=C((ik,sc)=>{"use strict";var sO=so();sc.exports=(e,t,s)=>{t.addEventListener("input",()=>{sO(e,t,s)})}});var ac=C((nk,rc)=>{"use strict";rc.exports=(e,t,s)=>{let r=t.selectionStart,n=t.value.substr(0,r).split(`
`).length;if(s.currentHighlightedNumber&&s.currentHighlightedNumber!==n){let o=e.getElementById(`line-number-${s.currentHighlightedNumber}`);o&&o.classList.remove("line-highlighted-number")}e.getElementById(`line-number-${n}`).classList.add("line-highlighted-number"),s.currentHighlightedNumber=n}});var hc=C((sk,lc)=>{"use strict";var oo=ac();lc.exports=(e,t,s)=>{document.addEventListener("selectionchange",()=>{e.activeElement===t&&oo(e,t,s)}),t.addEventListener("input",()=>{oo(e,t,s)}),t.addEventListener("blur",()=>{let r=e.getElementById(`line-number-${s.currentHighlightedNumber}`);r&&r.classList.remove("line-highlighted-number")}),t.addEventListener("focus",()=>{oo(e,t,s)})}});var Pc=C((ok,pc)=>{"use strict";var oO=Ln(),uc=En(),wn=qn(),xi=Un(),rO=Ri(),aO=ss(),lO=ns(),hO=is(),Je=rO.join("|").split("|"),In=["c","crossed c","3:4","4:4","2:4","3:8","9:4","6:8","12:8"],mc=['repetition note "D.C. al Fine"','repetition note "D.C. al Coda"','repetition note "D.S. al Fine"','repetition note "D.S. al Coda"','repetition note "Fine"','repetition note "Coda"'],vt=Kn(),Fi=["unit ","chord ","note ","stave ","voice ","measure ","line "],uO=["3","3:2","2","2:3","5","5:4","6","6:4","7","7:4","9","9:8","12","12:8"],mO=zn(),cO=["sharp","flat","natural","double sharp","double flat","demisharp","demiflat","sesquisharp","sesquiflat"],$n=Xn(),ro=es(),dO=Vn(),gO=Rn(),fO=jn(),cc=(e,t=[])=>{t.push(`${e} is `);let r=e.split(" ").slice(1);return r.length>0&&cc(r.join(" "),t),t},dc=(e,t=[])=>{t.push(`${e} is `);let r=e.split(" ").slice(1);return r.length>0&&dc(r.join(" "),t),t},gc=(e,t=[])=>{t.push(`${e} is ""`);let r=e.split(" ").slice(1);return r.length>0&&gc(r.join(" "),t),t},fc=(e,t=[])=>{t.push(e);let r=e.split(" ").slice(1);return r.length>0&&fc(r.join(" "),t),t},pO=(e,t=[])=>{t.push(`${e} before`);let r=e.split(" ").slice(1);return r.length>0&&fc(r.join(" "),t),t};pc.exports={general:["compress units by 1.5 times","compress units by 2.0 times","compress units by 3.0 times","compress units by 4.0 times","compress units by 5.0 times","stretch units by 1.5 times","stretch units by 2.0 times","stretch units by 3.0 times","stretch units by 4.0 times","stretch units by 5.0 times",'comment: ""','side note: ""','note: ""',"new line","line","measures","measure","stave","voice","chord","rest",...vt.map(e=>`stave with ${e} clef`),...vt.map(e=>`${e} clef`),"clef",...Je.map(e=>`key signature is ${e}`),...Je.map(e=>`signature is ${e}`),"major","minor","lyrics is under","is under","under","measure numbers for all measures","measure numbers for first measures","measure numbers for last measures","measure numbers for first and last measures",...uc.map(e=>`${e} is ""`),...uc.map(e=>gc(e)).flat(),...oO.map(e=>cc(e)).flat(),...hO.map(e=>dc(e)).flat(),"hide the last measure","the last measure","last measure","slur","glissando","tuplet","octave up","octave higher","octave down","octave lower","two octaves up","two octaves higher","two octaves down","two octaves lower","crescendo","diminuendo","simile","volta","tempo","metronome",'instrument title is ""',"brace","bracket","measure rest",...In.map(e=>`time signature is ${e}`),...In,"time signature is ",...mc],"color style name is":[...aO],"music font style name is":[...dO],"text font style name is":[...gO],"chord letters font style name is":[...fO],"midi setting name is":[...lO],stave:["new line","measure","voice","stave",...vt.map(e=>`with ${e} clef`),...vt.map(e=>`${e} clef`),"clef","chord"],voice:["new line","measure","stave","voice","chord"],chord:["new line","measure","stave","voice","chord","on next stave","next stave","on previous stave","previous stave","on prev. stave","prev. stave","on prev stave","prev stave","on current stave","current stave","with parentheses","parentheses","is ghost","is not ghost","not ghost","ghost","is arpeggiated","arpeggiated","is arpeggio","arpeggio",'with chord ""','with text ""','text ""',...$n.map(e=>`with ${e}`),...$n,"with turn","with mordent","with trill","turn","mordent","trill","is dotted","dotted","with one dot","with two dots","with three dots","one dot","two dots","three dots","dot","dots","with stem up","with stem down","stem up","stem down","is beamed with next","beamed with next","is not beamed with next","not beamed with next","not beamed","is tied with next","tied with next","is tied before","tied before","is tied after","tied after","with glissando after","glissando after","with glissando before","glissando before","is grace","is crushed grace","crushed grace","grace","with crush line","crush line","is rest","rest","is centralized","centralized","with breath mark before","breath mark before","mark before","with breath mark as comma before","breath mark as comma before","mark as comma before","as comma before","comma before","with breath mark as double slashes before","breath mark as double slashes before","mark as double slashes before","as double slashes before","double slashes before","slashes before",...Je.map(e=>`with key signature ${e} before`),...Je.map(e=>`key signature ${e} before`),...Je.map(e=>`signature ${e} before`),...Je.map(e=>`${e} before`),...Je.map(e=>pO(e)).flat(),...vt.map(e=>`with ${e} clef before`),...vt.map(e=>`${e} clef before`),"clef before","chord","is octave up","is octave down","octave up","octave down","is two octaves up","is two octaves down","two octaves up","two octaves down","octaves up","octaves down","is octave higher","is octave lower","octave higher","octave lower","is two octaves higher","is two octaves lower","two octaves higher","two octaves lower","octaves higher","octaves lower","with tremolo","with tremolo with next","tremolo with next","tremolo","strokes","stroke","repeat","simile",'with dynamic ""','dynamic ""','with lyrics ""','with lyric ""','lyrics ""','lyric ""',"with pedal","pedal","with variable peak","variable peak","peak","with release","release","stave","is ","up","down","is left by ","left by ","is right by ","right by ","higher","lower","with next","next","before","after","line"],"chord with parentheses":["from ","to ","note "],"chord is arpeggiated":["with chord below","chord below","below","with arrow up","with arrow down","arrow up","arrow down","up","down"],"chord with text":["is ","up","down","beside","above","above stave","below","below stave","stave"],"chord beamed":["with only primary line","with only one line","only primary line","only one line","primary line","one line","line"],"chord is tied before":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"chord is tied after":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"chord is tied with next":["is ","up","down","above","below","over","under","with roundness ","roundness "],"chord with glissando after":["measure ","up","down"],"chord with glissando before":["measure ","up","down"],"chord with breath mark before":["up","down"],"chord with articulation":["is ","up","down","above","above stave","below","below stave","stave"],"chord with ornament":["is ","up","down","above","above stave","below","below stave","stave","followed after","inverted","with wave after","wave after","after",...ro.map(e=>`with ${e}`)],"chord with dynamic":["is ","up","down","above","above stave","below","below stave","stave"],"chord with chord letter":["is ","up","down","above","above measure","below","below measure","measure"],"chord with lyrics":["followed by dash","by dash","dash","with underscore starts","where underscore starts","underscore starts","starts","with underscore begins","where underscore begins","underscore begins","begins","with underscore finishes","where underscore finishes","underscore finishes","finishes","with underscore ends","where underscore ends","underscore ends","ends"],"chord with pedal":["under stave ","stave ","opens with bracket","with bracket","bracket","before","after"],"chord with variable peak":["before","after"],"chord with release":["before","after","after measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","bracket"],coda:["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","measure","up","down"],sign:["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","measure","up","down"],"crescendo|diminuendo":[...Fi,'starts with "" from ','with "" from ',"starts from ","starts at ",'finishes with "" at ','with "" at ',"finishes at ","from ","at ","to ","above stave","below stave","up","down"],"bracket or brace":["for ","from  ","to ","for each line","each line","line","for lines below","lines below","below","stave "],glissando:[...Fi,"starts before ","finishes after ","starts at ","finishes at ","before ","after ","at ","is ","up","down","as line","as wave"],"instrument title":["for ","between","and ","for each line","each line","line","stave ","for lines below","lines below"],"key signature":[...Je,"for each line","each line","line","for lines below","lines below","below"],"lyrics position":["stave "],measure:["new line","measure","stave","voice","chord","without start barline","start barline","with no start barline","no start barline",...wn.map(e=>`opens with ${e}`),...wn.map(e=>`starts with ${e}`),...wn.map(e=>`with ${e}`),...wn,...xi.map(e=>`closes with ${e}`),...xi.map(e=>`ends with ${e}`),...xi.map(e=>`finishes with ${e}`),...xi.map(e=>`with ${e}`),...xi,"barLine","with repeat sign at the start and at the end","repeat sign at the start and at the end","sign at the start and at the end","at the start and at the end","the start and at the end","start and at the end","and at the end","with repeat sign at the start","repeat sign at the start","sign at the start","with repeat sign at the end","repeat sign at the end","sign at the end","at the start","the start","start","at the end","the end","end","rest","times","tempo","metronome",'instrument title is ""',"brace","bracket","with simile of previous measure","simile of previous measure","of previous measure","previous measure","measure rest","with simile of two previous measures","simile of two previous measures","of previous two measures","previous measures","ends with fermata","with fermata","fermata",...In.map(e=>`time signature is ${e}`),...In,"time signature is ","signature is ",...mc],"measure numbers":["for first measures","first measures","measures","for last measures","last measures","for first and last measures","first and last measures","for first and last measures","and last measures","below","above"],note:["new line","measure","stave","voice","chord","on next stave","next stave","on previous stave","previous stave","on prev. stave","prev. stave","on prev stave","prev stave","with parentheses","parentheses","is ghost","is not ghost","not ghost","ghost",'with text ""','text ""',"is dotted","dotted","with one dot","with two dots","with three dots","one dot","two dots","three dots","dot","dots","with stem up","with stem down","stem up","stem down","is beamed with next","beamed with next","is not beamed with next","not beamed with next","beamed","not beamed","is tied with next","tied with next","is tied before","tied before","is tied after","tied after","with glissando after","glissando after","with glissando before","glissando before","is grace","is crushed grace","crushed grace","grace","with crush line","crush line","is rest","rest","is centralized","centralized","with breath mark before","breath mark before","mark before","with breath mark as comma before","breath mark as comma before","mark as comma before","as comma before","comma before","with breath mark as double slashes before","breath mark as double slashes before","mark as double slashes before","as double slashes before","double slashes before","slashes before",...Je.map(e=>`with key signature ${e} before`),...Je.map(e=>`key signature ${e} before`),...Je.map(e=>`signature ${e} before`),"major","minor",...vt.map(e=>`with ${e} clef before`),...vt.map(e=>`${e} clef before`),"clef before",...$n.map(e=>`with ${e}`),...$n,"with turn","with mordent","with trill","turn","mordent","trill",'with chord ""',"is octave up","is octave down","octave up","octave down","is two octaves up","is two octaves down","two octaves up","two octaves down","octaves up","octaves down","is octave higher","is octave lower","octave higher","octave lower","is two octaves higher","is two octaves lower","two octaves higher","two octaves lower","octaves higher","octaves lower","with tremolo","with tremolo with next","tremolo with next","tremolo","strokes","stroke","repeat","simile",'with dynamic ""','dynamic ""','with lyrics ""','with lyric ""','lyrics ""','lyric ""',"with pedal","pedal","with variable peak","variable peak","peak","with release","release",...mO.map(e=>`with ${e} key`),"key",...cO,"stave","is ","up","down","is left by ","left by ","is right by ","right by ","higher","lower","with next","next","before","after","line"],"note with parentheses":["from","to","note"],"note with text":["is ","up","down","beside","above","above stave","below","below stave","stave"],"note beamed":["with only primary line","with only one line","only primary line","only one line","primary line","one line","line"],"note is tied before":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"note is tied after":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"note is tied with next":["is ","up","down","above","below","over","under","with roundness ","roundness "],"note with glissando after":["measure","up","down"],"note with glissando before":["measure","up","down"],"note with breath mark before":["up","down"],"note with articulation":["is ","up","down","above","above stave","below","below stave","stave"],"note with turn":["is ","up","down","above","above stave","below","below stave","stave","inverted","after",...ro.map(e=>`with ${e}`)],"note with mordent":["is ","up","down","above","above stave","below","below stave","stave","inverted","after",...ro.map(e=>`with ${e}`)],"note with trill":["is ","up","down","above","above stave","below","below stave","stave","with wave after","wave after","after"],"note with dynamic":["is ","up","down","above","above stave","below","below stave","stave"],"note with chord letter":["is ","up","down","above","above measure","below","below measure","measure"],"note with lyrics":["followed by dash","by dash","dash","with underscore starts","where underscore starts","underscore starts","starts","with underscore begins","where underscore begins","underscore begins","begins","with underscore finishes","where underscore finishes","underscore finishes","finishes","with underscore ends","where underscore ends","underscore ends","ends"],"note with pedal":["under stave ","stave ","opens with bracket","with bracket","bracket","before","after"],"note with variable peak":["before","after"],"note with release":["before","after","after measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","bracket"],"octave sign":["from ","to ","up","down","and finishes at "],"repeat simile":[...Fi,"of previous beat","previous beat","of prev. beat","prev. beat","of prev beat","prev beat","beat","of previous beats","previous beats","of prev. beats","prev. beats","of prev beats","prev beats","beats","times","is ","up","down","from ","to ","starts at ","finishes at","at "],"repetition note":["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","up","down"],slur:[...Fi,"starts before ","starts at ","starts before below ","starts before above ","starts above ","starts below ","finishes after ","finishes at ","finishes after below ","finishes after above ","finishes above ","finishes below ","before ","after ","below","above","at ","is ","up","down","with roundness ","roundness ","goes through ","through","goes through below ","goes through above ","with left point ","left point","with right point","right point","point","with s-shape","from","to"],"slur right point":["attached to middle of stem","to middle of stem","middle of stem","of stem","stem","attached to note head","to note head","note head","head"],"tempo mark":["up","down"],"time signature":["for each line","each line","line","for lines below","lines below","below"],tuplet:[...uO,...Fi,"starts before ","starts at ","finishes after ","finishes at ","before ","after ","is ","up","down","above","below","above stave","below stave","with brackets","brackets"],volta:["starts before ","finishes after ","starts at ","finishes at ","up","down","before ","after ","at ",'with text ""'],"compress units by n times":["in line ","line "],"stretch units by n times":["in line ","line "]}});var Hc=C((rk,Oc)=>{"use strict";var PO=Fn(),TO=Ft(),CO=Nn(),bO=Pc(),OO=Dn(),Tc=navigator.platform.indexOf("Mac")!==-1,HO=["a","b","c","d","e","f","g"],vO=[",",";"],Cc=(e,t,s,r)=>{for(let n=0;n<t.length;n++)t[n].toLowerCase().trim()===s&&(r.value=!0),(t[n].toLowerCase().startsWith(s)&&t[n].toLowerCase().trim()!==s||s==="")&&e.indexOf(t[n])===-1&&e.push(t[n])},WO=(e,t,s,r)=>{let n={value:!1};if(s.length>1||HO.indexOf(s)===-1){let o=[];if(!r){let a=window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios[e]||window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios[e-1];if(a){for(let i in t)if(a.indexOf(i)!==-1){let l=t[i];Cc(o,l,s,n)}}if(o.length===0&&!n.value){let i=t.general;n.value=!1,Cc(o,i,s,n)}}return o.sort((a,i)=>a.length-i.length||a.localeCompare(i))}return[]},kO=(e,t,s)=>{t.innerHTML="",t.optionIndex=0,s.forEach((r,n)=>{let o=TO("div",{},{class:"autocomplete-list-view-option"}),a=r.replace(e,i=>`<span class="uncomplete-word-highlight-in-list-of-options-in-autocomplete-list-view">${i}</span>`);o.innerHTML=a,o.index=n,o.textValue=r,t.appendChild(o),n===0&&(o.classList.add("selected"),o.scrollIntoView({block:"nearest"}))})},bc=(e,t,s,r,n,o)=>{if(s.style.display!=="none"){let a=s.childNodes[s.optionIndex];if(r!==void 0&&n!==void 0&&a){let i=vO.indexOf(e.value[o+n-1])!==-1,l=o+n-(i?1:0);e.value=e.value.substr(0,o+r)+a.textValue+e.value.substr(l),e.textareaTextLengthBeforeNextChange=e.value.length,e.isRenderedWithLatestUnilangInputText=!1,e.isModified=!0;let h=e.scrollTop,m=e.scrollLeft;e.focus(),e.scrollTop=h,e.scrollLeft=m;let u=o+r+a.textValue.length;e.setSelectionRange(u,u),s.style.display="none",CO(t,e,!1)}}},NO=(e,t)=>{e.childNodes[e.optionIndex]&&e.childNodes[e.optionIndex].classList.remove("selected"),e.optionIndex=t,e.childNodes[e.optionIndex]&&e.childNodes[e.optionIndex].classList.add("selected")};Oc.exports=(e,t,s,r)=>{e.optionIndex=0;let n,o,a,i=!0;t.addEventListener("keyup",h=>{let m=h.keyCode===32,u=h.keyCode===13,c=h.keyCode===9,g=h.keyCode===38,d=h.keyCode===40,f=h.keyCode===8,p=OO(h.keyCode),T=Tc&&h.metaKey||!Tc&&h.ctrlKey;if(!(f&&e.style.display==="none"))if(!m&&!u&&!c&&!T&&p){let b=t.value.split(`
`),O=b.map(pe=>pe.length),$=t.selectionStart,M=t.value.substr(0,$).split(`
`).length-1,L=O.slice(0,M),Q=L.length>=1?L.reduce((pe,R)=>pe+R):0,V=M;n=Q+V;let z=$-Q-V,X=b[M];for(let pe=z;pe>=0;pe--)if(X[pe-1]&&/\s/.test(X[pe-1])||pe===0&&!/\s/.test(X[pe])){o=pe;break}let et=z===o&&(X[z]===void 0||/\s/.test(X[z]))&&X[z-1]&&/\s/.test(X[z-1]);if(o!==void 0)if(z>=o+1||et){let pe=X.length;if(a=z,!/\s/.test(X[z])){for(let Ae=z;Ae<pe;Ae++)if(Ae===X.length-1||X[Ae+1]&&/\s/.test(X[Ae+1])){a=Ae+1;break}}let R=X.slice(o,z),Ke=n+o,Ge=WO(Ke,bO,R,et);if(Ge.length>0){e.style.display==="none"&&(e.style.display=""),kO(R,e,Ge);let Ae=X.slice(0,o),An=PO(t,Ae,r),Di=window.getComputedStyle(t),$c=Di.getPropertyValue("left").split("px")[0]*1,ho=Di.getPropertyValue("top").split("px")[0]*1,Bc=Di.getPropertyValue("height").split("px")[0]*1,yc=ho+Bc,Ac=$c+An-t.scrollLeft-10,uo=Di.getPropertyValue("line-height").split("px")[0]*1,xc=2.5,Fc=4,mo=window.getComputedStyle(e).getPropertyValue("height").split("px")[0]*1,Mi=ho+uo*(M+1)+xc-t.scrollTop;Mi+mo>=yc&&(Mi=Mi-mo-uo*1-Fc),e.style.left=`${Ac}px`,e.style.top=`${Mi}px`}else e.style.display="none"}else e.style.display="none"}else!g&&!d&&(e.style.display="none")}),t.addEventListener("keydown",h=>{if(e.style.display!=="none"){let m=h.keyCode===38,u=h.keyCode===40,c=h.keyCode===13;if(h.keyCode===9||c)i&&(h.preventDefault(),bc(t,s,e,o,a,n),i=!1);else if((m||u)&&(h.preventDefault(),e.optionIndex=e.optionIndex||0,e.childNodes[e.optionIndex])){e.childNodes[e.optionIndex].classList.remove("selected");let d=e.optionIndex+(m?-1:1);if(e.childNodes[d])e.childNodes[d].classList.add("selected"),e.childNodes[d].scrollIntoView({block:"nearest"}),e.optionIndex=d;else{let f=m?e.childNodes.length-1:0;e.childNodes[f].classList.add("selected"),e.childNodes[f].scrollIntoView({block:"nearest"}),e.optionIndex=f}}}}),t.addEventListener("keyup",h=>{let m=h.keyCode===13;(h.keyCode===9||m)&&(i=!0)}),e.addEventListener("click",h=>{NO(e,h.target.index),bc(t,s,e,o,a,n)}),t.addEventListener("select",()=>{e.style.display!=="none"&&t.selectionStart!==t.selectionEnd&&(e.style.display="none")}),t.addEventListener("click",()=>{e.style.display="none"}),t.addEventListener("scroll",()=>{e.style.display!=="none"&&!window.weAreTypingInTextarea&&(e.style.display="none")}),new ResizeObserver(h=>{e.style.display="none"}).observe(t)}});var ao=C((ak,vc)=>{"use strict";vc.exports=(e,t,s,r)=>{let n=e.getAttribute("data-left")*1,o=e.getAttribute("data-right")*1,a=e.getAttribute("data-top")*1,i=e.getAttribute("data-bottom")*1,l=document.createElementNS("http://www.w3.org/2000/svg","rect"),h=o-n,m=i-a,u=t.querySelector('[data-name="page"]'),c=u.getAttribute("data-interval-between-stave-lines"),g=1*c,d=.08*c,f=u.getAttribute("data-font-color");return l.setAttribute("class",s),r&&l.setAttribute("id",r),l.setAttribute("width",h+2*g),l.setAttribute("height",m+2*g),l.setAttribute("transform",`translate(${n-g}, ${a-g})`),l.setAttribute("fill","rgb(245, 205, 121)"),l.setAttribute("stroke",f),l.setAttribute("stroke-width",d),l.setAttribute("stroke-linejoin","round"),l.setAttribute("stroke-linecap","round"),l}});var lo=C((lk,Wc)=>{"use strict";var wO=Ft();Wc.exports=e=>{let t=wO("div",{},{class:"press-draw-label"});t.textContent="No references was found, try to press button DRAW",e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),setTimeout(()=>{e.contains(t)&&e.removeChild(t)},5e3)}});var Nc=C((hk,kc)=>{"use strict";var IO=ao(),$O=lo(),Bn=navigator.platform.indexOf("Mac")!==-1,BO=e=>{let t=e.initialParentElement.shadowRoot.querySelector(".central-absolute-hint-message");t&&(e.initialParentElement.shadowRoot.removeChild(t),t.isRemoved=!0);let s=document.createElement("div");s.classList.add("central-absolute-hint-message"),s.innerText="You have to re-render preview to match the changes in the text to be able to navigate.",e.initialParentElement.shadowRoot.appendChild(s),(s.style.display==="none"||s.style.display==="")&&(s.style.display="block",setTimeout(()=>{s.isRemoved||(s.style.display="none",e.initialParentElement.shadowRoot.removeChild(s))},5e3))};kc.exports=(e,t,s)=>{let r=t.initialParentElement,n=a=>{if(a.target.hasAttribute("ref-id")){a.target.style.textDecoration="none",window.refSpanThatHovered=void 0;let i=a.target.getAttribute("ref-id"),l=r.shadowRoot.querySelectorAll("[ref-ids]"),h=[];for(let u=0;u<l.length;u++)l[u].getAttribute("ref-ids").split(",").indexOf(i)!==-1&&h.push(l[u]);if(h[0]){s.click();let u=r.shadowRoot.querySelector("svg");for(let c=0;c<h.length;c++){let g=h[c],d=IO(g,u,"ref-rect-hover","ref-rect-hover-from-editor");u.appendChild(d),setTimeout(()=>{u.contains(d)&&u.removeChild(d)},2500)}}else $O(r),t.blur()}},o=!1;e.addEventListener("mousemove",a=>{(Bn&&a.metaKey||!Bn&&a.ctrlKey)&&t.selectionStart===t.selectionEnd?(e.style.zIndex="2",a.target.tagName.toLowerCase()==="span"&&(t.isRenderedWithLatestUnilangInputText||BO(t)),a.target.hasAttribute("ref-id")?(a.target.addEventListener("click",n),window.refSpanThatHovered?(window.refSpanThatHovered.style.textDecoration="none",window.refSpanThatHovered=a.target,window.refSpanThatHovered.style.textDecoration="underline"):(window.refSpanThatHovered=a.target,window.refSpanThatHovered.style.textDecoration="underline"),o=!0):window.refSpanThatHovered&&(o&&(window.refSpanThatHovered.removeEventListener("click",n),o=!1),window.refSpanThatHovered.style.textDecoration="none",window.refSpanThatHovered=void 0)):(e.style.zIndex="0",e.removeEventListener("click",n),o=!1)}),window.addEventListener("keydown",a=>{(Bn&&a.metaKey||!Bn&&a.ctrlKey)&&t.selectionStart===t.selectionEnd?e.style.zIndex="2":(e.style.zIndex="0",window.refSpanThatHovered&&(o&&(window.refSpanThatHovered.removeEventListener("click",n),o=!1),window.refSpanThatHovered.style.textDecoration="none",window.refSpanThatHovered=void 0))}),window.addEventListener("keyup",()=>{e.style.zIndex="0",window.refSpanThatHovered&&(o&&(window.refSpanThatHovered.removeEventListener("click",n),o=!1),window.refSpanThatHovered.style.textDecoration="none",window.refSpanThatHovered=void 0)})}});var Ic=C((uk,wc)=>{"use strict";var yO=ao(),AO=lo(),yn=navigator.platform.indexOf("Mac")!==-1;wc.exports=(e,t,s,r)=>{let n=t.initialParentElement,o=!1,a=l=>{if(!l.observed){l.observed=!0;let h=n.shadowRoot.querySelector("svg");if(typeof l.hasAttribute=="function"&&l.hasAttribute("ref-ids")){let u,c=()=>{r.click(),e.style.zIndex="+2";let d=l.getAttribute("ref-ids").split(","),f,p;for(let T=0;T<d.length&&(f=d[T],p=e.querySelector(`[ref-id="${f}"]`),!p);T++);if(p){t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,s.scrollTop=e.scrollTop,s.scrollLeft=e.scrollLeft;for(let T=0;T<d.length;T++){let b=e.querySelectorAll(`[ref-id="${d[T]}"]`);for(let O=0;O<b.length;O++){let $=b[O];u.classList.remove("ref-rect-hover-no-animated"),u.classList.add("ref-rect-hover-not-visible"),$.classList.contains("ref-span-background")&&($.classList.remove("ref-span-background"),$.offsetWidth),$.classList.add("ref-span-background"),setTimeout(()=>{$.classList.remove("ref-span-background")},2800)}}}else AO(n);h.removeChild(u),u=void 0,o=!1},g=d=>{if((yn&&d.metaKey||!yn&&d.ctrlKey)&&!o){let f=l.getAttribute("ref-ids").split(","),p,T;for(let b=0;b<f.length&&(p=f[b],T=e.querySelector(`[ref-id="${p}"]`),!T);b++);if(T){o=!0,u=yO(l,h,"ref-rect-hover-no-animated"),h.appendChild(u),u.addEventListener("click",c),t.blur();let b=()=>{u&&(u.removeEventListener("click",c),h.removeChild(u),u=void 0,o=!1,window.removeEventListener("keyup",b))};u.addEventListener("mouseleave",b),window.addEventListener("keyup",b),d.stopPropagation()}}};l.addEventListener("mouseover",g),l.addEventListener("mousemove",g)}let m=l.childNodes;for(let u=0;u<m.length;u++)a(m[u])}};new MutationObserver((l,h)=>{for(let m of l)if(m.type==="childList")for(let u=0;u<m.addedNodes.length;u++){let c=m.addedNodes[u];c.tagName==="svg"&&a(c)}}).observe(n.shadowRoot,{childList:!0,subtree:!0}),window.addEventListener("keydown",l=>{if(yn&&l.metaKey||!yn&&l.ctrlKey){let h=document.querySelector("#ref-rect-hover-from-editor");h&&n.querySelector("svg").removeChild(h)}})}});var xO=Po(),FO=Co(),DO=Oo(),MO=vo(),LO=ko(),VO=wo(),RO=Fo(),jO=Lo(),SO=Xm(),EO=tc(),qO=Nn(),UO=oc(),_O=so(),JO=hc(),KO=Hc(),GO=Nc(),zO=Ic(),YO=no();window.initializeUnisonTextarea=(e,t,s)=>{let r="FiraCode",n=e.parentElement,o=e.parentElement.attachShadow({mode:"open"});e.initialParentElement=n,e.initialParentElement.style.position="relative",e.initialParentElement.style.overflow="visible";let a=document.createElement("style");a.textContent=`
    textarea {
      font-family: '${r}';
      position: absolute;
      font-size: 1em;
      padding: 0px;
      top: 10px;
      left: 10px;
      height: calc(100% - 1.2em);
      line-height: 1.4em;
      outline: none;
      resize: none;
      border: none;
      background-color: transparent;
      color: rgba(0, 0, 0, 0.0);
      caret-color: #080808;
      font-weight: normal;
      overflow: auto;
      cursor: text;
      scrollbar-width: none;
      z-index: 1;
    }

    textarea::-webkit-scrollbar {
      display: none;
    }

    .div-underneath-unitextarea {
      background-color: transparent;
      font-family: '${r}';
      position: absolute;
      font-size: 1em;
      line-height: 1.4em;
      left: 10px;
      top: 10px;
      width: 100%;
      height: calc(100% - 1.2em);
      color: #1F2D3A;
      overflow: hidden;
      white-space: pre;
      cursor: text;
      z-index: 0;
      scrollbar-width: none;
    }

    .div-underneath-unitextarea::-webkit-scrollbar {
      display: none;
    }

    .div-underneath-unitextarea-text-container {
      white-space: pre; 
      width: max-content;
    }

    pre {
      width: max-content;
    }

    .line-numbers-column {
      position: absolute;
      font-family: '${r}';
      top: 10px;
      left: 10px;
      height: calc(100% - 1.2em);
      scrollbar-width: none;
      overflow: hidden;
      white-space: pre;
      box-sizing: border-box;
      text-align: right;
      line-height: 1.4em;
    }

    .line-numbers-column::-webkit-scrollbar { 
      display: none;
    }

    .line-number-block {
      text-align: right;
      color: #343434;
    }

    .line-highlighted-number {
      color: #FF7F50;
      font-weight: bold;
    }

    .autocomplete-list-view {
      font-family: '${r}';
      font-size: 1em;
      background: #FCFCFC;
      min-width: 260px;
      width: fit-content;
      height: auto;
      max-height: 300px;
      overflow: auto;
      position: absolute;
      z-index: 100;
      border-radius: 5px;
      box-shadow: rgba(9, 30, 66, 0.45) 0px 1px 1px, rgba(9, 30, 66, 0.25) 0px 0px 1px 1px;
      scrollbar-width: none;  /* Hide scroll bar for Firefox */
    }

    .autocomplete-list-view::-webkit-scrollbar { 
      display: none;  /* Hide scroll bar for Safari and Chrome */
    }

    .autocomplete-list-view-option {
      line-height: 30px;
      background: var(--editor-background-color);
      width: 100%;
      padding-right: 10px;
      padding-left: 10px; /* It must be equal to the \`distanceToMoveAutocompleteListViewSoWeCanAddPaddingToItAndTheTextWouldAlignCorrectly\` variable in editor/js/createAutocompleteListViewOnTypingIfNeeded.js */
      cursor: pointer;
      white-space: nowrap;
    }

    .autocomplete-list-view-option.selected {
      background: #FAF0E6;
      color: #1F2D3A;
    }

    .uncomplete-word-highlight-in-list-of-options-in-autocomplete-list-view {
      color: #EB8100;
    }

    @keyframes fading-message { 
      0% {
        opacity: 80%;
        filter: opacity(80%);
      }

      100% {
        opacity: 0%;
        filter: opacity(0%);
      }
    }

    .central-absolute-hint-message {
      position: absolute; 
      font-family: '${r}';
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: fit-content;
      background: #323232;
      color: #FFFFFF;
      font-size: 1em;
      opacity: 80%;
      margin-left: auto; 
      margin-right: auto; 
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      animation: fading-message 2.5s;
      animation-fill-mode: forwards;
      animation-delay: 2.5s;
      z-index: 1000;
      display: none;
    }

    @keyframes hide-rect-ref-hover { 
      0% {
        opacity: 80%;
        filter: opacity(80%);
      }

      100% {
        opacity: 0%;
        filter: opacity(0%);
      }
    }

    .ref-rect-hover {
      animation: hide-rect-ref-hover 3.0s;
      animation-fill-mode: forwards;
      opacity: 80%;
      filter: opacity(80%);
    }

    .ref-rect-hover-no-animated {
      cursor: pointer;
      opacity: 80%;
      filter: opacity(80%);
    }

    .ref-rect-hover-not-visible {
      opacity: 0%;
      filter: opacity(0%);
    }

    @keyframes hide-ref-span-background { 
      0% {
        background: rgba(245, 205, 121, 0.7);
      }
      100% {
        background: rgba(245, 205, 121, 0.0);
      }
    }

    .ref-span-background {
      background: rgba(245, 205, 121, 0.7);
      animation: hide-ref-span-background 2.0s;
      animation-fill-mode: forwards;
      animation-delay: 0.8s;
    }

    .div-underneath-unitextarea span[ref-id]:hover {
      cursor: pointer;
    }

    /*/////////////////////////////////// HIGHLIHGHT CLASSES ///////////////////////////////*/
    /* By using shortcut class names, we optimise method innerHTML for highlighting */

    /* comment-highlight */
    .ch {
      color: #4C5866;
    }

    /* style-highlight */
    .sh {
      color: #A01A4C;
    }

    /* style-value-highlight */
    .svh {
      color: #A01A4C;
    }

    /* midi-setting-highlight */
    .msh {
      color: #3C5E93;
    }

    /* midi-value-setting-highlight */
    .msvh {
      color: #3C5E93;
    }

    /* text-highlight */
    .th {
      color: var(--editor-font-color);
    }

    /* element-highlight */
    .eh {
      color: #0087BD;
    }

    /* string-highlight */
    .sth {
      color: #00744E;
    }

    /* contains-number-highlight */
    .cnh {
      color: #8F0125;
    }

    /* 
      text-highlight,
      contains-line-position-preposition-highlight,
      contains-measure-position-preposition-highlight,
      contains-stave-position-preposition-highlight,
      contains-voice-position-preposition-highlight,
      contains-unit-position-preposition-highlight
    */
    .th,
    .clpph,
    .cmpph,
    .cspph,
    .cvpph,
    .cupph {
      color: var(--editor-font-color);
    }

    /* contains-line-position-highlight */
    .clph {
      color: #009F6B;
    }

    /* contains-measure-position-highlight */
    .cmph {
      color: #832E61;
    }

    /* contains-stave-position-highlight */
    .csph {
      color: #E26B1A;
    }

    /* contains-voice-position-highlight */
    .cvph  {
      color: #008FA2;
    }

    /* contains-unit-position-highlight */
    .cuph {
      color: #C40233;
    }

    /* not-recognizable-command-highlight */
    .nrch {
      text-decoration: underline;
      text-decoration-color: #DD4444;
      text-decoration-skip: spaces;
      color: var(--editor-font-color);
    }

    /*/////////////////////////////END OF HIGHLIHGHT CLASSES ///////////////////////////////*/
  `,o.appendChild(a),e.setAttribute("wrap","off"),e.setAttribute("autocomplete","off"),e.setAttribute("spellcheck","false"),e.classList.add("unitextarea"),o.appendChild(e);let i=xO(e,r),l=FO(i,r),h=DO(e);MO(i,l,e),LO(e),VO(e),RO(e,r),jO(e),SO(i,e),EO(e),qO(i,e,!0),UO(l,e,i),_O(l,e,i),JO(o,e,l),KO(h,e,i,r),GO(i,e,t),zO(i,e,l,s),window.addEventListener("resize",()=>{YO(e,i,l)})};})();
